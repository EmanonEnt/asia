<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveGigs Data Test</title>
    <style>
        body { font-family: monospace; background: #000; color: #0f0; padding: 20px; }
        .error { color: #f00; }
        .success { color: #0f0; }
        .info { color: #ff0; }
        pre { background: #111; padding: 10px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>LiveGigs Data Loader Test</h1>
    <div id="log"></div>

    <script>
        function log(msg, type = 'info') {
            const div = document.getElementById('log');
            const p = document.createElement('p');
            p.className = type;
            p.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            div.appendChild(p);
        }

        // 测试1: 检查 fetch 是否可用
        log('Testing fetch API...', 'info');
        if (typeof fetch === 'undefined') {
            log('ERROR: fetch API not available!', 'error');
        } else {
            log('fetch API available', 'success');
        }

        // 测试2: 尝试加载 events.json
        const testUrls = [
            'https://emanonent.github.io/asia/content/events.json',
            'https://emanonent.github.io/asia/content/events.json?t=' + Date.now(),
            './content/events.json',
            '../content/events.json'
        ];

        log('Testing JSON loading...', 'info');

        testUrls.forEach((url, index) => {
            fetch(url, { cache: 'no-cache' })
                .then(response => {
                    if (response.ok) {
                        log(`✓ URL ${index + 1} OK: ${url}`, 'success');
                        return response.json();
                    } else {
                        log(`✗ URL ${index + 1} FAILED (${response.status}): ${url}`, 'error');
                        throw new Error('HTTP ' + response.status);
                    }
                })
                .then(data => {
                    log(`✓ JSON parsed successfully. Events count: ${data.events ? data.events.length : 0}`, 'success');
                    document.getElementById('log').innerHTML += '<pre>' + JSON.stringify(data, null, 2).substring(0, 500) + '...</pre>';
                })
                .catch(err => {
                    log(`✗ URL ${index + 1} ERROR: ${err.message}`, 'error');
                });
        });

        // 测试3: 检查当前页面路径
        log('Current page: ' + window.location.href, 'info');
        log('Base URL: ' + window.location.origin, 'info');
    </script>
</body>
</html>