<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveGigs Asia - 后台管理</title>
    <link rel="icon" type="image/png" href="../image/webtop.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            background: #050505; color: #c0c0c0; min-height: 100vh;
        }
        .login-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #050505 0%, #1a0000 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10000;
        }
        .login-box {
            background: rgba(139, 0, 0, 0.1); border: 2px solid #8b0000;
            padding: 40px; border-radius: 10px; text-align: center; min-width: 350px;
        }
        .login-box h1 { color: #8b0000; font-size: 32px; margin-bottom: 10px; letter-spacing: 2px; }
        .login-box p { color: #c0c0c0; margin-bottom: 30px; font-size: 14px; }
        .login-box input {
            width: 100%; padding: 12px; margin-bottom: 15px;
            background: rgba(192, 192, 192, 0.1); border: 1px solid #c0c0c0;
            color: #c0c0c0; font-family: inherit; font-size: 16px; border-radius: 5px;
        }
        .login-box input:focus { outline: none; border-color: #8b0000; }
        .login-box button {
            width: 100%; padding: 12px; background: #8b0000; color: white;
            border: none; font-family: inherit; font-size: 16px; cursor: pointer;
            border-radius: 5px; transition: all 0.3s;
        }
        .login-box button:hover { background: #a00000; transform: translateY(-2px); }

        .admin-container { display: none; max-width: 1400px; margin: 0 auto; padding: 20px; }
        .admin-header {
            background: rgba(0, 0, 0, 0.8); border-bottom: 3px solid #8b0000;
            padding: 20px; margin-bottom: 30px;
            display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;
        }
        .admin-header h1 { color: #8b0000; font-size: 28px; letter-spacing: 2px; }

        .btn {
            padding: 10px 20px; background: #8b0000; color: white;
            border: none; font-family: inherit; cursor: pointer;
            border-radius: 5px; transition: all 0.3s;
        }
        .btn:hover { background: #a00000; transform: translateY(-2px); }
        .btn-secondary { background: #333; }
        .btn-secondary:hover { background: #444; }
        .btn-success { background: #28a745; }
        .btn-success:hover { background: #218838; }
        .btn-small { padding: 5px 12px; font-size: 12px; }
        .btn-danger { background: #dc3545; }
        .btn-danger:hover { background: #c82333; }

        .nav-tabs {
            display: flex; gap: 10px; margin-bottom: 30px;
            flex-wrap: wrap; border-bottom: 2px solid #333; padding-bottom: 10px;
        }
        .nav-tab {
            padding: 12px 24px; background: transparent; border: 2px solid #333;
            color: #c0c0c0; font-family: inherit; cursor: pointer;
            transition: all 0.3s; border-radius: 5px 5px 0 0;
        }
        .nav-tab:hover, .nav-tab.active { background: #8b0000; border-color: #8b0000; color: white; }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .section {
            background: rgba(255, 255, 255, 0.05); border: 1px solid #333;
            border-radius: 10px; padding: 25px; margin-bottom: 25px;
        }
        .section h2 {
            color: #8b0000; font-size: 22px; margin-bottom: 20px;
            padding-bottom: 10px; border-bottom: 1px solid #333;
        }

        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; margin-bottom: 8px; color: #c0c0c0;
            font-size: 14px; text-transform: uppercase; letter-spacing: 1px;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 12px; background: rgba(192, 192, 192, 0.1);
            border: 1px solid #555; color: #c0c0c0;
            font-family: inherit; font-size: 14px; border-radius: 5px;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none; border-color: #8b0000;
        }

        .item-card {
            background: rgba(0, 0, 0, 0.3); border: 1px solid #444;
            border-radius: 8px; padding: 20px; margin-bottom: 15px;
        }
        .item-card:hover { border-color: #8b0000; }
        .item-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px;
        }
        .item-title { color: #8b0000; font-size: 16px; }
        .item-actions { display: flex; gap: 10px; }

        .preview-img {
            max-width: 200px; max-height: 150px;
            border: 1px solid #555; border-radius: 5px; margin-top: 10px;
        }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }

        .status-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: rgba(0, 0, 0, 0.95); border-top: 2px solid #8b0000;
            padding: 15px 20px; display: flex; justify-content: space-between;
            align-items: center; z-index: 1000;
        }
        .status-msg { color: #c0c0c0; }
        .status-msg.success { color: #28a745; }
        .status-msg.error { color: #dc3545; }
        .status-msg.loading { color: #ffc107; }

        .empty-state { text-align: center; padding: 40px; color: #666; }

        .help-text {
            background: rgba(139, 0, 0, 0.1); border-left: 3px solid #8b0000;
            padding: 15px; margin-bottom: 20px; font-size: 13px; line-height: 1.6;
        }

        .counter { color: #666; font-size: 14px; margin-left: 10px; }

        @media (max-width: 768px) {
            .grid-2 { grid-template-columns: 1fr; }
            .admin-header { flex-direction: column; text-align: center; }
            .login-box { min-width: 90%; margin: 0 20px; }
        }
    </style>
</head>
<body>
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>LIVEGIGS ASIA</h1>
            <p>后台管理系统</p>
            <input type="password" id="password" placeholder="请输入密码" value="00123456a">
            <input type="password" id="githubToken" placeholder="GitHub Token (首次同步需要)">
            <button onclick="login()">登录</button>
            <p style="margin-top: 15px; font-size: 12px; color: #666;">默认密码: 00123456a</p>
        </div>
    </div>

    <div class="admin-container" id="adminContainer">
        <div class="admin-header">
            <h1>LIVEGIGS ASIA 后台管理</h1>
            <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                <button class="btn btn-secondary" onclick="loadAllData()">重新加载</button>
                <button class="btn btn-success" onclick="syncToGitHub()">同步到GitHub</button>
                <button class="btn btn-secondary" onclick="logout()">退出</button>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('banners')">Banner管理</button>
            <button class="nav-tab" onclick="switchTab('posters')">海报管理</button>
            <button class="nav-tab" onclick="switchTab('events')">活动管理</button>
            <button class="nav-tab" onclick="switchTab('partners')">合作伙伴</button>
            <button class="nav-tab" onclick="switchTab('footer')">底部管理</button>
        </div>

        <!-- Banner管理 -->
        <div class="tab-content active" id="tab-banners">
            <div class="section">
                <h2>首页 Banner <span class="counter">(最多10个)</span></h2>
                <div class="help-text">尺寸: 1920×1080px (16:9) | 支持本地路径如 ./image/banner.jpg 或完整URL</div>
                <div id="bannersList"></div>
                <button class="btn" onclick="addBanner()" style="margin-top: 15px;">+ 添加Banner</button>
            </div>
        </div>

        <!-- 海报管理 -->
        <div class="tab-content" id="tab-posters">
            <div class="section">
                <h2>首页海报 <span class="counter">(3个)</span></h2>
                <div class="help-text">尺寸: 400×600px (2:3)</div>
                <div id="indexPostersList"></div>
            </div>
            <div class="section">
                <h2>国内站海报 <span class="counter">(3个)</span></h2>
                <div id="cnPostersList"></div>
            </div>
            <div class="section">
                <h2>活动页海报 <span class="counter">(3个)</span></h2>
                <div class="help-text">海报2支持滚播，在下方"滚播设置"区域配置3张图片</div>
                <div id="eventsPostersList"></div>
            </div>
            <!-- 海报2滚播设置 -->
            <div class="section">
                <h2>海报2滚播设置 <span class="counter">(3张图片)</span></h2>
                <div class="help-text">配置活动页第2个海报的滚播图片（自动轮播）</div>
                <div id="poster2CarouselList"></div>
            </div>
        </div>

        <!-- 活动管理 -->
        <div class="tab-content" id="tab-events">
            <div class="section">
                <h2>THE EVENTS WE'VE MANAGED</h2>
                <div id="eventsList"></div>
                <button class="btn" onclick="addEvent()" style="margin-top: 15px;">+ 添加活动</button>
            </div>
            <div class="section">
                <h2>滚播海报 <span class="counter">(最多5个)</span></h2>
                <div id="carouselList"></div>
                <button class="btn" onclick="addCarousel()" style="margin-top: 15px;">+ 添加滚播</button>
            </div>
        </div>

        <!-- 合作伙伴 -->
        <div class="tab-content" id="tab-partners">
            <div class="section">
                <h2>Partners Banner <span class="counter">(1-4个)</span></h2>
                <div class="help-text">尺寸: 1920×800px | Logo: 180×110px</div>
                <div id="partnersBannersList"></div>
            </div>
            <div class="section">
                <h2>OUR COLLABORATORS <span class="counter">(0-10个)</span></h2>
                <div class="help-text">可添加0-10个合作伙伴Logo，不填链接则不可点击</div>
                <div id="collaboratorsList"></div>
                <button class="btn" onclick="addCollaborator()" style="margin-top: 15px;">+ 添加Logo</button>
            </div>
        </div>

        <!-- 底部管理 -->
        <div class="tab-content" id="tab-footer">
            <div class="section">
                <h2>海外站底部 (统一)</h2>
                <div class="form-group">
                    <label>版权文字 (Copyright)</label>
                    <input type="text" id="globalCopyright" placeholder="© 2025 LIVEGIGS ASIA. ALL RIGHTS RESERVED.">
                </div>
                <div class="form-group">
                    <label>社交链接</label>
                    <div id="globalSocialLinks"></div>
                    <button class="btn btn-small btn-secondary" onclick="addSocialLink('global')" style="margin-top: 10px;">+ 添加链接</button>
                </div>
            </div>
            <div class="section">
                <h2>国内站底部 (单独)</h2>
                <div class="form-group">
                    <label>版权文字 (Copyright)</label>
                    <input type="text" id="cnCopyright" placeholder="© 2025 LIVEGIGS ASIA. ALL RIGHTS RESERVED.">
                </div>
                <div class="form-group">
                    <label>社交链接</label>
                    <div id="cnSocialLinks"></div>
                    <button class="btn btn-small btn-secondary" onclick="addSocialLink('cn')" style="margin-top: 10px;">+ 添加链接</button>
                </div>
            </div>
        </div>

        <div style="height: 80px;"></div>
    </div>

    <div class="status-bar">
        <span class="status-msg" id="statusMsg">就绪</span>
        <span style="color: #666;">LiveGigs Asia Admin v2.1</span>
    </div>

    <script>
        const CONFIG = { owner: 'EmanonEnt', repo: 'asia', branch: 'main' };

        const defaultData = {
            banners: { banners: [] },
            indexPosters: { posters: [{},{},{}] },
            cnPosters: { posters: [{},{},{}] },
            eventsPosters: { posters: [{},{},{}] },
            poster2Carousel: { images: [] },
            eventsManaged: { events: [] },
            eventsCarousel: { slides: [] },
            partnersBanners: { banners: [{},{},{},{}] },
            collaborators: { logos: [] },
            footerGlobal: { copyright: '© 2025 LIVEGIGS ASIA. ALL RIGHTS RESERVED.', socialLinks: [] },
            footerCN: { copyright: '© 2025 LIVEGIGS ASIA. ALL RIGHTS RESERVED.', socialLinks: [] }
        };

        let adminData = JSON.parse(JSON.stringify(defaultData));
        let githubToken = '';

        function login() {
            const pwd = document.getElementById('password').value;
            const token = document.getElementById('githubToken').value;

            if (pwd !== '00123456a') { alert('密码错误！'); return; }

            githubToken = token;
            if (token) localStorage.setItem('lg_token', token);
            else githubToken = localStorage.getItem('lg_token') || '';

            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
            loadAllData();
        }

        function logout() {
            localStorage.removeItem('lg_token');
            location.reload();
        }

        function switchTab(tab) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('tab-' + tab).classList.add('active');
        }

        function showStatus(msg, type) {
            const el = document.getElementById('statusMsg');
            el.textContent = msg;
            el.className = 'status-msg ' + type;
            if (type !== 'loading') {
                setTimeout(() => { el.textContent = '就绪'; el.className = 'status-msg'; }, 3000);
            }
        }

        async function loadAllData() {
            showStatus('正在加载数据...', 'loading');

            const files = Object.keys(adminData);
            for (const file of files) {
                try {
                    const res = await fetch('../content/' + file + '.json?v=' + Date.now());
                    if (res.ok) {
                        const data = await res.json();
                        if (data && Object.keys(data).length > 0) adminData[file] = data;
                    }
                } catch (e) { console.warn('加载失败:', file); }
            }

            renderAll();
            showStatus('数据加载完成', 'success');
        }

        function renderAll() {
            renderBanners();
            renderPosters();
            renderPoster2Carousel();
            renderEvents();
            renderPartners();
            renderFooter();
        }

        // Banner渲染
        function renderBanners() {
            const container = document.getElementById('bannersList');
            const banners = adminData.banners.banners || [];

            if (banners.length === 0) {
                container.innerHTML = '<div class="empty-state">暂无Banner，请添加</div>';
                return;
            }

            container.innerHTML = banners.map((b, i) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">Banner #${i+1}</span>
                        <button class="btn btn-small btn-danger" onclick="deleteBanner(${i})">删除</button>
                    </div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>背景图片</label>
                            <input type="text" id="b-img-${i}" value="${b.image||''}" placeholder="./image/banner.jpg">
                            ${b.image?`<img src="${b.image}" class="preview-img">`:''}
                        </div>
                        <div class="form-group">
                            <label>标题 (可选)</label>
                            <input type="text" id="b-title-${i}" value="${b.title||''}">
                        </div>
                        <div class="form-group">
                            <label>按钮文字</label>
                            <input type="text" id="b-btn-${i}" value="${b.buttonText||'VIEW DETAILS'}">
                        </div>
                        <div class="form-group">
                            <label>链接</label>
                            <input type="text" id="b-link-${i}" value="${b.link||'#'}">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addBanner() {
            if (adminData.banners.banners.length >= 10) return alert('最多10个Banner');
            adminData.banners.banners.push({image:'',title:'',buttonText:'VIEW DETAILS',link:'#'});
            renderBanners();
        }

        function deleteBanner(i) {
            if (!confirm('确定删除?')) return;
            adminData.banners.banners.splice(i,1);
            renderBanners();
        }

        // 海报渲染
        function renderPosters() {
            ['index','cn','events'].forEach(type => {
                const key = type+'Posters';
                const container = document.getElementById(type+'PostersList');
                const posters = adminData[key].posters || [{},{},{}];

                container.innerHTML = posters.map((p,i) => `
                    <div class="item-card">
                        <div class="item-header"><span class="item-title">海报 #${i+1}</span></div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>图片</label>
                                <input type="text" id="p-${type}-img-${i}" value="${p.image||''}">
                                ${p.image?`<img src="${p.image}" class="preview-img">`:''}
                            </div>
                            <div class="form-group">
                                <label>标题</label>
                                <input type="text" id="p-${type}-title-${i}" value="${p.title||''}">
                            </div>
                            <div class="form-group">
                                <label>链接文字</label>
                                <input type="text" id="p-${type}-text-${i}" value="${p.linkText||'View Details →'}">
                            </div>
                            <div class="form-group">
                                <label>链接</label>
                                <input type="text" id="p-${type}-link-${i}" value="${p.link||'#'}">
                            </div>
                        </div>
                    </div>
                `).join('');
            });
        }

        // 海报2滚播渲染
        function renderPoster2Carousel() {
            const container = document.getElementById('poster2CarouselList');
            const images = adminData.poster2Carousel.images || [];

            // 确保有3个位置
            while (images.length < 3) images.push('');

            container.innerHTML = images.map((img, i) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">滚播图片 #${i+1}</span>
                    </div>
                    <div class="form-group">
                        <label>图片 URL</label>
                        <input type="text" id="p2c-img-${i}" value="${img}" placeholder="图片地址">
                        ${img?`<img src="${img}" class="preview-img">`:''}
                    </div>
                </div>
            `).join('');
        }

        // 活动渲染
        function renderEvents() {
            const events = adminData.eventsManaged.events || [];
            const container = document.getElementById('eventsList');

            if (events.length === 0) {
                container.innerHTML = '<div class="empty-state">暂无活动</div>';
            } else {
                container.innerHTML = events.map((e,i) => `
                    <div class="item-card">
                        <div class="item-header">
                            <span class="item-title">活动 #${i+1}</span>
                            <button class="btn btn-small btn-danger" onclick="deleteEvent(${i})">删除</button>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>海报</label>
                                <input type="text" id="e-img-${i}" value="${e.image||''}">
                                ${e.image?`<img src="${e.image}" class="preview-img">`:''}
                            </div>
                            <div class="form-group">
                                <label>标题 *</label>
                                <input type="text" id="e-title-${i}" value="${e.title||''}">
                            </div>
                            <div class="form-group"><label>日期</label><input type="text" id="e-date-${i}" value="${e.date||''}"></div>
                            <div class="form-group"><label>地点</label><input type="text" id="e-venue-${i}" value="${e.venue||''}"></div>
                            <div class="form-group"><label>时间</label><input type="text" id="e-time-${i}" value="${e.time||''}"></div>
                            <div class="form-group"><label>票价</label><input type="text" id="e-ticket-${i}" value="${e.ticket||''}"></div>
                            <div class="form-group"><label>按钮</label><input type="text" id="e-btn-${i}" value="${e.buttonText||'BUY TICKETS'}"></div>
                            <div class="form-group"><label>链接</label><input type="text" id="e-link-${i}" value="${e.link||'#'}"></div>
                        </div>
                        <div class="form-group" style="margin-top:15px;">
                            <label>详情</label>
                            <textarea id="e-desc-${i}" rows="2">${e.description||''}</textarea>
                        </div>
                        <div style="margin-top:10px;">
                            <label style="display:inline;margin-right:20px;">
                                <input type="checkbox" id="e-tour-${i}" ${e.onTour?'checked':''}> ON TOUR
                            </label>
                            <label style="display:inline;">
                                <input type="checkbox" id="e-sold-${i}" ${e.soldOut?'checked':''}> SOLD OUT
                            </label>
                        </div>
                    </div>
                `).join('');
            }

            const slides = adminData.eventsCarousel.slides || [];
            const cContainer = document.getElementById('carouselList');

            if (slides.length === 0) {
                cContainer.innerHTML = '<div class="empty-state">暂无滚播</div>';
            } else {
                cContainer.innerHTML = slides.map((s,i) => `
                    <div class="item-card">
                        <div class="item-header">
                            <span class="item-title">滚播 #${i+1}</span>
                            <button class="btn btn-small btn-danger" onclick="deleteCarousel(${i})">删除</button>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>图片</label>
                                <input type="text" id="c-img-${i}" value="${s.image||''}">
                                ${s.image?`<img src="${s.image}" class="preview-img">`:''}
                            </div>
                            <div class="form-group"><label>标题</label><input type="text" id="c-title-${i}" value="${s.title||''}"></div>
                            <div class="form-group"><label>日期</label><input type="text" id="c-date-${i}" value="${s.date||''}"></div>
                            <div class="form-group"><label>地点</label><input type="text" id="c-venue-${i}" value="${s.venue||''}"></div>
                            <div class="form-group" style="grid-column:1/-1;"><label>链接</label><input type="text" id="c-link-${i}" value="${s.link||'#'}"></div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function addEvent() {
            adminData.eventsManaged.events.push({
                image:'',title:'',date:'',venue:'',time:'',ticket:'',
                onTour:false,soldOut:false,description:'',buttonText:'BUY TICKETS',link:'#'
            });
            renderEvents();
        }

        function deleteEvent(i) {
            if (!confirm('确定删除?')) return;
            adminData.eventsManaged.events.splice(i,1);
            renderEvents();
        }

        function addCarousel() {
            if (adminData.eventsCarousel.slides.length >= 5) return alert('最多5个滚播');
            adminData.eventsCarousel.slides.push({image:'',title:'',date:'',venue:'',link:'#'});
            renderEvents();
        }

        function deleteCarousel(i) {
            if (!confirm('确定删除?')) return;
            adminData.eventsCarousel.slides.splice(i,1);
            renderEvents();
        }

        // Partners渲染
        function renderPartners() {
            const banners = adminData.partnersBanners.banners || [{},{},{},{}];
            document.getElementById('partnersBannersList').innerHTML = banners.map((b,i) => `
                <div class="item-card">
                    <div class="item-header"><span class="item-title">Banner #${i+1}</span></div>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>背景</label>
                            <input type="text" id="pb-bg-${i}" value="${b.image||''}">
                            ${b.image?`<img src="${b.image}" class="preview-img">`:''}
                        </div>
                        <div class="form-group">
                            <label>Logo</label>
                            <input type="text" id="pb-logo-${i}" value="${b.logo||''}">
                            ${b.logo?`<img src="${b.logo}" class="preview-img">`:''}
                        </div>
                        <div class="form-group"><label>标题</label><input type="text" id="pb-title-${i}" value="${b.title||''}"></div>
                        <div class="form-group"><label>描述</label><input type="text" id="pb-desc-${i}" value="${b.description||''}"></div>
                        <div class="form-group"><label>按钮</label><input type="text" id="pb-btn-${i}" value="${b.buttonText||'LEARN MORE'}"></div>
                        <div class="form-group"><label>链接</label><input type="text" id="pb-link-${i}" value="${b.link||'#'}"></div>
                    </div>
                </div>
            `).join('');

            // Collaborators - 修复为0-10个
            const logos = adminData.collaborators.logos || [];
            const cContainer = document.getElementById('collaboratorsList');

            if (logos.length === 0) {
                cContainer.innerHTML = '<div class="empty-state">暂无合作伙伴Logo，点击"添加Logo"按钮添加 (最多10个)</div>';
            } else {
                cContainer.innerHTML = logos.map((l,i) => `
                    <div class="item-card">
                        <div class="item-header">
                            <span class="item-title">Logo #${i+1}</span>
                            <button class="btn btn-small btn-danger" onclick="deleteCollaborator(${i})">删除</button>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>图片 URL</label>
                                <input type="text" id="col-img-${i}" value="${l.image||''}" placeholder="./image/logo.png">
                                ${l.image?`<img src="${l.image}" class="preview-img">`:''}
                            </div>
                            <div class="form-group">
                                <label>名称</label>
                                <input type="text" id="col-name-${i}" value="${l.name||''}" placeholder="合作伙伴名称">
                            </div>
                            <div class="form-group" style="grid-column:1/-1;">
                                <label>链接地址 (留空则不点击，不新开窗口)</label>
                                <input type="text" id="col-link-${i}" value="${l.link||''}" placeholder="https://...">
                            </div>
                        </div>
                    </div>
                `).join('');
            }
        }

        function addCollaborator() {
            if (adminData.collaborators.logos.length >= 10) return alert('最多10个Logo');
            adminData.collaborators.logos.push({image:'',name:'',link:''});
            renderPartners();
        }

        function deleteCollaborator(i) {
            if (!confirm('确定删除这个Logo吗?')) return;
            adminData.collaborators.logos.splice(i,1);
            renderPartners();
        }

        // Footer渲染
        function renderFooter() {
            document.getElementById('globalCopyright').value = adminData.footerGlobal.copyright || '';
            document.getElementById('cnCopyright').value = adminData.footerCN.copyright || '';

            ['global','cn'].forEach(type => {
                const key = type==='global'?'footerGlobal':'footerCN';
                const links = adminData[key].socialLinks || [];
                const container = document.getElementById(type+'SocialLinks');

                if (links.length === 0) {
                    container.innerHTML = '<div class="empty-state">暂无社交链接</div>';
                } else {
                    container.innerHTML = links.map((l,i) => `
                        <div class="item-card" style="margin-bottom:10px;">
                            <div class="grid-2">
                                <div class="form-group" style="margin-bottom:5px;">
                                    <input type="text" id="s-${type}-icon-${i}" value="${l.icon||''}" placeholder="图标: facebook, instagram, youtube, x, weibo, wechat">
                                </div>
                                <div class="form-group" style="margin-bottom:5px;">
                                    <input type="text" id="s-${type}-url-${i}" value="${l.url||''}" placeholder="URL">
                                </div>
                            </div>
                            <div style="display:flex;gap:10px;margin-top:5px;">
                                <input type="text" id="s-${type}-title-${i}" value="${l.title||''}" placeholder="标题" style="flex:1;">
                                <button class="btn btn-small btn-danger" onclick="deleteSocialLink('${type}',${i})">删除</button>
                            </div>
                        </div>
                    `).join('');
                }
            });
        }

        function addSocialLink(type) {
            const key = type==='global'?'footerGlobal':'footerCN';
            adminData[key].socialLinks.push({icon:'',url:'',title:''});
            renderFooter();
        }

        function deleteSocialLink(type,i) {
            const key = type==='global'?'footerGlobal':'footerCN';
            adminData[key].socialLinks.splice(i,1);
            renderFooter();
        }

        // 收集数据
        function collectData() {
            // Banners
            adminData.banners.banners = [];
            document.querySelectorAll('#bannersList .item-card').forEach((card,i) => {
                adminData.banners.banners.push({
                    image: document.getElementById('b-img-'+i)?.value||'',
                    title: document.getElementById('b-title-'+i)?.value||'',
                    buttonText: document.getElementById('b-btn-'+i)?.value||'VIEW DETAILS',
                    link: document.getElementById('b-link-'+i)?.value||'#'
                });
            });

            // Posters
            ['index','cn','events'].forEach(type => {
                const key = type+'Posters';
                adminData[key].posters = [];
                document.querySelectorAll('#'+type+'PostersList .item-card').forEach((card,i) => {
                    adminData[key].posters.push({
                        image: document.getElementById('p-'+type+'-img-'+i)?.value||'',
                        title: document.getElementById('p-'+type+'-title-'+i)?.value||'',
                        linkText: document.getElementById('p-'+type+'-text-'+i)?.value||'View Details →',
                        link: document.getElementById('p-'+type+'-link-'+i)?.value||'#'
                    });
                });
            });

            // Poster2 Carousel (3张图片)
            adminData.poster2Carousel.images = [];
            for (let i=0; i<3; i++) {
                const val = document.getElementById('p2c-img-'+i)?.value;
                if (val) adminData.poster2Carousel.images.push(val);
            }

            // Events
            adminData.eventsManaged.events = [];
            document.querySelectorAll('#eventsList .item-card').forEach((card,i) => {
                adminData.eventsManaged.events.push({
                    image: document.getElementById('e-img-'+i)?.value||'',
                    title: document.getElementById('e-title-'+i)?.value||'',
                    date: document.getElementById('e-date-'+i)?.value||'',
                    venue: document.getElementById('e-venue-'+i)?.value||'',
                    time: document.getElementById('e-time-'+i)?.value||'',
                    ticket: document.getElementById('e-ticket-'+i)?.value||'',
                    onTour: document.getElementById('e-tour-'+i)?.checked||false,
                    soldOut: document.getElementById('e-sold-'+i)?.checked||false,
                    description: document.getElementById('e-desc-'+i)?.value||'',
                    buttonText: document.getElementById('e-btn-'+i)?.value||'BUY TICKETS',
                    link: document.getElementById('e-link-'+i)?.value||'#'
                });
            });

            // Carousel
            adminData.eventsCarousel.slides = [];
            document.querySelectorAll('#carouselList .item-card').forEach((card,i) => {
                adminData.eventsCarousel.slides.push({
                    image: document.getElementById('c-img-'+i)?.value||'',
                    title: document.getElementById('c-title-'+i)?.value||'',
                    date: document.getElementById('c-date-'+i)?.value||'',
                    venue: document.getElementById('c-venue-'+i)?.value||'',
                    link: document.getElementById('c-link-'+i)?.value||'#'
                });
            });

            // Partners
            adminData.partnersBanners.banners = [];
            document.querySelectorAll('#partnersBannersList .item-card').forEach((card,i) => {
                adminData.partnersBanners.banners.push({
                    image: document.getElementById('pb-bg-'+i)?.value||'',
                    logo: document.getElementById('pb-logo-'+i)?.value||'',
                    title: document.getElementById('pb-title-'+i)?.value||'',
                    description: document.getElementById('pb-desc-'+i)?.value||'',
                    buttonText: document.getElementById('pb-btn-'+i)?.value||'LEARN MORE',
                    link: document.getElementById('pb-link-'+i)?.value||'#'
                });
            });

            // Collaborators - 收集0-10个
            adminData.collaborators.logos = [];
            document.querySelectorAll('#collaboratorsList .item-card').forEach((card,i) => {
                adminData.collaborators.logos.push({
                    image: document.getElementById('col-img-'+i)?.value||'',
                    name: document.getElementById('col-name-'+i)?.value||'',
                    link: document.getElementById('col-link-'+i)?.value||''
                });
            });

            // Footer
            adminData.footerGlobal.copyright = document.getElementById('globalCopyright')?.value||'© 2025 LIVEGIGS ASIA. ALL RIGHTS RESERVED.';
            adminData.footerCN.copyright = document.getElementById('cnCopyright')?.value||'© 2025 LIVEGIGS ASIA. ALL RIGHTS RESERVED.';

            ['global','cn'].forEach(type => {
                const key = type==='global'?'footerGlobal':'footerCN';
                adminData[key].socialLinks = [];
                document.querySelectorAll('#'+type+'SocialLinks .item-card').forEach((card,i) => {
                    adminData[key].socialLinks.push({
                        icon: document.getElementById('s-'+type+'-icon-'+i)?.value||'',
                        url: document.getElementById('s-'+type+'-url-'+i)?.value||'',
                        title: document.getElementById('s-'+type+'-title-'+i)?.value||''
                    });
                });
            });
        }

        // 同步到GitHub
        async function syncToGitHub() {
            collectData();

            if (!githubToken) {
                const token = prompt('请输入GitHub Token:');
                if (!token) return showStatus('需要Token', 'error');
                githubToken = token;
                localStorage.setItem('lg_token', token);
            }

            showStatus('正在同步...', 'loading');

            const files = {
                'banners.json': adminData.banners,
                'index-posters.json': adminData.indexPosters,
                'cn-posters.json': adminData.cnPosters,
                'events-posters.json': adminData.eventsPosters,
                'poster2-carousel.json': adminData.poster2Carousel,
                'events-managed.json': adminData.eventsManaged,
                'events-carousel.json': adminData.eventsCarousel,
                'partners-banners.json': adminData.partnersBanners,
                'collaborators.json': adminData.collaborators,
                'footer-global.json': adminData.footerGlobal,
                'footer-cn.json': adminData.footerCN
            };

            let success = 0, failed = 0;

            for (const [filename, data] of Object.entries(files)) {
                try {
                    const content = btoa(unescape(encodeURIComponent(JSON.stringify(data, null, 2))));

                    let sha = null;
                    try {
                        const check = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/content/${filename}?ref=${CONFIG.branch}`, {
                            headers: {'Authorization': 'token '+githubToken}
                        });
                        if (check.ok) {
                            const checkData = await check.json();
                            sha = checkData.sha;
                        }
                    } catch(e) {}

                    const body = { message: 'Update '+filename, content: content, branch: CONFIG.branch };
                    if (sha) body.sha = sha;

                    const res = await fetch(`https://api.github.com/repos/${CONFIG.owner}/${CONFIG.repo}/contents/content/${filename}`, {
                        method: 'PUT',
                        headers: {'Authorization': 'token '+githubToken, 'Content-Type': 'application/json'},
                        body: JSON.stringify(body)
                    });

                    if (res.ok) success++;
                    else failed++;
                } catch(e) { failed++; }
            }

            if (failed === 0) {
                showStatus('同步成功! '+success+' 个文件', 'success');
                setTimeout(() => alert('同步完成! 网站将在1-2分钟后更新。\n请刷新前台查看效果。'), 500);
            } else {
                showStatus('完成: '+success+' 成功, '+failed+' 失败', 'error');
            }
        }

        window.onload = function() {
            const savedToken = localStorage.getItem('lg_token');
            if (savedToken) document.getElementById('githubToken').value = savedToken;
        };
    </script>
</body>
</html>
