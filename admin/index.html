<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveGigs Asia - 后台管理</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            background: #050505;
            color: #c0c0c0;
            min-height: 100vh;
        }
        .login-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }
        .login-box {
            background: #0a0a0a;
            border: 3px solid #8b0000;
            border-radius: 8px;
            padding: 40px;
            width: 90%;
            max-width: 400px;
            text-align: center;
        }
        .login-box h1 { color: #8b0000; font-size: 28px; margin-bottom: 10px; text-transform: uppercase; }
        .login-box p { color: #666; font-size: 12px; margin-bottom: 30px; font-family: Arial, sans-serif; }
        .login-box input {
            width: 100%; padding: 15px; margin-bottom: 15px;
            background: #1a1a1a; border: 2px solid #333; color: #fff;
            font-size: 14px; border-radius: 4px;
        }
        .login-box input:focus { outline: none; border-color: #8b0000; }
        .login-box button {
            width: 100%; padding: 15px; background: #8b0000; color: #fff;
            border: none; font-size: 16px;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            text-transform: uppercase; cursor: pointer; border-radius: 4px;
        }
        .login-box button:hover { background: #a00000; }
        .token-input { margin-top: 15px; padding-top: 15px; border-top: 1px solid #333; }
        .help-text { font-size: 11px; color: #666; margin-top: 5px; font-family: Arial, sans-serif; }

        .header {
            background: rgba(0,0,0,0.9); border-bottom: 3px solid #8b0000;
            padding: 20px; position: fixed; top: 0; left: 0; right: 0; z-index: 1000;
            display: flex; justify-content: space-between; align-items: center;
        }
        .header h1 { color: #8b0000; font-size: 28px; text-transform: uppercase; letter-spacing: 2px; }
        .header-info { display: flex; gap: 20px; align-items: center; }
        .sync-status {
            padding: 8px 16px; border-radius: 4px; font-size: 12px; text-transform: uppercase;
        }
        .sync-status.success { background: rgba(0,100,0,0.3); color: #00ff00; border: 1px solid #006400; }
        .sync-status.error { background: rgba(139,0,0,0.3); color: #ff6666; border: 1px solid #8b0000; }
        .sync-status.pending { background: rgba(192,192,192,0.2); color: #c0c0c0; border: 1px solid #666; }
        .logout-btn {
            padding: 8px 20px; background: #333; color: #fff; border: none; cursor: pointer;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            text-transform: uppercase; border-radius: 4px;
        }
        .logout-btn:hover { background: #8b0000; }

        .container { max-width: 1400px; margin: 0 auto; padding: 100px 20px 40px; }
        .stats-bar {
            background: #1a1a1a; border: 2px solid #333; border-radius: 6px;
            padding: 20px; margin-bottom: 20px; display: flex; gap: 40px; flex-wrap: wrap;
        }
        .stat-item { text-align: center; }
        .stat-number { font-size: 36px; color: #8b0000; font-weight: bold; }
        .stat-label { font-size: 12px; color: #888; text-transform: uppercase; margin-top: 5px; }

        .nav-tabs {
            display: flex; gap: 10px; margin-bottom: 30px; flex-wrap: wrap;
            border-bottom: 2px solid #333; padding-bottom: 10px;
        }
        .nav-tab {
            padding: 12px 24px; background: #1a1a1a; border: 2px solid #333; color: #c0c0c0;
            cursor: pointer; text-transform: uppercase; font-size: 14px; transition: all 0.3s;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
        }
        .nav-tab:hover, .nav-tab.active { background: #8b0000; border-color: #8b0000; color: #fff; }

        .section { display: none; animation: fadeIn 0.3s; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-title {
            font-size: 24px; color: #8b0000; margin-bottom: 20px; text-transform: uppercase;
            border-left: 5px solid #8b0000; padding-left: 15px;
        }
        .card {
            background: #0a0a0a; border: 2px solid #333; border-radius: 8px;
            padding: 25px; margin-bottom: 20px;
        }
        .form-group { margin-bottom: 20px; }
        .form-group label {
            display: block; margin-bottom: 8px; color: #c0c0c0;
            font-size: 14px; text-transform: uppercase; letter-spacing: 1px;
        }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 12px; background: #1a1a1a; border: 2px solid #333;
            color: #fff; font-size: 14px; font-family: Arial, sans-serif; border-radius: 4px;
        }
        .form-group input:focus, .form-group textarea:focus, .form-group select:focus {
            outline: none; border-color: #8b0000;
        }
        .btn {
            padding: 12px 30px; background: #8b0000; color: #fff; border: none; cursor: pointer;
            text-transform: uppercase; font-size: 14px;
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            border-radius: 4px; margin-right: 10px; margin-bottom: 10px;
        }
        .btn:hover { background: #a00000; }
        .btn-secondary { background: #333; }
        .btn-secondary:hover { background: #444; }
        .btn-success { background: #006400; }
        .btn-success:hover { background: #008000; }
        .btn-danger { background: #8b0000; }

        .item-card {
            background: #1a1a1a; border: 2px solid #333; border-radius: 6px;
            padding: 20px; margin-bottom: 15px; display: flex;
            justify-content: space-between; align-items: center;
        }
        .item-card:hover { border-color: #8b0000; }
        .item-info h4 { color: #fff; font-size: 16px; margin-bottom: 5px; }
        .item-info p { color: #888; font-size: 12px; font-family: Arial, sans-serif; }
        .item-actions { display: flex; gap: 10px; }
        .btn-small {
            padding: 6px 12px; font-size: 11px; border: none; cursor: pointer;
            text-transform: uppercase; font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            border-radius: 4px;
        }
        .btn-edit { background: #c0c0c0; color: #000; }
        .btn-delete { background: #8b0000; color: #fff; }

        .alert {
            padding: 15px; border-radius: 4px; margin-bottom: 20px; font-family: Arial, sans-serif;
        }
        .alert-success { background: rgba(0,100,0,0.2); border: 2px solid #006400; color: #00ff00; }
        .alert-error { background: rgba(139,0,0,0.2); border: 2px solid #8b0000; color: #ff6666; }

        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        .grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        @media (max-width: 768px) {
            .grid-2, .grid-3 { grid-template-columns: 1fr; }
            .item-card { flex-direction: column; align-items: flex-start; gap: 15px; }
            .header { flex-direction: column; gap: 10px; }
            .header h1 { font-size: 20px; }
        }

        .status-badge {
            display: inline-block; padding: 4px 12px; border-radius: 20px;
            font-size: 11px; text-transform: uppercase; margin-left: 10px;
        }
        .status-active { background: rgba(0,100,0,0.3); color: #00ff00; border: 1px solid #006400; }
        .status-inactive { background: rgba(139,0,0,0.3); color: #ff6666; border: 1px solid #8b0000; }

        .checkbox-group { display: flex; align-items: center; gap: 10px; margin-top: 10px; }
        .loading { text-align: center; padding: 40px; color: #8b0000; }
        .empty-state { text-align: center; padding: 60px 20px; color: #666; }
        .empty-state h3 { color: #8b0000; font-size: 24px; margin-bottom: 10px; }
        .sub-section { margin-top: 30px; padding-top: 20px; border-top: 2px solid #333; }
        .sub-title { font-size: 18px; color: #c0c0c0; margin-bottom: 15px; text-transform: uppercase; }
        .array-item {
            background: #1a1a1a; border: 2px solid #333; border-radius: 6px;
            padding: 15px; margin-bottom: 10px; position: relative;
        }
        .array-item:hover { border-color: #8b0000; }
        .remove-array-item {
            position: absolute; top: 10px; right: 10px; background: #8b0000; color: #fff;
            border: none; width: 24px; height: 24px; border-radius: 50%; cursor: pointer;
            font-size: 16px; line-height: 1;
        }
        .poster-carousel-list {
            background: #1a1a1a;
            border: 2px solid #333;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        .carousel-image-item {
            display: flex;
            gap: 10px;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: #0a0a0a;
            border-radius: 4px;
        }
        .hidden { display: none !important; }
        .preview-img {
            max-width: 100px;
            max-height: 100px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .data-source-info {
            background: #1a1a1a;
            border: 1px solid #333;
            padding: 10px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-family: Arial, sans-serif;
            font-size: 12px;
            color: #888;
        }
        .data-source-info a {
            color: #8b0000;
            text-decoration: none;
        }
    </style>
</head>
<body>
    <div id="loginOverlay" class="login-overlay">
        <div class="login-box">
            <h1>LiveGigs Asia</h1>
            <p>后台管理系统</p>
            <input type="text" id="loginUser" placeholder="用户名" value="admin">
            <input type="password" id="loginPass" placeholder="密码">
            <div class="token-input">
                <input type="text" id="githubToken" placeholder="GitHub Token (用于同步)">
                <p class="help-text">需要repo权限的Personal Access Token</p>
            </div>
            <button onclick="doLogin()">登录</button>
            <p style="margin-top: 20px; color: #666; font-size: 11px;">
                30分钟无操作自动退出 | 关闭浏览器3分钟后需重新登录
            </p>
        </div>
    </div>

    <div id="mainContent" class="hidden">
        <div class="header">
            <h1>LiveGigs Asia - 后台管理</h1>
            <div class="header-info">
                <div id="syncStatus" class="sync-status pending">未同步</div>
                <button class="btn" onclick="syncToGitHub()">同步到GitHub</button>
                <button class="btn btn-secondary" onclick="downloadAllData()">下载所有数据</button>
                <button class="logout-btn" onclick="doLogout()">退出</button>
            </div>
        </div>

        <div class="container">
            <div id="alertContainer"></div>

            <div class="data-source-info">
                数据来源: <a href="https://github.com/EmanonEnt/asia/tree/main/content" target="_blank">https://github.com/EmanonEnt/asia/tree/main/content</a> | 
                前端URL: <a href="https://emanonent.github.io/asia/content/" target="_blank">https://emanonent.github.io/asia/content/</a>
            </div>

            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-number" id="statBanners">0</div>
                    <div class="stat-label">Banners</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statPosters">0</div>
                    <div class="stat-label">海报区域</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statEvents">0</div>
                    <div class="stat-label">自主活动</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statCarousel">0</div>
                    <div class="stat-label">滚播活动</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statPartners">0</div>
                    <div class="stat-label">合作伙伴</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="statCollabs">0</div>
                    <div class="stat-label">合作Logo</div>
                </div>
            </div>

            <div class="nav-tabs">
                <button class="nav-tab active" onclick="showSection('banners')">1. Banner管理</button>
                <button class="nav-tab" onclick="showSection('posters')">2. 海报区域</button>
                <button class="nav-tab" onclick="showSection('events')">3. 自主活动</button>
                <button class="nav-tab" onclick="showSection('carousel')">4. 滚播活动</button>
                <button class="nav-tab" onclick="showSection('partners')">5. 合作伙伴</button>
                <button class="nav-tab" onclick="showSection('footer')">6. 底部区域</button>
            </div>

            <!-- 1. Banner管理 -->
            <div id="banners" class="section active">
                <h2 class="section-title">Banner 管理 (index + cn 同步)</h2>
                <p class="help-text" style="margin-bottom: 20px;">尺寸: 1920×1080px (16:9) | 最多5个 | 可服务器地址或网络地址</p>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">添加/编辑 Banner</h3>
                    <form id="bannerForm">
                        <input type="hidden" id="bannerEditIndex" value="">
                        <div class="grid-2">
                            <div class="form-group">
                                <label>标题 *</label>
                                <input type="text" id="bannerTitle" placeholder="例如: THE NONAME FESTIVAL">
                            </div>
                            <div class="form-group">
                                <label>排序 (1-5)</label>
                                <input type="number" id="bannerOrder" value="1" min="1" max="5">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>海报图片 * (支持本地路径或网络URL)</label>
                            <input type="text" id="bannerImage" placeholder="./image/banner.jpg 或 https://..." onchange="previewImage('bannerImage', 'bannerPreview')">
                            <img id="bannerPreview" class="preview-img hidden" alt="预览">
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>按钮文字</label>
                                <input type="text" id="bannerButton" placeholder="View Details →">
                            </div>
                            <div class="form-group">
                                <label>链接地址</label>
                                <input type="text" id="bannerLink" placeholder="./events.html">
                            </div>
                        </div>
                        <div>
                            <button type="button" class="btn btn-success" onclick="saveBanner()">保存 Banner</button>
                            <button type="button" class="btn btn-secondary" onclick="resetBannerForm()">重置</button>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">现有 Banner 列表</h3>
                    <div id="bannerList"></div>
                </div>
            </div>

            <!-- 2. 海报区域管理 -->
            <div id="posters" class="section">
                <h2 class="section-title">海报 FLYERS 区域管理</h2>
                <p class="help-text" style="margin-bottom: 20px;">尺寸: 400×600px (2:3) | 每页固定3个海报 | events页面海报2支持1-5张滚播</p>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">选择页面</h3>
                    <div class="form-group">
                        <select id="posterPage" onchange="loadPosters()">
                            <option value="index">首页 (index.html)</option>
                            <option value="cn">国内站 (cn.html)</option>
                            <option value="events">活动页 (events.html)</option>
                        </select>
                    </div>
                </div>

                <!-- 海报1 -->
                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">海报 1 (左侧)</h3>
                    <form id="poster1Form">
                        <div class="form-group">
                            <label>标题 (可选)</label>
                            <input type="text" id="poster1_title" placeholder="海报标题">
                        </div>
                        <div class="form-group">
                            <label>海报图片 * (支持本地路径或网络URL)</label>
                            <input type="text" id="poster1_image" placeholder="./image/poster1.jpg 或 https://..." onchange="previewPosterImage(1)">
                            <img id="poster1_preview" class="preview-img hidden" alt="预览">
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>链接文字</label>
                                <input type="text" id="poster1_linkText" placeholder="View Details →">
                            </div>
                            <div class="form-group">
                                <label>链接地址</label>
                                <input type="text" id="poster1_link" placeholder="./events.html">
                            </div>
                        </div>
                    </form>
                </div>

                <!-- 海报2 -->
                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">海报 2 (中间) - 支持滚播</h3>
                    <form id="poster2Form">
                        <div class="form-group">
                            <label>标题 (可选)</label>
                            <input type="text" id="poster2_title" placeholder="海报标题 (如: Epic Past Gigs)">
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="poster2_carousel" onchange="togglePoster2Carousel()">
                            <label for="poster2_carousel">启用滚播模式 (最少1张，最多5张，≥2张时自动滚播)</label>
                        </div>

                        <!-- 单图模式 -->
                        <div id="poster2_single">
                            <div class="form-group">
                                <label>海报图片 *</label>
                                <input type="text" id="poster2_image_single" placeholder="./image/poster2.jpg">
                            </div>
                        </div>

                        <!-- 滚播模式 -->
                        <div id="poster2_carousel_mode" class="hidden">
                            <div class="poster-carousel-list">
                                <h4 style="color: #c0c0c0; margin-bottom: 15px;">滚播图片列表 (1-5张)</h4>
                                <div id="poster2_carousel_images"></div>
                                <button type="button" class="btn" onclick="addPoster2CarouselImage()">添加滚播图片</button>
                            </div>
                        </div>

                        <img id="poster2_preview" class="preview-img hidden" alt="预览">

                        <div class="grid-2">
                            <div class="form-group">
                                <label>链接文字</label>
                                <input type="text" id="poster2_linkText" placeholder="View Details →">
                            </div>
                            <div class="form-group">
                                <label>链接地址</label>
                                <input type="text" id="poster2_link" placeholder="./events.html">
                            </div>
                        </div>
                    </form>
                </div>

                <!-- 海报3 -->
                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">海报 3 (右侧)</h3>
                    <form id="poster3Form">
                        <div class="form-group">
                            <label>标题 (可选)</label>
                            <input type="text" id="poster3_title" placeholder="海报标题">
                        </div>
                        <div class="form-group">
                            <label>海报图片 * (支持本地路径或网络URL)</label>
                            <input type="text" id="poster3_image" placeholder="./image/poster3.jpg" onchange="previewPosterImage(3)">
                            <img id="poster3_preview" class="preview-img hidden" alt="预览">
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>链接文字</label>
                                <input type="text" id="poster3_linkText" placeholder="View Details →">
                            </div>
                            <div class="form-group">
                                <label>链接地址</label>
                                <input type="text" id="poster3_link" placeholder="./events.html">
                            </div>
                        </div>
                    </form>
                </div>

                <div class="card">
                    <button class="btn btn-success" onclick="savePosters()">保存所有海报设置</button>
                    <button class="btn btn-secondary" onclick="resetPostersForm()">重置</button>
                </div>
            </div>

            <!-- 3. 自主活动 -->
            <div id="events" class="section">
                <h2 class="section-title">自主 Events 活动管理</h2>
                <p class="help-text" style="margin-bottom: 20px;">尺寸: 400×600px (2:3) | 最少1个最多9个 | ≤3个无Load More按钮</p>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">添加/编辑活动</h3>
                    <form id="eventForm">
                        <input type="hidden" id="eventEditIndex" value="">
                        <div class="grid-2">
                            <div class="form-group">
                                <label>活动标题 *</label>
                                <input type="text" id="eventTitle" placeholder="活动名称">
                            </div>
                            <div class="form-group">
                                <label>日期</label>
                                <input type="text" id="eventDate" placeholder="2026.03.15">
                            </div>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>地点</label>
                                <input type="text" id="eventLocation" placeholder="演出地点">
                            </div>
                            <div class="form-group">
                                <label>时间</label>
                                <input type="text" id="eventTime" placeholder="20:00">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>海报图片 * (支持本地路径或网络URL)</label>
                            <input type="text" id="eventImage" placeholder="./image/event.jpg" onchange="previewEventImage()">
                            <img id="eventPreview" class="preview-img hidden" alt="预览">
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>门票</label>
                                <input type="text" id="eventTicket" placeholder="$50">
                            </div>
                            <div class="form-group">
                                <label>状态</label>
                                <select id="eventStatus">
                                    <option value="">正常 (倒计时)</option>
                                    <option value="ontour">ON TOUR</option>
                                    <option value="soldout">SOLD OUT</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>详情</label>
                            <textarea id="eventDesc" rows="3" placeholder="活动描述..."></textarea>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>按钮文字</label>
                                <input type="text" id="eventButton" value="Get Tickets →">
                            </div>
                            <div class="form-group">
                                <label>链接地址</label>
                                <input type="text" id="eventLink" placeholder="购票链接">
                            </div>
                        </div>
                        <button type="button" class="btn btn-success" onclick="saveEvent()">保存活动</button>
                        <button type="button" class="btn btn-secondary" onclick="resetEventForm()">重置</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">活动列表</h3>
                    <div id="eventList"></div>
                </div>
            </div>

            <!-- 4. 滚播活动 -->
            <div id="carousel" class="section">
                <h2 class="section-title">滚播推荐活动管理</h2>
                <p class="help-text" style="margin-bottom: 20px;">尺寸: 1920×1080px (16:9) | 最少3个最多12个 | 循环播放</p>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">添加/编辑滚播活动</h3>
                    <form id="carouselForm">
                        <input type="hidden" id="carouselEditIndex" value="">
                        <div class="grid-2">
                            <div class="form-group">
                                <label>标题 *</label>
                                <input type="text" id="carouselTitle" placeholder="活动标题">
                            </div>
                            <div class="form-group">
                                <label>时间</label>
                                <input type="text" id="carouselTime" placeholder="2026.03.15">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>地点</label>
                            <input type="text" id="carouselLocation" placeholder="演出地点">
                        </div>
                        <div class="form-group">
                            <label>海报图片 * (支持本地路径或网络URL)</label>
                            <input type="text" id="carouselImage" placeholder="./image/carousel.jpg" onchange="previewCarouselImage()">
                            <img id="carouselPreview" class="preview-img hidden" alt="预览">
                        </div>
                        <div class="form-group">
                            <label>详情</label>
                            <textarea id="carouselDesc" rows="3" placeholder="活动详情..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>链接地址 (留空则不能点击)</label>
                            <input type="text" id="carouselLink" placeholder="https://...">
                        </div>
                        <button type="button" class="btn btn-success" onclick="saveCarousel()">保存滚播活动</button>
                        <button type="button" class="btn btn-secondary" onclick="resetCarouselForm()">重置</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">滚播活动列表</h3>
                    <div id="carouselList"></div>
                </div>
            </div>

            <!-- 5. 合作伙伴 -->
            <div id="partners" class="section">
                <h2 class="section-title">合作伙伴管理</h2>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">合作 Banner (最多9个)</h3>
                    <p class="help-text" style="margin-bottom: 20px;">主海报: 1920×800px | Logo图: 根据类型自动调整</p>

                    <form id="partnerBannerForm">
                        <input type="hidden" id="partnerBannerEditIndex" value="">
                        <div class="form-group">
                            <label>主海报图片 * (支持本地路径或网络URL)</label>
                            <input type="text" id="partnerBannerImage" placeholder="./image/p-banner.jpg" onchange="previewPartnerBannerImage()">
                            <img id="partnerBannerPreview" class="preview-img hidden" alt="预览">
                        </div>
                        <div class="form-group">
                            <label>Logo图片</label>
                            <input type="text" id="partnerBannerLogo" placeholder="./image/p-logo.png">
                        </div>
                        <div class="form-group">
                            <label>标题文字</label>
                            <input type="text" id="partnerBannerTitle" placeholder="标题">
                        </div>
                        <div class="form-group">
                            <label>详情文字</label>
                            <textarea id="partnerBannerDesc" rows="3" placeholder="详情描述..."></textarea>
                        </div>
                        <div class="grid-2">
                            <div class="form-group">
                                <label>按钮文字</label>
                                <input type="text" id="partnerBannerButton" placeholder="了解更多 →">
                            </div>
                            <div class="form-group">
                                <label>链接地址</label>
                                <input type="text" id="partnerBannerLink" placeholder="https://...">
                            </div>
                        </div>
                        <button type="button" class="btn btn-success" onclick="savePartnerBanner()">保存 Banner</button>
                        <button type="button" class="btn btn-secondary" onclick="resetPartnerBannerForm()">重置</button>
                    </form>

                    <div class="sub-section">
                        <h4 class="sub-title">现有 Banner 列表</h4>
                        <div id="partnerBannerList"></div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">合作 Logo 区域 (最多9个)</h3>
                    <p class="help-text" style="margin-bottom: 20px;">尺寸: 180×110px | >6个自动换行居中</p>

                    <form id="collabLogoForm">
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Logo图片 * (支持本地路径或网络URL)</label>
                                <input type="text" id="collabLogoImage" placeholder="./image/logo.png" onchange="previewCollabLogoImage()">
                                <img id="collabLogoPreview" class="preview-img hidden" alt="预览">
                            </div>
                            <div class="form-group">
                                <label>名称文字</label>
                                <input type="text" id="collabLogoName" placeholder="合作伙伴名称">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>链接地址 (留空则不能点击)</label>
                            <input type="text" id="collabLogoLink" placeholder="https://...">
                        </div>
                        <button type="button" class="btn btn-success" onclick="saveCollabLogo()">添加 Logo</button>
                        <button type="button" class="btn btn-secondary" onclick="resetCollabLogoForm()">重置</button>
                    </form>

                    <div class="sub-section">
                        <h4 class="sub-title">现有 Logo 列表</h4>
                        <div id="collabLogoList"></div>
                    </div>
                </div>
            </div>

            <!-- 6. 底部区域 -->
            <div id="footer" class="section">
                <h2 class="section-title">底部区域管理</h2>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">选择站点</h3>
                    <div class="form-group">
                        <select id="footerSite" onchange="loadFooter()">
                            <option value="global">海外站 (Global) - index/events/partners/privacy/accessibility</option>
                            <option value="cn">国内站 (CN) - 独立更新</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <h3 style="color: #8b0000; margin-bottom: 20px;">编辑底部内容</h3>
                    <form id="footerForm">
                        <div class="form-group">
                            <label>标题 (LIVEGIGS ASIA)</label>
                            <input type="text" id="footerTitle" value="LIVEGIGS ASIA">
                        </div>
                        <div class="form-group">
                            <label>联系文字</label>
                            <input type="text" id="footerContact" value="Contact us for bookings and inquiries">
                        </div>
                        <div class="form-group">
                            <label>地址文字</label>
                            <input type="text" id="footerAddress" value="info@livegigsasia.com">
                        </div>
                        <div class="form-group">
                            <label>版权文字</label>
                            <input type="text" id="footerCopyright" value="Copyright © 2001-2026 EMANON ENTERTAINMENT">
                        </div>
                        <div class="form-group">
                            <label>制作单位Logo (支持本地路径或网络URL)</label>
                            <input type="text" id="footerProducer" value="./image/emanonent-logo.png">
                        </div>

                        <div class="sub-section">
                            <h4 class="sub-title">社交媒体图标 (最多10个)</h4>
                            <p class="help-text">支持: facebook, instagram, youtube, x, weibo, xiaohongshu, wechat, miniprogram</p>
                            <div id="socialIconsList"></div>
                            <button type="button" class="btn" onclick="addSocialIcon()" style="margin-top: 15px;">添加社交媒体</button>
                        </div>

                        <button type="button" class="btn btn-success" onclick="saveFooter()" style="margin-top: 20px;">保存底部设置</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>

// ==================== 全局数据存储 ====================
        let appData = {
            banners: [],
            posters: { index: [{}, {}, {}], cn: [{}, {}, {}], events: [{}, {}, {}] },
            events: [],
            carousel: [],
            partnerBanners: [],
            collabLogos: [],
            footerGlobal: { title: "LIVEGIGS ASIA", contact: "", address: "", copyright: "", producer: "", social: [] },
            footerCN: { title: "LIVEGIGS ASIA", contact: "", address: "", copyright: "", producer: "", social: [] }
        };

        let githubToken = '';
        let lastActivity = Date.now();
        let dataLoaded = false;
        const socialIcons = ['facebook','instagram','youtube','x','weibo','xiaohongshu','wechat','miniprogram'];

        // GitHub raw 内容地址（避免CORS）
        const GITHUB_RAW_BASE = 'https://raw.githubusercontent.com/EmanonEnt/asia/main/content';
        const GITHUB_PAGES_BASE = 'https://emanonent.github.io/asia/content';

        // ==================== 初始化 ====================
        document.addEventListener('DOMContentLoaded', function() {
            checkLogin();
            // 30分钟无操作检测
            setInterval(() => {
                if (Date.now() - lastActivity > 30 * 60 * 1000) {
                    alert('30分钟无操作，自动退出');
                    doLogout();
                }
            }, 60000);
        });

        document.addEventListener('click', () => lastActivity = Date.now());
        document.addEventListener('keypress', () => lastActivity = Date.now());

        // ==================== 登录/退出 ====================
        function checkLogin() {
            const session = localStorage.getItem('lg_session');
            const closed = localStorage.getItem('lg_closed');

            // 检查是否3分钟内关闭过浏览器
            if (closed && Date.now() - parseInt(closed) < 3 * 60 * 1000) {
                localStorage.removeItem('lg_closed');
            }

            if (session) {
                const data = JSON.parse(session);
                if (data.expires > Date.now()) {
                    githubToken = data.token || '';
                    document.getElementById('githubToken').value = githubToken;
                    showMain();
                    // 登录后自动加载数据
                    setTimeout(loadAllData, 100);
                } else {
                    localStorage.removeItem('lg_session');
                }
            }
        }

        function doLogin() {
            const user = document.getElementById('loginUser').value;
            const pass = document.getElementById('loginPass').value;
            githubToken = document.getElementById('githubToken').value.trim();

            if (user === 'admin' && pass === '00123456a') {
                localStorage.setItem('lg_session', JSON.stringify({
                    user, 
                    token: githubToken, 
                    expires: Date.now() + 30 * 60 * 1000
                }));
                localStorage.removeItem('lg_closed');
                showMain();
                loadAllData();
                showAlert('登录成功！正在加载数据...', 'success');
            } else {
                showAlert('用户名或密码错误', 'error');
            }
        }

        function doLogout() {
            localStorage.setItem('lg_closed', Date.now().toString());
            localStorage.removeItem('lg_session');
            location.reload();
        }

        function showMain() {
            document.getElementById('loginOverlay').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        function showAlert(msg, type) {
            const div = document.createElement('div');
            div.className = 'alert alert-' + type;
            div.textContent = msg;
            const container = document.getElementById('alertContainer');
            container.innerHTML = '';
            container.appendChild(div);
            setTimeout(() => div.remove(), 5000);
        }

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            event.target.classList.add('active');

            if (id === 'banners') renderBanners();
            if (id === 'posters') loadPosters();
            if (id === 'events') renderEvents();
            if (id === 'carousel') renderCarousel();
            if (id === 'partners') { renderPartnerBanners(); renderCollabLogos(); }
            if (id === 'footer') loadFooter();
        }

        // ==================== 数据加载（修复版）====================
        async function loadAllData() {
            const statusEl = document.getElementById('syncStatus');
            statusEl.textContent = '加载中...';
            statusEl.className = 'sync-status pending';

            // 定义所有要加载的文件
            const filesToLoad = [
                { key: 'banners', file: 'banners.json', defaultValue: [] },
                { key: 'postersIndex', file: 'posters-index.json', defaultValue: [{}, {}, {}] },
                { key: 'postersCN', file: 'posters-cn.json', defaultValue: [{}, {}, {}] },
                { key: 'postersEvents', file: 'posters-events.json', defaultValue: [{}, {}, {}] },
                { key: 'events', file: 'events-managed.json', defaultValue: [] },
                { key: 'carousel', file: 'carousel.json', defaultValue: [] },
                { key: 'partnerBanners', file: 'partners-banners.json', defaultValue: [] },
                { key: 'collabLogos', file: 'collaborators.json', defaultValue: [] },
                { key: 'footerGlobal', file: 'footer-global.json', defaultValue: { title: "LIVEGIGS ASIA", social: [] } },
                { key: 'footerCN', file: 'footer-cn.json', defaultValue: { title: "LIVEGIGS ASIA", social: [] } }
            ];

            let loadedCount = 0;
            let errorCount = 0;

            for (let item of filesToLoad) {
                try {
                    // 尝试从GitHub Raw加载（避免CORS）
                    let data = await fetchJSON(`${GITHUB_RAW_BASE}/${item.file}`);

                    // 如果失败，尝试GitHub Pages
                    if (!data) {
                        data = await fetchJSON(`${GITHUB_PAGES_BASE}/${item.file}`);
                    }

                    // 如果都失败，使用默认值
                    if (!data) {
                        data = item.defaultValue;
                        console.log(`使用默认值: ${item.file}`);
                    } else {
                        loadedCount++;
                        console.log(`加载成功: ${item.file}`);
                    }

                    // 保存到appData
                    if (item.key.startsWith('posters')) {
                        const page = item.key.replace('posters', '').toLowerCase();
                        appData.posters[page] = Array.isArray(data) && data.length === 3 ? data : [{}, {}, {}];
                    } else {
                        appData[item.key] = data;
                    }
                } catch (e) {
                    console.error(`加载失败 ${item.file}:`, e);
                    errorCount++;
                    // 使用默认值
                    if (item.key.startsWith('posters')) {
                        const page = item.key.replace('posters', '').toLowerCase();
                        appData.posters[page] = [{}, {}, {}];
                    } else {
                        appData[item.key] = item.defaultValue;
                    }
                }
            }

            // 确保poster数据完整性
            ['index', 'cn', 'events'].forEach(page => {
                if (!appData.posters[page] || !Array.isArray(appData.posters[page])) {
                    appData.posters[page] = [{}, {}, {}];
                }
                while (appData.posters[page].length < 3) {
                    appData.posters[page].push({});
                }
            });

            dataLoaded = true;
            updateStats();

            // 更新状态显示
            if (loadedCount === filesToLoad.length) {
                statusEl.textContent = '数据已加载';
                statusEl.className = 'sync-status success';
                showAlert(`成功加载 ${loadedCount} 个数据文件！`, 'success');
            } else if (loadedCount > 0) {
                statusEl.textContent = '部分加载';
                statusEl.className = 'sync-status pending';
                showAlert(`加载了 ${loadedCount}/${filesToLoad.length} 个文件，部分使用默认数据`, 'success');
            } else {
                statusEl.textContent = '加载失败';
                statusEl.className = 'sync-status error';
                showAlert('数据加载失败，请检查网络连接', 'error');
            }

            // 渲染当前页面
            renderBanners();
        }

        async function fetchJSON(url) {
            try {
                const res = await fetch(url + '?t=' + Date.now());
                if (!res.ok) return null;
                return await res.json();
            } catch (e) {
                return null;
            }
        }

        function updateStats() {
            document.getElementById('statBanners').textContent = appData.banners?.length || 0;
            document.getElementById('statPosters').textContent = '3页面×3';
            document.getElementById('statEvents').textContent = appData.events?.length || 0;
            document.getElementById('statCarousel').textContent = appData.carousel?.length || 0;
            document.getElementById('statPartners').textContent = appData.partnerBanners?.length || 0;
            document.getElementById('statCollabs').textContent = appData.collabLogos?.length || 0;
        }

        // ==================== Banner管理 ====================
        function renderBanners() {
            const list = document.getElementById('bannerList');
            if (!appData.banners || appData.banners.length === 0) {
                list.innerHTML = '<div class="empty-state"><h3>暂无 Banner</h3><p>点击上方表单添加</p></div>';
                return;
            }

            // 按排序排序
            const sorted = [...appData.banners].sort((a,b) => (a.order||0)-(b.order||0));

            list.innerHTML = sorted.map((b,i) => `
                <div class="item-card">
                    <div class="item-info">
                        <h4>${b.title || '未命名'}</h4>
                        <p>排序: ${b.order || '-'} | 按钮: ${b.button_text || '-'} | 链接: ${b.link || '-'}</p>
                        ${b.image ? `<img src="${b.image}" style="max-width:100px;max-height:60px;margin-top:5px;border-radius:4px;" onerror="this.style.display='none'">` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn-small btn-edit" onclick="editBanner(${i})">编辑</button>
                        <button class="btn-small btn-delete" onclick="deleteBanner(${i})">删除</button>
                    </div>
                </div>
            `).join('');
        }

        function previewImage(inputId, imgId) {
            const url = document.getElementById(inputId).value;
            const img = document.getElementById(imgId);
            if (url) {
                img.src = url;
                img.classList.remove('hidden');
                img.onerror = () => { img.classList.add('hidden'); };
            }
        }

        function saveBanner() {
            const idx = document.getElementById('bannerEditIndex').value;
            const banner = {
                title: document.getElementById('bannerTitle').value.trim(),
                image: document.getElementById('bannerImage').value.trim(),
                button_text: document.getElementById('bannerButton').value.trim(),
                link: document.getElementById('bannerLink').value.trim(),
                order: parseInt(document.getElementById('bannerOrder').value) || 1
            };

            if (!banner.title || !banner.image) {
                showAlert('请填写标题和图片', 'error'); 
                return;
            }

            if (idx !== '') {
                appData.banners[parseInt(idx)] = banner;
            } else {
                if (appData.banners.length >= 5) {
                    showAlert('最多5个Banner', 'error'); 
                    return;
                }
                appData.banners.push(banner);
            }

            resetBannerForm();
            renderBanners();
            updateStats();
            showAlert('保存成功！请点击"同步到GitHub"', 'success');
        }

        function resetBannerForm() {
            document.getElementById('bannerForm').reset();
            document.getElementById('bannerEditIndex').value = '';
            document.getElementById('bannerPreview').classList.add('hidden');
        }

        function editBanner(i) {
            const b = appData.banners[i];
            document.getElementById('bannerEditIndex').value = i;
            document.getElementById('bannerTitle').value = b.title || '';
            document.getElementById('bannerImage').value = b.image || '';
            document.getElementById('bannerButton').value = b.button_text || '';
            document.getElementById('bannerLink').value = b.link || '';
            document.getElementById('bannerOrder').value = b.order || 1;
            previewImage('bannerImage', 'bannerPreview');
            window.scrollTo(0, 0);
        }

        function deleteBanner(i) {
            if (!confirm('确定删除此Banner？')) return;
            appData.banners.splice(i, 1);
            renderBanners();
            updateStats();
            showAlert('删除成功！请点击"同步到GitHub"', 'success');
        }

        // ==================== 海报区域管理 ====================
        function loadPosters() {
            if (!dataLoaded) {
                showAlert('数据还在加载中，请稍候...', 'error');
                return;
            }

            const page = document.getElementById('posterPage').value;
            const posters = appData.posters[page] || [{}, {}, {}];

            // 海报1
            document.getElementById('poster1_title').value = posters[0]?.title || '';
            document.getElementById('poster1_image').value = posters[0]?.image || '';
            document.getElementById('poster1_linkText').value = posters[0]?.link_text || '';
            document.getElementById('poster1_link').value = posters[0]?.link || '';
            previewPosterImage(1);

            // 海报2
            document.getElementById('poster2_title').value = posters[1]?.title || '';
            document.getElementById('poster2_linkText').value = posters[1]?.link_text || '';
            document.getElementById('poster2_link').value = posters[1]?.link || '';

            const isCarousel = posters[1]?.carousel || false;
            document.getElementById('poster2_carousel').checked = isCarousel;
            togglePoster2Carousel();

            if (isCarousel && posters[1]?.carouselImages && Array.isArray(posters[1].carouselImages)) {
                renderPoster2CarouselImages(posters[1].carouselImages);
            } else {
                document.getElementById('poster2_carousel_images').innerHTML = '';
            }

            if (!isCarousel) {
                document.getElementById('poster2_image_single').value = posters[1]?.image || '';
            }
            previewPosterImage(2);

            // 海报3
            document.getElementById('poster3_title').value = posters[2]?.title || '';
            document.getElementById('poster3_image').value = posters[2]?.image || '';
            document.getElementById('poster3_linkText').value = posters[2]?.link_text || '';
            document.getElementById('poster3_link').value = posters[2]?.link || '';
            previewPosterImage(3);
        }

        function togglePoster2Carousel() {
            const isCarousel = document.getElementById('poster2_carousel').checked;
            document.getElementById('poster2_single').classList.toggle('hidden', isCarousel);
            document.getElementById('poster2_carousel_mode').classList.toggle('hidden', !isCarousel);
        }

        function renderPoster2CarouselImages(images) {
            const container = document.getElementById('poster2_carousel_images');
            container.innerHTML = (images || []).map((img, i) => `
                <div class="carousel-image-item">
                    <input type="text" value="${img}" placeholder="图片地址" style="flex:1;" class="carousel-img-input">
                    <button type="button" class="btn-small btn-delete" onclick="this.parentElement.remove()">删除</button>
                </div>
            `).join('');
        }

        function addPoster2CarouselImage() {
            const container = document.getElementById('poster2_carousel_images');
            const count = container.querySelectorAll('.carousel-image-item').length;
            if (count >= 5) {
                showAlert('最多5张滚播图片', 'error');
                return;
            }
            const div = document.createElement('div');
            div.className = 'carousel-image-item';
            div.innerHTML = `
                <input type="text" placeholder="图片地址 (支持本地或网络URL)" style="flex:1;" class="carousel-img-input">
                <button type="button" class="btn-small btn-delete" onclick="this.parentElement.remove()">删除</button>
            `;
            container.appendChild(div);
        }

        function previewPosterImage(num) {
            const url = document.getElementById(`poster${num}_image`)?.value || 
                       document.getElementById(`poster${num}_image_single`)?.value;
            const img = document.getElementById(`poster${num}_preview`);
            if (url && img) {
                img.src = url;
                img.classList.remove('hidden');
                img.onerror = () => { img.classList.add('hidden'); };
            }
        }

        function savePosters() {
            const page = document.getElementById('posterPage').value;

            // 海报1
            appData.posters[page][0] = {
                title: document.getElementById('poster1_title').value.trim(),
                image: document.getElementById('poster1_image').value.trim(),
                link_text: document.getElementById('poster1_linkText').value.trim(),
                link: document.getElementById('poster1_link').value.trim()
            };

            // 海报2
            const isCarousel = document.getElementById('poster2_carousel').checked;
            appData.posters[page][1] = {
                title: document.getElementById('poster2_title').value.trim(),
                link_text: document.getElementById('poster2_linkText').value.trim(),
                link: document.getElementById('poster2_link').value.trim(),
                carousel: isCarousel
            };

            if (isCarousel) {
                const inputs = document.querySelectorAll('#poster2_carousel_images .carousel-img-input');
                appData.posters[page][1].carouselImages = Array.from(inputs).map(i => i.value).filter(v => v);
                if (appData.posters[page][1].carouselImages.length > 0) {
                    appData.posters[page][1].image = appData.posters[page][1].carouselImages[0];
                }
            } else {
                appData.posters[page][1].image = document.getElementById('poster2_image_single').value.trim();
            }

            // 海报3
            appData.posters[page][2] = {
                title: document.getElementById('poster3_title').value.trim(),
                image: document.getElementById('poster3_image').value.trim(),
                link_text: document.getElementById('poster3_linkText').value.trim(),
                link: document.getElementById('poster3_link').value.trim()
            };

            showAlert('海报保存成功！请点击"同步到GitHub"', 'success');
        }

        function resetPostersForm() {
            loadPosters();
        }
// ==================== 活动管理 ====================
        function renderEvents() {
            const list = document.getElementById('eventList');
            if (!appData.events || appData.events.length === 0) {
                list.innerHTML = '<div class="empty-state"><h3>暂无活动</h3><p>点击上方表单添加</p></div>';
                return;
            }

            list.innerHTML = appData.events.map((e,i) => `
                <div class="item-card">
                    <div class="item-info">
                        <h4>${e.title || '未命名'} ${e.status ? `<span class="status-badge ${e.status==='soldout'?'status-inactive':'status-active'}">${e.status.toUpperCase()}</span>` : ''}</h4>
                        <p>${e.date || '-'} | ${e.location || '-'} | ${e.time || '-'} | ${e.ticket || '-'}</p>
                        ${e.image ? `<img src="${e.image}" style="max-width:80px;max-height:50px;margin-top:5px;border-radius:4px;" onerror="this.style.display='none'">` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn-small btn-edit" onclick="editEvent(${i})">编辑</button>
                        <button class="btn-small btn-delete" onclick="deleteEvent(${i})">删除</button>
                    </div>
                </div>
            `).join('');
        }

        function previewEventImage() {
            const url = document.getElementById('eventImage').value;
            const img = document.getElementById('eventPreview');
            if (url) {
                img.src = url;
                img.classList.remove('hidden');
                img.onerror = () => { img.classList.add('hidden'); };
            }
        }

        function saveEvent() {
            const idx = document.getElementById('eventEditIndex').value;
            const event = {
                title: document.getElementById('eventTitle').value.trim(),
                date: document.getElementById('eventDate').value.trim(),
                location: document.getElementById('eventLocation').value.trim(),
                time: document.getElementById('eventTime').value.trim(),
                image: document.getElementById('eventImage').value.trim(),
                ticket: document.getElementById('eventTicket').value.trim(),
                status: document.getElementById('eventStatus').value,
                description: document.getElementById('eventDesc').value.trim(),
                button_text: document.getElementById('eventButton').value.trim(),
                link: document.getElementById('eventLink').value.trim()
            };

            if (!event.title || !event.image) {
                showAlert('请填写标题和海报', 'error'); 
                return;
            }

            if (idx !== '') {
                appData.events[parseInt(idx)] = event;
            } else {
                if (appData.events.length >= 9) {
                    showAlert('最多9个活动', 'error'); 
                    return;
                }
                appData.events.push(event);
            }

            resetEventForm();
            renderEvents();
            updateStats();
            showAlert('保存成功！请点击"同步到GitHub"', 'success');
        }

        function resetEventForm() {
            document.getElementById('eventForm').reset();
            document.getElementById('eventEditIndex').value = '';
            document.getElementById('eventPreview').classList.add('hidden');
        }

        function editEvent(i) {
            const e = appData.events[i];
            document.getElementById('eventEditIndex').value = i;
            document.getElementById('eventTitle').value = e.title || '';
            document.getElementById('eventDate').value = e.date || '';
            document.getElementById('eventLocation').value = e.location || '';
            document.getElementById('eventTime').value = e.time || '';
            document.getElementById('eventImage').value = e.image || '';
            document.getElementById('eventTicket').value = e.ticket || '';
            document.getElementById('eventStatus').value = e.status || '';
            document.getElementById('eventDesc').value = e.description || '';
            document.getElementById('eventButton').value = e.button_text || '';
            document.getElementById('eventLink').value = e.link || '';
            previewEventImage();
            window.scrollTo(0, 0);
        }

        function deleteEvent(i) {
            if (!confirm('确定删除此活动？')) return;
            appData.events.splice(i, 1);
            renderEvents();
            updateStats();
            showAlert('删除成功！请点击"同步到GitHub"', 'success');
        }

        // ==================== 滚播管理 ====================
        function renderCarousel() {
            const list = document.getElementById('carouselList');
            if (!appData.carousel || appData.carousel.length === 0) {
                list.innerHTML = '<div class="empty-state"><h3>暂无滚播活动</h3><p>点击上方表单添加</p></div>';
                return;
            }

            list.innerHTML = appData.carousel.map((c,i) => `
                <div class="item-card">
                    <div class="item-info">
                        <h4>${c.title || '未命名'}</h4>
                        <p>${c.time || '-'} | ${c.location || '-'} | 链接: ${c.link || '无'}</p>
                        ${c.image ? `<img src="${c.image}" style="max-width:80px;max-height:50px;margin-top:5px;border-radius:4px;" onerror="this.style.display='none'">` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn-small btn-edit" onclick="editCarousel(${i})">编辑</button>
                        <button class="btn-small btn-delete" onclick="deleteCarousel(${i})">删除</button>
                    </div>
                </div>
            `).join('');
        }

        function previewCarouselImage() {
            const url = document.getElementById('carouselImage').value;
            const img = document.getElementById('carouselPreview');
            if (url) {
                img.src = url;
                img.classList.remove('hidden');
                img.onerror = () => { img.classList.add('hidden'); };
            }
        }

        function saveCarousel() {
            const idx = document.getElementById('carouselEditIndex').value;
            const item = {
                title: document.getElementById('carouselTitle').value.trim(),
                time: document.getElementById('carouselTime').value.trim(),
                location: document.getElementById('carouselLocation').value.trim(),
                image: document.getElementById('carouselImage').value.trim(),
                description: document.getElementById('carouselDesc').value.trim(),
                link: document.getElementById('carouselLink').value.trim()
            };

            if (!item.title || !item.image) {
                showAlert('请填写标题和海报', 'error'); 
                return;
            }

            if (idx !== '') {
                appData.carousel[parseInt(idx)] = item;
            } else {
                if (appData.carousel.length >= 12) {
                    showAlert('最多12个滚播', 'error'); 
                    return;
                }
                appData.carousel.push(item);
            }

            resetCarouselForm();
            renderCarousel();
            updateStats();
            showAlert('保存成功！请点击"同步到GitHub"', 'success');
        }

        function resetCarouselForm() {
            document.getElementById('carouselForm').reset();
            document.getElementById('carouselEditIndex').value = '';
            document.getElementById('carouselPreview').classList.add('hidden');
        }

        function editCarousel(i) {
            const c = appData.carousel[i];
            document.getElementById('carouselEditIndex').value = i;
            document.getElementById('carouselTitle').value = c.title || '';
            document.getElementById('carouselTime').value = c.time || '';
            document.getElementById('carouselLocation').value = c.location || '';
            document.getElementById('carouselImage').value = c.image || '';
            document.getElementById('carouselDesc').value = c.description || '';
            document.getElementById('carouselLink').value = c.link || '';
            previewCarouselImage();
            window.scrollTo(0, 0);
        }

        function deleteCarousel(i) {
            if (!confirm('确定删除此滚播活动？')) return;
            appData.carousel.splice(i, 1);
            renderCarousel();
            updateStats();
            showAlert('删除成功！请点击"同步到GitHub"', 'success');
        }

        // ==================== 合作伙伴管理 ====================
        function renderPartnerBanners() {
            const list = document.getElementById('partnerBannerList');
            if (!appData.partnerBanners || appData.partnerBanners.length === 0) {
                list.innerHTML = '<div class="empty-state"><h3>暂无 Banner</h3><p>点击上方表单添加</p></div>';
                return;
            }

            list.innerHTML = appData.partnerBanners.map((b,i) => `
                <div class="item-card">
                    <div class="item-info">
                        <h4>${b.title || '未命名'}</h4>
                        <p>按钮: ${b.button_text || '-'} | 链接: ${b.link || '-'}</p>
                        ${b.image ? `<img src="${b.image}" style="max-width:80px;max-height:50px;margin-top:5px;border-radius:4px;" onerror="this.style.display='none'">` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn-small btn-edit" onclick="editPartnerBanner(${i})">编辑</button>
                        <button class="btn-small btn-delete" onclick="deletePartnerBanner(${i})">删除</button>
                    </div>
                </div>
            `).join('');
        }

        function previewPartnerBannerImage() {
            const url = document.getElementById('partnerBannerImage').value;
            const img = document.getElementById('partnerBannerPreview');
            if (url) {
                img.src = url;
                img.classList.remove('hidden');
                img.onerror = () => { img.classList.add('hidden'); };
            }
        }

        function savePartnerBanner() {
            const idx = document.getElementById('partnerBannerEditIndex').value;
            const banner = {
                image: document.getElementById('partnerBannerImage').value.trim(),
                logo: document.getElementById('partnerBannerLogo').value.trim(),
                title: document.getElementById('partnerBannerTitle').value.trim(),
                description: document.getElementById('partnerBannerDesc').value.trim(),
                button_text: document.getElementById('partnerBannerButton').value.trim(),
                link: document.getElementById('partnerBannerLink').value.trim()
            };

            if (!banner.image) {
                showAlert('请填写主海报', 'error'); 
                return;
            }

            if (idx !== '') {
                appData.partnerBanners[parseInt(idx)] = banner;
            } else {
                if (appData.partnerBanners.length >= 9) {
                    showAlert('最多9个Banner', 'error'); 
                    return;
                }
                appData.partnerBanners.push(banner);
            }

            resetPartnerBannerForm();
            renderPartnerBanners();
            updateStats();
            showAlert('保存成功！请点击"同步到GitHub"', 'success');
        }

        function resetPartnerBannerForm() {
            document.getElementById('partnerBannerForm').reset();
            document.getElementById('partnerBannerEditIndex').value = '';
            document.getElementById('partnerBannerPreview').classList.add('hidden');
        }

        function editPartnerBanner(i) {
            const b = appData.partnerBanners[i];
            document.getElementById('partnerBannerEditIndex').value = i;
            document.getElementById('partnerBannerImage').value = b.image || '';
            document.getElementById('partnerBannerLogo').value = b.logo || '';
            document.getElementById('partnerBannerTitle').value = b.title || '';
            document.getElementById('partnerBannerDesc').value = b.description || '';
            document.getElementById('partnerBannerButton').value = b.button_text || '';
            document.getElementById('partnerBannerLink').value = b.link || '';
            previewPartnerBannerImage();
            window.scrollTo(0, 0);
        }

        function deletePartnerBanner(i) {
            if (!confirm('确定删除此Banner？')) return;
            appData.partnerBanners.splice(i, 1);
            renderPartnerBanners();
            updateStats();
            showAlert('删除成功！请点击"同步到GitHub"', 'success');
        }

        function renderCollabLogos() {
            const list = document.getElementById('collabLogoList');
            if (!appData.collabLogos || appData.collabLogos.length === 0) {
                list.innerHTML = '<div class="empty-state"><h3>暂无 Logo</h3><p>点击上方表单添加</p></div>';
                return;
            }

            list.innerHTML = appData.collabLogos.map((l,i) => `
                <div class="item-card">
                    <div class="item-info">
                        <h4>${l.name || '未命名'}</h4>
                        <p>链接: ${l.link || '无'}</p>
                        ${l.image ? `<img src="${l.image}" style="max-width:80px;max-height:50px;margin-top:5px;border-radius:4px;" onerror="this.style.display='none'">` : ''}
                    </div>
                    <div class="item-actions">
                        <button class="btn-small btn-edit" onclick="editCollabLogo(${i})">编辑</button>
                        <button class="btn-small btn-delete" onclick="deleteCollabLogo(${i})">删除</button>
                    </div>
                </div>
            `).join('');
        }

        function previewCollabLogoImage() {
            const url = document.getElementById('collabLogoImage').value;
            const img = document.getElementById('collabLogoPreview');
            if (url) {
                img.src = url;
                img.classList.remove('hidden');
                img.onerror = () => { img.classList.add('hidden'); };
            }
        }

        function saveCollabLogo() {
            const logo = {
                image: document.getElementById('collabLogoImage').value.trim(),
                name: document.getElementById('collabLogoName').value.trim(),
                link: document.getElementById('collabLogoLink').value.trim()
            };

            if (!logo.image) {
                showAlert('请填写Logo图片', 'error'); 
                return;
            }

            if (appData.collabLogos.length >= 9) {
                showAlert('最多9个Logo', 'error'); 
                return;
            }

            appData.collabLogos.push(logo);
            resetCollabLogoForm();
            renderCollabLogos();
            updateStats();
            showAlert('添加成功！请点击"同步到GitHub"', 'success');
        }

        function resetCollabLogoForm() {
            document.getElementById('collabLogoForm').reset();
            document.getElementById('collabLogoPreview').classList.add('hidden');
        }

        function editCollabLogo(i) {
            const l = appData.collabLogos[i];
            document.getElementById('collabLogoImage').value = l.image || '';
            document.getElementById('collabLogoName').value = l.name || '';
            document.getElementById('collabLogoLink').value = l.link || '';
            previewCollabLogoImage();
            appData.collabLogos.splice(i, 1);
            renderCollabLogos();
            updateStats();
        }

        function deleteCollabLogo(i) {
            if (!confirm('确定删除此Logo？')) return;
            appData.collabLogos.splice(i, 1);
            renderCollabLogos();
            updateStats();
            showAlert('删除成功！请点击"同步到GitHub"', 'success');
        }
// ==================== 底部管理 ====================
        function loadFooter() {
            if (!dataLoaded) {
                showAlert('数据还在加载中，请稍候...', 'error');
                return;
            }

            const site = document.getElementById('footerSite').value;
            const data = site === 'cn' ? appData.footerCN : appData.footerGlobal;

            document.getElementById('footerTitle').value = data?.title || 'LIVEGIGS ASIA';
            document.getElementById('footerContact').value = data?.contact || '';
            document.getElementById('footerAddress').value = data?.address || '';
            document.getElementById('footerCopyright').value = data?.copyright || '';
            document.getElementById('footerProducer').value = data?.producer || './image/emanonent-logo.png';

            renderSocialIcons(data?.social || []);
        }

        function renderSocialIcons(socials) {
            const container = document.getElementById('socialIconsList');
            if (!socials || socials.length === 0) {
                container.innerHTML = '<p style="color: #666;">暂无社交媒体</p>';
                return;
            }

            container.innerHTML = socials.map((s,i) => `
                <div class="array-item" style="margin-bottom: 10px;">
                    <button type="button" class="remove-array-item" onclick="removeSocialIcon(${i})">×</button>
                    <div class="grid-3">
                        <div class="form-group">
                            <label>名称</label>
                            <input type="text" id="social_name_${i}" value="${s.name || ''}" placeholder="Facebook">
                        </div>
                        <div class="form-group">
                            <label>链接</label>
                            <input type="text" id="social_url_${i}" value="${s.url || ''}" placeholder="https://...">
                        </div>
                        <div class="form-group">
                            <label>图标</label>
                            <select id="social_icon_${i}">
                                ${socialIcons.map(icon => `<option value="${icon}" ${s.icon===icon?'selected':''}>${icon}</option>`).join('')}
                            </select>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function addSocialIcon() {
            const site = document.getElementById('footerSite').value;
            const data = site === 'cn' ? appData.footerCN : appData.footerGlobal;

            if (!data.social) data.social = [];
            if (data.social.length >= 10) {
                showAlert('最多10个社交媒体', 'error'); 
                return;
            }

            data.social.push({name:'', url:'', icon:'facebook'});
            renderSocialIcons(data.social);
        }

        function removeSocialIcon(i) {
            const site = document.getElementById('footerSite').value;
            const data = site === 'cn' ? appData.footerCN : appData.footerGlobal;
            data.social.splice(i, 1);
            renderSocialIcons(data.social);
        }

        function saveFooter() {
            const site = document.getElementById('footerSite').value;
            const footer = {
                title: document.getElementById('footerTitle').value.trim(),
                contact: document.getElementById('footerContact').value.trim(),
                address: document.getElementById('footerAddress').value.trim(),
                copyright: document.getElementById('footerCopyright').value.trim(),
                producer: document.getElementById('footerProducer').value.trim(),
                social: []
            };

            const items = document.querySelectorAll('#socialIconsList .array-item');
            items.forEach((item, i) => {
                const name = document.getElementById(`social_name_${i}`)?.value?.trim();
                const url = document.getElementById(`social_url_${i}`)?.value?.trim();
                const icon = document.getElementById(`social_icon_${i}`)?.value;
                if (name) footer.social.push({name, url, icon});
            });

            if (site === 'cn') appData.footerCN = footer;
            else appData.footerGlobal = footer;

            showAlert('保存成功！请点击"同步到GitHub"', 'success');
        }

        // ==================== GitHub同步 ====================
        async function syncToGitHub() {
            if (!githubToken) {
                showAlert('未设置GitHub Token，请在登录时输入', 'error'); 
                return;
            }

            const status = document.getElementById('syncStatus');
            status.textContent = '同步中...';
            status.className = 'sync-status pending';

            const files = {
                'content/banners.json': JSON.stringify(appData.banners || [], null, 2),
                'content/posters-index.json': JSON.stringify(appData.posters?.index || [{}, {}, {}], null, 2),
                'content/posters-cn.json': JSON.stringify(appData.posters?.cn || [{}, {}, {}], null, 2),
                'content/posters-events.json': JSON.stringify(appData.posters?.events || [{}, {}, {}], null, 2),
                'content/events-managed.json': JSON.stringify(appData.events || [], null, 2),
                'content/carousel.json': JSON.stringify(appData.carousel || [], null, 2),
                'content/partners-banners.json': JSON.stringify(appData.partnerBanners || [], null, 2),
                'content/collaborators.json': JSON.stringify(appData.collabLogos || [], null, 2),
                'content/footer-global.json': JSON.stringify(appData.footerGlobal || { title: "LIVEGIGS ASIA", social: [] }, null, 2),
                'content/footer-cn.json': JSON.stringify(appData.footerCN || { title: "LIVEGIGS ASIA", social: [] }, null, 2)
            };

            let success = 0;
            let errors = [];

            for (let [path, content] of Object.entries(files)) {
                try {
                    // 先获取现有文件的SHA（如果存在）
                    let sha = null;
                    try {
                        const getRes = await fetch(`https://api.github.com/repos/EmanonEnt/asia/contents/${path}`, {
                            headers: { 'Authorization': `token ${githubToken}`, 'Accept': 'application/vnd.github.v3+json' }
                        });
                        if (getRes.ok) {
                            const fileData = await getRes.json();
                            sha = fileData.sha;
                        }
                    } catch(e) { /* 文件不存在，继续 */ }

                    // 上传文件
                    const body = { 
                        message: `Update ${path} via admin`, 
                        content: btoa(unescape(encodeURIComponent(content)))
                    };
                    if (sha) body.sha = sha;

                    const putRes = await fetch(`https://api.github.com/repos/EmanonEnt/asia/contents/${path}`, {
                        method: 'PUT',
                        headers: { 
                            'Authorization': `token ${githubToken}`, 
                            'Content-Type': 'application/json',
                            'Accept': 'application/vnd.github.v3+json'
                        },
                        body: JSON.stringify(body)
                    });

                    if (putRes.ok) {
                        success++;
                    } else {
                        const errorData = await putRes.json();
                        errors.push(`${path}: ${errorData.message || putRes.status}`);
                    }
                } catch(e) { 
                    errors.push(`${path}: ${e.message}`); 
                }
            }

            // 更新状态
            if (success === Object.keys(files).length) {
                const now = new Date();
                const time = `${now.getMonth()+1}月${now.getDate()}日 ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
                status.textContent = `同步成功 ${time}`;
                status.className = 'sync-status success';
                showAlert(`成功同步 ${success} 个文件！前端1-2分钟后自动更新`, 'success');
            } else if (success > 0) {
                status.textContent = `部分同步 (${success}/${Object.keys(files).length})`;
                status.className = 'sync-status pending';
                showAlert(`同步了 ${success} 个文件，部分失败: ${errors.join('; ')}`, 'error');
            } else {
                status.textContent = '同步失败';
                status.className = 'sync-status error';
                showAlert('同步失败: ' + errors.join('; '), 'error');
            }
        }

        function downloadAllData() {
            const data = {
                ...appData, 
                exportTime: new Date().toISOString(),
                version: '1.0'
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `livegigs-backup-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showAlert('数据备份下载成功', 'success');
        }
    </script>
</body>
</html>