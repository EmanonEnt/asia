<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveGigs Asia - 后台管理</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            background: #050505;
            color: #c0c0c0;
            min-height: 100vh;
        }
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #050505 0%, #1a0000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .login-box {
            background: rgba(139, 0, 0, 0.1);
            border: 2px solid #8b0000;
            padding: 50px;
            border-radius: 10px;
            text-align: center;
            min-width: 400px;
        }
        .login-box h1 {
            color: #8b0000;
            font-size: 36px;
            margin-bottom: 30px;
            letter-spacing: 3px;
        }
        .login-box input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #0a0a0a;
            border: 1px solid #8b0000;
            color: #c0c0c0;
            font-family: inherit;
            font-size: 16px;
        }
        .login-box button {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: #8b0000;
            color: #c0c0c0;
            border: none;
            font-family: inherit;
            font-size: 18px;
            cursor: pointer;
        }
        .admin-container {
            display: none;
            min-height: 100vh;
        }
        .admin-header {
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 3px solid #8b0000;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .admin-header h1 {
            color: #8b0000;
            font-size: 28px;
            letter-spacing: 2px;
        }
        .header-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .btn {
            padding: 10px 25px;
            background: #8b0000;
            color: #c0c0c0;
            border: none;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
        }
        .btn-success { background: #228b22; }
        .btn-secondary { background: #333; }
        .sync-status {
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 14px;
        }
        .sync-status.pending { background: #ff9800; color: #000; }
        .sync-status.synced { background: #4caf50; color: #fff; }
        .admin-body {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        .sidebar {
            width: 280px;
            background: #0a0a0a;
            border-right: 1px solid #8b0000;
            padding: 20px 0;
        }
        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .nav-item:hover, .nav-item.active {
            background: rgba(139, 0, 0, 0.3);
            border-left-color: #8b0000;
            color: #fff;
        }
        .nav-item .count {
            background: #8b0000;
            color: #c0c0c0;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 12px;
        }
        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        .section { display: none; }
        .section.active { display: block; }
        .section h2 {
            color: #8b0000;
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b0000;
        }
        .form-group {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }
        .form-group h3 {
            color: #c0c0c0;
            margin-bottom: 15px;
            font-size: 18px;
        }
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .form-field {
            display: flex;
            flex-direction: column;
        }
        .form-field label {
            color: #888;
            font-size: 12px;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .form-field input, .form-field textarea {
            padding: 10px;
            background: #050505;
            border: 1px solid #444;
            color: #c0c0c0;
            font-family: inherit;
        }
        .item-card {
            background: #0f0f0f;
            border: 1px solid #333;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .item-title { color: #8b0000; font-size: 16px; }
        .btn-small { padding: 5px 15px; font-size: 12px; }
        .btn-danger { background: #dc3545; }
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;
        }
        .alert-success { background: rgba(34, 139, 34, 0.2); border: 1px solid #228b22; color: #228b22; }
        .alert-error { background: rgba(220, 53, 69, 0.2); border: 1px solid #dc3545; color: #dc3545; }
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 30px;
            border-radius: 10px;
            border: 2px solid #8b0000;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>LIVEGIGS ASIA ADMIN</h1>
            <input type="text" id="username" placeholder="用户名" value="admin">
            <input type="password" id="password" placeholder="密码">
            <button onclick="login()">登录</button>
            <p style="color:#ff4444;margin-top:15px;display:none" id="loginError">用户名或密码错误</p>
        </div>
    </div>

    <div class="admin-container" id="adminContainer">
        <header class="admin-header">
            <h1>LIVEGIGS ASIA ADMIN</h1>
            <div class="header-actions">
                <span class="sync-status pending" id="syncStatus">未同步</span>
                <button class="btn btn-success" onclick="syncToGitHub()">同步到GitHub</button>
                <button class="btn btn-secondary" onclick="logout()">退出</button>
            </div>
        </header>

        <div class="admin-body">
            <nav class="sidebar">
                <div class="nav-item active" onclick="showSection('partners')">
                    <span>合作伙伴</span>
                    <span class="count" id="count-partners">0</span>
                </div>
            </nav>

            <main class="content">
                <div class="alert alert-success" id="alertSuccess"></div>
                <div class="alert alert-error" id="alertError"></div>

                <section class="section active" id="section-partners">
                    <h2>合作伙伴管理</h2>

                    <div class="form-group">
                        <h3>Partners Banners (最多9个)</h3>
                        <div id="partners-banners-list"></div>
                        <button class="btn" onclick="addPartnerBanner()" style="margin-top:15px">+ 添加Banner</button>
                    </div>

                    <div class="form-group">
                        <h3>合作Logo (最多9个)</h3>
                        <div id="collaborators-list"></div>
                        <button class="btn" onclick="addCollaborator()" style="margin-top:15px">+ 添加Logo</button>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <div class="loading" id="loading">
        <div style="text-align:center">
            <div style="width:40px;height:40px;border:3px solid #333;border-top-color:#8b0000;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto"></div>
            <p style="margin-top:15px;color:#c0c0c0">同步中...</p>
        </div>
    </div>

    <script>
        const CONFIG = {
            username: 'admin',
            password: '00123456a',
            githubRepo: 'EmanonEnt/asia',
            githubToken: localStorage.getItem('github_token') || ''
        };

        let adminData = {
            partnersBanners: [],
            collaborators: []
        };

        let hasChanges = false;

        function login() {
            const u = document.getElementById('username').value;
            const p = document.getElementById('password').value;
            if (u === CONFIG.username && p === CONFIG.password) {
                localStorage.setItem('admin_logged_in', 'true');
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('adminContainer').style.display = 'block';
                loadData();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function logout() {
            localStorage.removeItem('admin_logged_in');
            location.reload();
        }

        async function loadData() {
            // 从GitHub加载实际数据
            try {
                const bannersRes = await fetch('../content/partners-banners.json?v=' + Date.now());
                const collaboratorsRes = await fetch('../content/collaborators.json?v=' + Date.now());

                if (bannersRes.ok) {
                    const data = await bannersRes.json();
                    adminData.partnersBanners = data.banners || [];
                }
                if (collaboratorsRes.ok) {
                    const data = await collaboratorsRes.json();
                    adminData.collaborators = data.logos || [];
                }
            } catch (e) {
                console.error('加载失败:', e);
                // 使用默认数据
                initDefaultData();
            }

            renderAll();
            updateCounts();
            document.getElementById('syncStatus').textContent = '已同步';
            document.getElementById('syncStatus').className = 'sync-status synced';
        }

        function initDefaultData() {
            adminData.partnersBanners = [
                {title:'LIVEGIGS CN', details:'Head to our homepage...', buttonText:'Go to live gigs cn', link:'https://livegigs.cn', backgroundImage:'./image/p-p-1.jpg', logo:'./image/livegigscn1.png'},
                {title:'小子聯盟唱片', details:'', buttonText:'访问网站', link:'https://kids-union.com', backgroundImage:'./image/p-p-2.jpg', logo:''},
                {title:'XRE BOOKING', details:'Booking Agency in Punkrock...', buttonText:'XRE BOOKING', link:'https://xrebooking.com', backgroundImage:'./image/p-p-3.jpg', logo:'./image/webtop.png'},
                {title:'CHINESEROCKS', details:'', buttonText:'访问官网', link:'https://chineserocks.n', backgroundImage:'./image/p-p-4.jpg', logo:'./image/p-p-4logo.png'}
            ];
            adminData.collaborators = [
                {name:'TMS LIVE', image:'./image/p-logo-1.png', link:''},
                {name:'MORDAM MUSIC', image:'./image/p-logo-2.png', link:''},
                {name:'TICKETFLAP', image:'./image/p-logo-3.png', link:'https://ticketflap.com'},
                {name:'GIBSON', image:'./image/p-logo-4.png', link:''}
            ];
        }

        function renderAll() {
            renderPartnerBanners();
            renderCollaborators();
        }

        function renderPartnerBanners() {
            const container = document.getElementById('partners-banners-list');
            container.innerHTML = adminData.partnersBanners.map((banner, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">Banner ${index + 1}: ${banner.title || '未命名'}</span>
                        <button class="btn btn-small btn-danger" onclick="deletePartnerBanner(${index})">删除</button>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>标题</label>
                            <input type="text" value="${banner.title}" onchange="updatePartnerBanner(${index}, 'title', this.value)">
                        </div>
                        <div class="form-field">
                            <label>按钮文字</label>
                            <input type="text" value="${banner.buttonText}" onchange="updatePartnerBanner(${index}, 'buttonText', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>链接地址</label>
                            <input type="text" value="${banner.link}" onchange="updatePartnerBanner(${index}, 'link', this.value)">
                        </div>
                        <div class="form-field">
                            <label>背景图</label>
                            <input type="text" value="${banner.backgroundImage}" onchange="updatePartnerBanner(${index}, 'backgroundImage', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>Logo图</label>
                            <input type="text" value="${banner.logo}" onchange="updatePartnerBanner(${index}, 'logo', this.value)">
                        </div>
                        <div class="form-field">
                            <label>详情描述</label>
                            <input type="text" value="${banner.details}" onchange="updatePartnerBanner(${index}, 'details', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderCollaborators() {
            const container = document.getElementById('collaborators-list');
            container.innerHTML = adminData.collaborators.map((logo, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">Logo ${index + 1}: ${logo.name || '未命名'}</span>
                        <button class="btn btn-small btn-danger" onclick="deleteCollaborator(${index})">删除</button>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>名称</label>
                            <input type="text" value="${logo.name}" onchange="updateCollaborator(${index}, 'name', this.value)">
                        </div>
                        <div class="form-field">
                            <label>图片路径</label>
                            <input type="text" value="${logo.image}" onchange="updateCollaborator(${index}, 'image', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field" style="grid-column:1/-1">
                            <label>链接（留空则不可点击）</label>
                            <input type="text" value="${logo.link}" onchange="updateCollaborator(${index}, 'link', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updatePartnerBanner(index, field, value) {
            adminData.partnersBanners[index][field] = value;
            markChanged();
        }

        function updateCollaborator(index, field, value) {
            adminData.collaborators[index][field] = value;
            markChanged();
        }

        function addPartnerBanner() {
            if (adminData.partnersBanners.length >= 9) return alert('最多9个');
            adminData.partnersBanners.push({title:'', details:'', buttonText:'', link:'', backgroundImage:'', logo:''});
            renderPartnerBanners();
            markChanged();
        }

        function deletePartnerBanner(index) {
            adminData.partnersBanners.splice(index, 1);
            renderPartnerBanners();
            markChanged();
        }

        function addCollaborator() {
            if (adminData.collaborators.length >= 9) return alert('最多9个');
            adminData.collaborators.push({name:'', image:'', link:''});
            renderCollaborators();
            markChanged();
        }

        function deleteCollaborator(index) {
            adminData.collaborators.splice(index, 1);
            renderCollaborators();
            markChanged();
        }

        function markChanged() {
            hasChanges = true;
            document.getElementById('syncStatus').textContent = '未同步';
            document.getElementById('syncStatus').className = 'sync-status pending';
        }

        function updateCounts() {
            document.getElementById('count-partners').textContent = 
                adminData.partnersBanners.length + adminData.collaborators.length;
        }

        function showSection(id) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('section-' + id).classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
        }

        function showAlert(type, msg) {
            const el = document.getElementById(type === 'success' ? 'alertSuccess' : 'alertError');
            el.textContent = msg;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 5000);
        }

        async function syncToGitHub() {
            if (!CONFIG.githubToken) {
                const token = prompt('请输入GitHub Token:');
                if (!token) return;
                CONFIG.githubToken = token;
                localStorage.setItem('github_token', token);
            }

            document.getElementById('loading').style.display = 'block';

            try {
                // 准备数据
                const files = [
                    {
                        name: 'partners-banners.json',
                        content: JSON.stringify({banners: adminData.partnersBanners}, null, 2)
                    },
                    {
                        name: 'collaborators.json',
                        content: JSON.stringify({logos: adminData.collaborators}, null, 2)
                    }
                ];

                for (const file of files) {
                    await uploadToGitHub(file.name, file.content);
                }

                hasChanges = false;
                document.getElementById('syncStatus').textContent = '已同步';
                document.getElementById('syncStatus').className = 'sync-status synced';
                showAlert('success', '同步成功！1-2分钟后前端自动更新');
            } catch (err) {
                showAlert('error', '同步失败: ' + err.message);
            }

            document.getElementById('loading').style.display = 'none';
        }

        async function uploadToGitHub(filename, content) {
            const apiUrl = `https://api.github.com/repos/${CONFIG.githubRepo}/contents/content/${filename}`;

            // 获取SHA
            let sha = null;
            try {
                const res = await fetch(apiUrl, {
                    headers: {'Authorization': 'token ' + CONFIG.githubToken}
                });
                if (res.ok) {
                    const data = await res.json();
                    sha = data.sha;
                }
            } catch (e) {}

            // 上传
            const body = {
                message: `Update ${filename}`,
                content: btoa(unescape(encodeURIComponent(content))),
                branch: 'main'
            };
            if (sha) body.sha = sha;

            const res = await fetch(apiUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': 'token ' + CONFIG.githubToken,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });

            if (!res.ok) {
                const err = await res.json();
                throw new Error(err.message);
            }
        }

        // 检查登录状态
        if (localStorage.getItem('admin_logged_in')) {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
            loadData();
        }
    </script>
</body>
</html>
