<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveGigs Asia - 后台管理</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            background: #050505;
            color: #c0c0c0;
            min-height: 100vh;
        }

        /* 登录界面 */
        .login-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #050505 0%, #1a0000 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .login-box {
            background: rgba(139, 0, 0, 0.1);
            border: 2px solid #8b0000;
            padding: 50px;
            border-radius: 10px;
            text-align: center;
            min-width: 400px;
        }

        .login-box h1 {
            color: #8b0000;
            font-size: 36px;
            margin-bottom: 30px;
            letter-spacing: 3px;
        }

        .login-box input {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            background: #0a0a0a;
            border: 1px solid #8b0000;
            color: #c0c0c0;
            font-family: inherit;
            font-size: 16px;
        }

        .login-box input:focus {
            outline: none;
            border-color: #c0c0c0;
        }

        .login-box button {
            width: 100%;
            padding: 15px;
            margin-top: 20px;
            background: #8b0000;
            color: #c0c0c0;
            border: none;
            font-family: inherit;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .login-box button:hover {
            background: #c0c0c0;
            color: #8b0000;
        }

        .error-msg {
            color: #ff4444;
            margin-top: 15px;
            display: none;
        }

        /* 主界面 */
        .admin-container {
            display: none;
            min-height: 100vh;
        }

        /* 顶部导航 */
        .admin-header {
            background: rgba(0, 0, 0, 0.9);
            border-bottom: 3px solid #8b0000;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .admin-header h1 {
            color: #8b0000;
            font-size: 28px;
            letter-spacing: 2px;
        }

        .header-actions {
            display: flex;
            gap: 15px;
        }

        .btn {
            padding: 10px 25px;
            background: #8b0000;
            color: #c0c0c0;
            border: none;
            font-family: inherit;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #c0c0c0;
            color: #8b0000;
        }

        .btn-secondary {
            background: #333;
        }

        .btn-success {
            background: #228b22;
        }

        .sync-status {
            padding: 8px 15px;
            border-radius: 4px;
            font-size: 14px;
        }

        .sync-status.pending {
            background: #ff9800;
            color: #000;
        }

        .sync-status.synced {
            background: #4caf50;
            color: #fff;
        }

        /* 主体布局 */
        .admin-body {
            display: flex;
            min-height: calc(100vh - 80px);
        }

        /* 侧边栏 */
        .sidebar {
            width: 280px;
            background: #0a0a0a;
            border-right: 1px solid #8b0000;
            padding: 20px 0;
        }

        .nav-item {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            border-left: 3px solid transparent;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-item:hover {
            background: rgba(139, 0, 0, 0.2);
            border-left-color: #8b0000;
        }

        .nav-item.active {
            background: rgba(139, 0, 0, 0.3);
            border-left-color: #8b0000;
            color: #fff;
        }

        .nav-item .count {
            background: #8b0000;
            color: #c0c0c0;
            padding: 2px 10px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* 内容区 */
        .content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        .section h2 {
            color: #8b0000;
            font-size: 24px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #8b0000;
        }

        .section-desc {
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }

        /* 表单样式 */
        .form-group {
            background: #0a0a0a;
            border: 1px solid #333;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .form-group h3 {
            color: #c0c0c0;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-field {
            display: flex;
            flex-direction: column;
        }

        .form-field label {
            color: #888;
            font-size: 12px;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-field input,
        .form-field textarea,
        .form-field select {
            padding: 10px;
            background: #050505;
            border: 1px solid #444;
            color: #c0c0c0;
            font-family: inherit;
        }

        .form-field input:focus,
        .form-field textarea:focus {
            outline: none;
            border-color: #8b0000;
        }

        .form-field small {
            color: #666;
            font-size: 11px;
            margin-top: 3px;
        }

        /* 复选框 */
        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #8b0000;
        }

        /* 按钮组 */
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #333;
        }

        /* 项目列表 */
        .items-list {
            margin-top: 20px;
        }

        .item-card {
            background: #0f0f0f;
            border: 1px solid #333;
            padding: 20px;
            margin-bottom: 15px;
            border-radius: 5px;
            position: relative;
        }

        .item-card:hover {
            border-color: #8b0000;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .item-title {
            color: #8b0000;
            font-size: 16px;
        }

        .item-actions {
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 5px 15px;
            font-size: 12px;
        }

        .btn-danger {
            background: #dc3545;
        }

        /* 提示信息 */
        .alert {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            display: none;
        }

        .alert-success {
            background: rgba(34, 139, 34, 0.2);
            border: 1px solid #228b22;
            color: #228b22;
        }

        .alert-error {
            background: rgba(220, 53, 69, 0.2);
            border: 1px solid #dc3545;
            color: #dc3545;
        }

        /* 加载动画 */
        .loading {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            padding: 30px;
            border-radius: 10px;
            border: 2px solid #8b0000;
            z-index: 1000;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #333;
            border-top-color: #8b0000;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* 响应式 */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                position: fixed;
                bottom: 0;
                left: 0;
                z-index: 99;
                display: flex;
                overflow-x: auto;
                padding: 10px;
            }

            .nav-item {
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .admin-body {
                flex-direction: column;
                padding-bottom: 80px;
            }
        }
    </style>
</head>
<body>
    <!-- 登录界面 -->
    <div class="login-screen" id="loginScreen">
        <div class="login-box">
            <h1>LIVEGIGS ASIA ADMIN</h1>
            <input type="text" id="username" placeholder="用户名" value="admin">
            <input type="password" id="password" placeholder="密码">
            <button onclick="login()">登录</button>
            <p class="error-msg" id="loginError">用户名或密码错误</p>
        </div>
    </div>

    <!-- 主管理界面 -->
    <div class="admin-container" id="adminContainer">
        <!-- 顶部 -->
        <header class="admin-header">
            <h1>LIVEGIGS ASIA ADMIN</h1>
            <div class="header-actions">
                <span class="sync-status pending" id="syncStatus">未同步</span>
                <button class="btn btn-success" onclick="syncToGitHub()">同步到GitHub</button>
                <button class="btn btn-secondary" onclick="downloadAllData()">下载全部数据</button>
                <button class="btn btn-secondary" onclick="logout()">退出</button>
            </div>
        </header>

        <!-- 主体 -->
        <div class="admin-body">
            <!-- 侧边栏 -->
            <nav class="sidebar">
                <div class="nav-item active" onclick="showSection('banners')">
                    <span>1. BANNER管理</span>
                    <span class="count" id="count-banners">2</span>
                </div>
                <div class="nav-item" onclick="showSection('posters')">
                    <span>2. 海报管理</span>
                    <span class="count" id="count-posters">3</span>
                </div>
                <div class="nav-item" onclick="showSection('events')">
                    <span>3. 自主活动</span>
                    <span class="count" id="count-events">4</span>
                </div>
                <div class="nav-item" onclick="showSection('carousel')">
                    <span>4. 滚播活动</span>
                    <span class="count" id="count-carousel">8</span>
                </div>
                <div class="nav-item" onclick="showSection('footer')">
                    <span>5. 底部管理</span>
                    <span class="count" id="count-footer">2</span>
                </div>
                <div class="nav-item" onclick="showSection('partners')">
                    <span>6. 合作伙伴</span>
                    <span class="count" id="count-partners">8</span>
                </div>
            </nav>

            <!-- 内容区 -->
            <main class="content">
                <div class="alert alert-success" id="alertSuccess"></div>
                <div class="alert alert-error" id="alertError"></div>

                <!-- 1. Banner管理 -->
                <section class="section active" id="section-banners">
                    <h2>1. Banner管理 (Index + CN 同步)</h2>
                    <p class="section-desc">最多5个Banner，Index和CN页面同步显示。留空字段前端不显示。</p>
                    <div id="banners-list"></div>
                    <button class="btn" onclick="addBanner()">+ 添加Banner</button>
                </section>

                <!-- 2. 海报管理 -->
                <section class="section" id="section-posters">
                    <h2>2. 海报管理</h2>
                    <p class="section-desc">管理Index、CN、Events三个页面的海报区域。Events页面海报2支持轮播。</p>

                    <div class="form-group">
                        <h3>Index页面海报</h3>
                        <div id="index-posters-list"></div>
                    </div>

                    <div class="form-group">
                        <h3>CN页面海报</h3>
                        <div id="cn-posters-list"></div>
                    </div>

                    <div class="form-group">
                        <h3>Events页面海报 (海报2可设置轮播)</h3>
                        <div id="events-posters-list"></div>
                    </div>
                </section>

                <!-- 3. 自主活动 -->
                <section class="section" id="section-events">
                    <h2>3. 自主活动 (THE EVENTS WE'VE MANAGED)</h2>
                    <p class="section-desc">最多9个活动，>3个显示Load More按钮。留空字段前端不显示。</p>
                    <div id="managed-events-list"></div>
                    <button class="btn" onclick="addManagedEvent()">+ 添加活动</button>
                </section>

                <!-- 4. 滚播活动 -->
                <section class="section" id="section-carousel">
                    <h2>4. 滚播活动</h2>
                    <p class="section-desc">最少3个，最多12个活动轮播。</p>
                    <div id="carousel-list"></div>
                    <button class="btn" onclick="addCarouselItem()">+ 添加轮播</button>
                </section>

                <!-- 5. 底部管理 -->
                <section class="section" id="section-footer">
                    <h2>5. 底部管理</h2>
                    <p class="section-desc">海外站底部统一，国内站底部独立设置。</p>

                    <div class="form-group">
                        <h3>海外站底部 (Global)</h3>
                        <div id="footer-global-form"></div>
                    </div>

                    <div class="form-group">
                        <h3>国内站底部 (CN)</h3>
                        <div id="footer-cn-form"></div>
                    </div>
                </section>

                <!-- 6. 合作伙伴 -->
                <section class="section" id="section-partners">
                    <h2>6. 合作伙伴</h2>
                    <p class="section-desc">Banner最多9个，合作Logo最多9个。</p>

                    <div class="form-group">
                        <h3>Partners Banners</h3>
                        <div id="partners-banners-list"></div>
                        <button class="btn" onclick="addPartnerBanner()">+ 添加Banner</button>
                    </div>

                    <div class="form-group">
                        <h3>合作Logo (Collaborators)</h3>
                        <div id="collaborators-list"></div>
                        <button class="btn" onclick="addCollaborator()">+ 添加Logo</button>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- 加载动画 -->
    <div class="loading" id="loading">
        <div class="loading-spinner"></div>
        <p style="margin-top:15px;color:#c0c0c0">处理中...</p>
    </div>

    <script>
        // ==================== 配置 ====================
        const CONFIG = {
            username: 'admin',
            password: '00123456a',
            githubRepo: 'EmanonEnt/asia',
            githubToken: localStorage.getItem('github_token') || ''
        };

        // ==================== 数据存储 ====================
        let adminData = {
            banners: [],
            indexPosters: [],
            cnPosters: [],
            eventsPosters: [],
            eventsManaged: [],
            eventsCarousel: [],
            footerGlobal: {},
            footerCN: {},
            partnersBanners: [],
            collaborators: []
        };

        let hasChanges = false;
        let autoLogoutTimer;

        // ==================== 初始化 ====================
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            setupAutoLogout();
        });

        // ==================== 登录功能 ====================
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            if (username === CONFIG.username && password === CONFIG.password) {
                localStorage.setItem('admin_logged_in', 'true');
                localStorage.setItem('admin_login_time', Date.now());
                showAdminPanel();
            } else {
                document.getElementById('loginError').style.display = 'block';
            }
        }

        function logout() {
            localStorage.removeItem('admin_logged_in');
            localStorage.removeItem('admin_login_time');
            location.reload();
        }

        function checkLoginStatus() {
            const loggedIn = localStorage.getItem('admin_logged_in');
            const loginTime = localStorage.getItem('admin_login_time');

            if (loggedIn && loginTime) {
                const elapsed = Date.now() - parseInt(loginTime);
                if (elapsed < 30 * 60 * 1000) { // 30分钟
                    showAdminPanel();
                } else {
                    logout();
                }
            }
        }

        function showAdminPanel() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
            loadAllData();
        }

        // ==================== 自动退出 ====================
        function setupAutoLogout() {
            document.addEventListener('click', resetAutoLogout);
            document.addEventListener('keypress', resetAutoLogout);
        }

        function resetAutoLogout() {
            clearTimeout(autoLogoutTimer);
            autoLogoutTimer = setTimeout(() => {
                alert('30分钟无操作，自动退出登录');
                logout();
            }, 30 * 60 * 1000);
        }

        // ==================== 数据加载 ====================
        async function loadAllData() {
            showLoading(true);

            try {
                // 从localStorage加载或初始化默认数据
                const saved = localStorage.getItem('admin_data');
                if (saved) {
                    adminData = JSON.parse(saved);
                } else {
                    initDefaultData();
                }

                renderAllSections();
                updateCounts();
            } catch (e) {
                showAlert('error', '数据加载失败: ' + e.message);
            }

            showLoading(false);
        }

        function initDefaultData() {
            // Banner
            adminData.banners = [
                { title: 'THE NONAME', buttonText: 'View Details →', link: 'https://thenonameanti-.com', image: './image/thenonameanti-.jpg' },
                { title: 'PUNK HEART', buttonText: 'View Details →', link: 'https://punkheart.com', image: './image/punkheartbanner.jpg' }
            ];

            // Posters
            adminData.indexPosters = [
                { title: 'LiveGigs Asia', buttonText: 'View Details →', link: 'https://livegigsasia.com', image: './image/livegigscn1.png' },
                { title: 'Event 2', buttonText: 'View Details →', link: 'https://example.com/event2', image: './image/1-b-2.jpg' },
                { title: 'Event 3', buttonText: 'View Details →', link: 'https://example.com/event3', image: './image/1-b-3.jpg' }
            ];

            adminData.cnPosters = [
                { title: 'LiveGigs Asia', buttonText: '查看详情 →', link: 'https://livegigs.cn', image: './image/livegigscn1.png' },
                { title: '活动 2', buttonText: '查看详情 →', link: 'https://example.com/event2', image: './image/cn-asiaad.jpg' },
                { title: '活动 3', buttonText: '查看详情 →', link: 'https://example.com/event3', image: './image/1-b-3.jpg' }
            ];

            adminData.eventsPosters = [
                { title: 'Epic Past Gigs', buttonText: 'View Details →', link: 'https://example.com/past', image: './image/livegigscn1.png', slides: [] },
                { title: 'Epic Past Gigs', buttonText: '', link: '', image: '', slides: [
                    { image: './image/1-b-2.jpg', title: 'Past Gig 1', buttonText: 'View →', link: 'https://example.com/past1' },
                    { image: './image/1-b-3.jpg', title: 'Past Gig 2', buttonText: 'View →', link: 'https://example.com/past2' },
                    { image: './image/cn-asiaad.jpg', title: 'Past Gig 3', buttonText: 'View →', link: 'https://example.com/past3' }
                ]},
                { title: 'Upcoming Events', buttonText: 'View Details →', link: 'https://example.com/upcoming', image: './image/1-b-3.jpg', slides: [] }
            ];

            // Events
            adminData.eventsManaged = [
                { title: 'The Noname Live in Shanghai', date: '2026-03-15', time: '20:00', location: 'Shanghai Modern Sky Lab', ticket: '¥280', ontour: true, soldout: false, details: 'The Noname brings their iconic punk rock energy...', buttonText: 'Buy Tickets', link: 'https://ticket.com/event1', poster: './image/thenonameanti-.jpg' },
                { title: 'Punk Heart Festival 2026', date: '2026-04-20', time: '18:00', location: 'Beijing Omni Space', ticket: '¥380', ontour: false, soldout: true, details: 'Annual punk rock festival...', buttonText: 'Sold Out', link: '', poster: './image/punkheartbanner.jpg' },
                { title: 'XRE Booking Showcase', date: '2026-05-10', time: '19:30', location: 'Guangzhou Mao Livehouse', ticket: '¥180', ontour: true, soldout: false, details: 'Showcasing the best new talent...', buttonText: 'Get Tickets', link: 'https://ticket.com/event3', poster: './image/1-b-2.jpg' },
                { title: 'Kids Union Records Night', date: '2026-06-01', time: '20:30', location: 'Shenzhen Hou Live', ticket: '¥150', ontour: false, soldout: false, details: 'A special night celebrating...', buttonText: 'Buy Now', link: 'https://kids-union.com/tickets', poster: './image/1-b-3.jpg' }
            ];

            adminData.eventsCarousel = [
                { title: 'The Noname - Asia Tour 2026', date: 'March 15, 2026', time: '20:00', location: 'Shanghai', details: 'Experience the legendary punk rock band...', buttonText: 'View Details →', link: 'https://thenonameanti-.com', image: './image/thenonameanti-.jpg' },
                { title: 'Punk Heart Festival', date: 'April 20, 2026', time: '18:00', location: 'Beijing', details: 'The biggest punk festival in Asia...', buttonText: 'Learn More →', link: 'https://punkheart.com', image: './image/punkheartbanner.jpg' },
                { title: 'XRE Booking Presents', date: 'May 10, 2026', time: '19:30', location: 'Guangzhou', details: 'New talent showcase...', buttonText: 'Details →', link: 'https://xrebooking.com', image: './image/1-b-2.jpg' }
            ];

            // Footer
            adminData.footerGlobal = {
                logoText: 'LIVEGIGS(ASIA)',
                copyright: 'Copyright © 2001-2026 EMANON ENTERTAINMENT',
                producerLogo: './image/emanonent-logo.png',
                socialMedia: [
                    { name: 'Facebook', icon: '', link: 'https://facebook.com/livegigsasia' },
                    { name: 'Instagram', icon: '', link: 'https://instagram.com/livegigsasia' },
                    { name: 'YouTube', icon: '', link: 'https://youtube.com/livegigsasia' },
                    { name: 'X', icon: '', link: 'https://x.com/livegigsasia' }
                ]
            };

            adminData.footerCN = {
                logoText: 'LIVEGIGS(CN)',
                copyright: 'Copyright © 2001-2026 EMANON ENTERTAINMENT',
                producerLogo: './image/emanonent-logo.png',
                socialMedia: [
                    { name: 'Weibo', icon: '', link: 'https://weibo.com/livegigscn' },
                    { name: 'WeChat', icon: '', link: '#' },
                    { name: 'Xiaohongshu', icon: '', link: 'https://xiaohongshu.com/livegigs' },
                    { name: 'MiniProgram', icon: '', link: '#' }
                ]
            };

            // Partners
            adminData.partnersBanners = [
                { title: '', details: '', buttonText: '下载APP', link: 'https://xrebooking.com/app', backgroundImage: './image/p-p-1.jpg', logo: './image/p-p-1logo.png' },
                { title: '小子联盟唱片', details: '独立音乐厂牌...', buttonText: '访问网站', link: 'https://kids-union.com', backgroundImage: './image/p-p-2.jpg', logo: './image/p-p-2logo.png' },
                { title: 'XRE BOOKING', details: '专业演出经纪\n艺人管理\n活动制作', buttonText: '了解更多', link: 'https://xrebooking.com', backgroundImage: './image/p-p-3.png', logo: './image/p-p-3logo.png' },
                { title: '', details: '', buttonText: '访问官网', link: 'https://partner4.com', backgroundImage: './image/p-p-4.jpg', logo: './image/p-p-4logo.png' }
            ];

            adminData.collaborators = [
                { name: 'XRE Booking', image: './image/collab1.png', link: 'https://xrebooking.com' },
                { name: 'Kids Union', image: './image/collab2.png', link: 'https://kids-union.com' },
                { name: 'Modern Sky', image: './image/collab3.png', link: 'https://modernsky.com' },
                { name: 'Mao Livehouse', image: './image/collab4.png', link: 'https://mao.com' }
            ];
        }

        // ==================== 渲染各个区域 ====================
        function renderAllSections() {
            renderBanners();
            renderPosters();
            renderManagedEvents();
            renderCarousel();
            renderFooter();
            renderPartners();
        }

        function renderBanners() {
            const container = document.getElementById('banners-list');
            container.innerHTML = adminData.banners.map((banner, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">Banner ${index + 1}</span>
                        <div class="item-actions">
                            <button class="btn btn-small btn-danger" onclick="deleteBanner(${index})">删除</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>标题</label>
                            <input type="text" value="${banner.title}" onchange="updateBanner(${index}, 'title', this.value)" placeholder="Banner标题">
                        </div>
                        <div class="form-field">
                            <label>按钮文字</label>
                            <input type="text" value="${banner.buttonText}" onchange="updateBanner(${index}, 'buttonText', this.value)" placeholder="如：View Details →">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>链接地址</label>
                            <input type="text" value="${banner.link}" onchange="updateBanner(${index}, 'link', this.value)" placeholder="https://...">
                        </div>
                        <div class="form-field">
                            <label>图片路径</label>
                            <input type="text" value="${banner.image}" onchange="updateBanner(${index}, 'image', this.value)" placeholder="./image/banner.jpg">
                            <small>支持相对路径或完整URL</small>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderPosters() {
            // Index Posters
            document.getElementById('index-posters-list').innerHTML = renderPosterList(adminData.indexPosters, 'index');
            // CN Posters
            document.getElementById('cn-posters-list').innerHTML = renderPosterList(adminData.cnPosters, 'cn');
            // Events Posters
            document.getElementById('events-posters-list').innerHTML = renderEventsPosterList();
        }

        function renderPosterList(posters, type) {
            return posters.map((poster, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">海报 ${index + 1}</span>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>标题</label>
                            <input type="text" value="${poster.title}" onchange="updatePoster('${type}', ${index}, 'title', this.value)">
                        </div>
                        <div class="form-field">
                            <label>按钮文字</label>
                            <input type="text" value="${poster.buttonText}" onchange="updatePoster('${type}', ${index}, 'buttonText', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>链接地址</label>
                            <input type="text" value="${poster.link}" onchange="updatePoster('${type}', ${index}, 'link', this.value)">
                        </div>
                        <div class="form-field">
                            <label>图片路径</label>
                            <input type="text" value="${poster.image}" onchange="updatePoster('${type}', ${index}, 'image', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderEventsPosterList() {
            return adminData.eventsPosters.map((poster, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">海报 ${index + 1} ${index === 1 ? '(支持轮播)' : ''}</span>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>标题</label>
                            <input type="text" value="${poster.title}" onchange="updateEventsPoster(${index}, 'title', this.value)">
                        </div>
                        <div class="form-field">
                            <label>按钮文字</label>
                            <input type="text" value="${poster.buttonText}" onchange="updateEventsPoster(${index}, 'buttonText', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>链接地址</label>
                            <input type="text" value="${poster.link}" onchange="updateEventsPoster(${index}, 'link', this.value)">
                        </div>
                        <div class="form-field">
                            <label>图片路径</label>
                            <input type="text" value="${poster.image}" onchange="updateEventsPoster(${index}, 'image', this.value)">
                        </div>
                    </div>
                    ${index === 1 ? renderSlidesEditor(poster.slides) : ''}
                </div>
            `).join('');
        }

        function renderSlidesEditor(slides) {
            if (!slides || slides.length === 0) {
                return '<p style="color:#666;margin-top:10px">无轮播图片（使用单图模式）</p>';
            }
            return `
                <div style="margin-top:15px;padding:15px;background:#050505;border-radius:5px;">
                    <h4 style="color:#8b0000;margin-bottom:10px">轮播图片设置 (${slides.length}个)</h4>
                    ${slides.map((slide, idx) => `
                        <div style="margin-bottom:15px;padding:10px;border:1px solid #333;">
                            <p style="color:#888;font-size:12px;margin-bottom:5px">轮播 ${idx + 1}</p>
                            <div class="form-row">
                                <div class="form-field">
                                    <label>图片</label>
                                    <input type="text" value="${slide.image}" onchange="updateSlide(${idx}, 'image', this.value)">
                                </div>
                                <div class="form-field">
                                    <label>标题</label>
                                    <input type="text" value="${slide.title}" onchange="updateSlide(${idx}, 'title', this.value)">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-field">
                                    <label>按钮文字</label>
                                    <input type="text" value="${slide.buttonText}" onchange="updateSlide(${idx}, 'buttonText', this.value)">
                                </div>
                                <div class="form-field">
                                    <label>链接</label>
                                    <input type="text" value="${slide.link}" onchange="updateSlide(${idx}, 'link', this.value)">
                                </div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderManagedEvents() {
            const container = document.getElementById('managed-events-list');
            container.innerHTML = adminData.eventsManaged.map((event, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">${event.title || '活动 ' + (index + 1)}</span>
                        <div class="item-actions">
                            <button class="btn btn-small btn-danger" onclick="deleteManagedEvent(${index})">删除</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>活动标题 *</label>
                            <input type="text" value="${event.title}" onchange="updateManagedEvent(${index}, 'title', this.value)">
                        </div>
                        <div class="form-field">
                            <label>海报图片</label>
                            <input type="text" value="${event.poster}" onchange="updateManagedEvent(${index}, 'poster', this.value)" placeholder="./image/event.jpg">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>日期</label>
                            <input type="text" value="${event.date}" onchange="updateManagedEvent(${index}, 'date', this.value)" placeholder="2026-03-15">
                        </div>
                        <div class="form-field">
                            <label>时间</label>
                            <input type="text" value="${event.time}" onchange="updateManagedEvent(${index}, 'time', this.value)" placeholder="20:00">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>地点</label>
                            <input type="text" value="${event.location}" onchange="updateManagedEvent(${index}, 'location', this.value)">
                        </div>
                        <div class="form-field">
                            <label>票价</label>
                            <input type="text" value="${event.ticket}" onchange="updateManagedEvent(${index}, 'ticket', this.value)" placeholder="¥280">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label>活动详情</label>
                            <textarea rows="3" onchange="updateManagedEvent(${index}, 'details', this.value)">${event.details}</textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>按钮文字</label>
                            <input type="text" value="${event.buttonText}" onchange="updateManagedEvent(${index}, 'buttonText', this.value)" placeholder="Buy Tickets">
                        </div>
                        <div class="form-field">
                            <label>按钮链接</label>
                            <input type="text" value="${event.link}" onchange="updateManagedEvent(${index}, 'link', this.value)" placeholder="https://...">
                        </div>
                    </div>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" ${event.ontour ? 'checked' : ''} onchange="updateManagedEvent(${index}, 'ontour', this.checked)">
                            ON TOUR 标签
                        </label>
                        <label>
                            <input type="checkbox" ${event.soldout ? 'checked' : ''} onchange="updateManagedEvent(${index}, 'soldout', this.checked)">
                            SOLD OUT 标签
                        </label>
                    </div>
                </div>
            `).join('');
        }

        function renderCarousel() {
            const container = document.getElementById('carousel-list');
            container.innerHTML = adminData.eventsCarousel.map((item, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">${item.title || '轮播 ' + (index + 1)}</span>
                        <div class="item-actions">
                            <button class="btn btn-small btn-danger" onclick="deleteCarouselItem(${index})">删除</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>标题</label>
                            <input type="text" value="${item.title}" onchange="updateCarousel(${index}, 'title', this.value)">
                        </div>
                        <div class="form-field">
                            <label>图片</label>
                            <input type="text" value="${item.image}" onchange="updateCarousel(${index}, 'image', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>日期</label>
                            <input type="text" value="${item.date}" onchange="updateCarousel(${index}, 'date', this.value)">
                        </div>
                        <div class="form-field">
                            <label>时间</label>
                            <input type="text" value="${item.time}" onchange="updateCarousel(${index}, 'time', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>地点</label>
                            <input type="text" value="${item.location}" onchange="updateCarousel(${index}, 'location', this.value)">
                        </div>
                        <div class="form-field">
                            <label>按钮文字</label>
                            <input type="text" value="${item.buttonText}" onchange="updateCarousel(${index}, 'buttonText', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label>详情描述</label>
                            <input type="text" value="${item.details}" onchange="updateCarousel(${index}, 'details', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label>链接地址</label>
                            <input type="text" value="${item.link}" onchange="updateCarousel(${index}, 'link', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function renderFooter() {
            // Global Footer
            const global = adminData.footerGlobal;
            document.getElementById('footer-global-form').innerHTML = `
                <div class="form-row">
                    <div class="form-field">
                        <label>Logo文字</label>
                        <input type="text" value="${global.logoText}" onchange="updateFooter('global', 'logoText', this.value)">
                    </div>
                    <div class="form-field">
                        <label>版权信息</label>
                        <input type="text" value="${global.copyright}" onchange="updateFooter('global', 'copyright', this.value)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label>制作单位Logo</label>
                        <input type="text" value="${global.producerLogo}" onchange="updateFooter('global', 'producerLogo', this.value)">
                    </div>
                </div>
                <h4 style="color:#8b0000;margin:20px 0 10px">社交媒体 (${global.socialMedia.length}个)</h4>
                ${global.socialMedia.map((social, idx) => `
                    <div class="form-row" style="margin-bottom:10px">
                        <div class="form-field">
                            <input type="text" value="${social.name}" placeholder="名称" onchange="updateSocial('global', ${idx}, 'name', this.value)">
                        </div>
                        <div class="form-field">
                            <input type="text" value="${social.link}" placeholder="链接" onchange="updateSocial('global', ${idx}, 'link', this.value)">
                        </div>
                        <div class="form-field">
                            <input type="text" value="${social.icon}" placeholder="图标路径（可选）" onchange="updateSocial('global', ${idx}, 'icon', this.value)">
                        </div>
                    </div>
                `).join('')}
                <button class="btn btn-small" onclick="addSocial('global')">+ 添加社交媒体</button>
            `;

            // CN Footer
            const cn = adminData.footerCN;
            document.getElementById('footer-cn-form').innerHTML = `
                <div class="form-row">
                    <div class="form-field">
                        <label>Logo文字</label>
                        <input type="text" value="${cn.logoText}" onchange="updateFooter('cn', 'logoText', this.value)">
                    </div>
                    <div class="form-field">
                        <label>版权信息</label>
                        <input type="text" value="${cn.copyright}" onchange="updateFooter('cn', 'copyright', this.value)">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-field">
                        <label>制作单位Logo</label>
                        <input type="text" value="${cn.producerLogo}" onchange="updateFooter('cn', 'producerLogo', this.value)">
                    </div>
                </div>
                <h4 style="color:#8b0000;margin:20px 0 10px">社交媒体 (${cn.socialMedia.length}个)</h4>
                ${cn.socialMedia.map((social, idx) => `
                    <div class="form-row" style="margin-bottom:10px">
                        <div class="form-field">
                            <input type="text" value="${social.name}" placeholder="名称" onchange="updateSocial('cn', ${idx}, 'name', this.value)">
                        </div>
                        <div class="form-field">
                            <input type="text" value="${social.link}" placeholder="链接" onchange="updateSocial('cn', ${idx}, 'link', this.value)">
                        </div>
                        <div class="form-field">
                            <input type="text" value="${social.icon}" placeholder="图标路径（可选）" onchange="updateSocial('cn', ${idx}, 'icon', this.value)">
                        </div>
                    </div>
                `).join('')}
                <button class="btn btn-small" onclick="addSocial('cn')">+ 添加社交媒体</button>
            `;
        }

        function renderPartners() {
            // Partners Banners
            document.getElementById('partners-banners-list').innerHTML = adminData.partnersBanners.map((banner, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">Partner Banner ${index + 1}</span>
                        <div class="item-actions">
                            <button class="btn btn-small btn-danger" onclick="deletePartnerBanner(${index})">删除</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>标题</label>
                            <input type="text" value="${banner.title}" onchange="updatePartnerBanner(${index}, 'title', this.value)">
                        </div>
                        <div class="form-field">
                            <label>按钮文字</label>
                            <input type="text" value="${banner.buttonText}" onchange="updatePartnerBanner(${index}, 'buttonText', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>链接</label>
                            <input type="text" value="${banner.link}" onchange="updatePartnerBanner(${index}, 'link', this.value)">
                        </div>
                        <div class="form-field">
                            <label>背景图</label>
                            <input type="text" value="${banner.backgroundImage}" onchange="updatePartnerBanner(${index}, 'backgroundImage', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label>详情描述</label>
                            <textarea rows="2" onchange="updatePartnerBanner(${index}, 'details', this.value)">${banner.details}</textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>Logo图</label>
                            <input type="text" value="${banner.logo}" onchange="updatePartnerBanner(${index}, 'logo', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');

            // Collaborators
            document.getElementById('collaborators-list').innerHTML = adminData.collaborators.map((logo, index) => `
                <div class="item-card">
                    <div class="item-header">
                        <span class="item-title">${logo.name || 'Logo ' + (index + 1)}</span>
                        <div class="item-actions">
                            <button class="btn btn-small btn-danger" onclick="deleteCollaborator(${index})">删除</button>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field">
                            <label>名称</label>
                            <input type="text" value="${logo.name}" onchange="updateCollaborator(${index}, 'name', this.value)">
                        </div>
                        <div class="form-field">
                            <label>Logo图片</label>
                            <input type="text" value="${logo.image}" onchange="updateCollaborator(${index}, 'image', this.value)">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-field" style="grid-column: 1 / -1;">
                            <label>链接（留空则不可点击）</label>
                            <input type="text" value="${logo.link}" onchange="updateCollaborator(${index}, 'link', this.value)">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ==================== 数据更新函数 ====================
        function updateBanner(index, field, value) {
            adminData.banners[index][field] = value;
            markChanged();
        }

        function updatePoster(type, index, field, value) {
            adminData[type + 'Posters'][index][field] = value;
            markChanged();
        }

        function updateEventsPoster(index, field, value) {
            adminData.eventsPosters[index][field] = value;
            markChanged();
        }

        function updateSlide(idx, field, value) {
            adminData.eventsPosters[1].slides[idx][field] = value;
            markChanged();
        }

        function updateManagedEvent(index, field, value) {
            adminData.eventsManaged[index][field] = value;
            markChanged();
        }

        function updateCarousel(index, field, value) {
            adminData.eventsCarousel[index][field] = value;
            markChanged();
        }

        function updateFooter(type, field, value) {
            adminData['footer' + (type === 'global' ? 'Global' : 'CN')][field] = value;
            markChanged();
        }

        function updateSocial(type, idx, field, value) {
            const footer = type === 'global' ? adminData.footerGlobal : adminData.footerCN;
            footer.socialMedia[idx][field] = value;
            markChanged();
        }

        function updatePartnerBanner(index, field, value) {
            adminData.partnersBanners[index][field] = value;
            markChanged();
        }

        function updateCollaborator(index, field, value) {
            adminData.collaborators[index][field] = value;
            markChanged();
        }

        // ==================== 添加/删除函数 ====================
        function addBanner() {
            if (adminData.banners.length >= 5) {
                showAlert('error', '最多只能添加5个Banner');
                return;
            }
            adminData.banners.push({ title: '', buttonText: '', link: '', image: '' });
            renderBanners();
            updateCounts();
            markChanged();
        }

        function deleteBanner(index) {
            adminData.banners.splice(index, 1);
            renderBanners();
            updateCounts();
            markChanged();
        }

        function addManagedEvent() {
            if (adminData.eventsManaged.length >= 9) {
                showAlert('error', '最多只能添加9个活动');
                return;
            }
            adminData.eventsManaged.push({
                title: '', date: '', time: '', location: '', ticket: '',
                ontour: false, soldout: false, details: '', buttonText: '', link: '', poster: ''
            });
            renderManagedEvents();
            updateCounts();
            markChanged();
        }

        function deleteManagedEvent(index) {
            adminData.eventsManaged.splice(index, 1);
            renderManagedEvents();
            updateCounts();
            markChanged();
        }

        function addCarouselItem() {
            if (adminData.eventsCarousel.length >= 12) {
                showAlert('error', '最多只能添加12个轮播');
                return;
            }
            adminData.eventsCarousel.push({
                title: '', date: '', time: '', location: '', details: '', buttonText: '', link: '', image: ''
            });
            renderCarousel();
            updateCounts();
            markChanged();
        }

        function deleteCarouselItem(index) {
            if (adminData.eventsCarousel.length <= 3) {
                showAlert('error', '最少需要保留3个轮播');
                return;
            }
            adminData.eventsCarousel.splice(index, 1);
            renderCarousel();
            updateCounts();
            markChanged();
        }

        function addSocial(type) {
            const footer = type === 'global' ? adminData.footerGlobal : adminData.footerCN;
            if (footer.socialMedia.length >= 10) {
                showAlert('error', '最多只能添加10个社交媒体');
                return;
            }
            footer.socialMedia.push({ name: '', icon: '', link: '' });
            renderFooter();
            markChanged();
        }

        function addPartnerBanner() {
            if (adminData.partnersBanners.length >= 9) {
                showAlert('error', '最多只能添加9个Partner Banner');
                return;
            }
            adminData.partnersBanners.push({
                title: '', details: '', buttonText: '', link: '', backgroundImage: '', logo: ''
            });
            renderPartners();
            updateCounts();
            markChanged();
        }

        function deletePartnerBanner(index) {
            adminData.partnersBanners.splice(index, 1);
            renderPartners();
            updateCounts();
            markChanged();
        }

        function addCollaborator() {
            if (adminData.collaborators.length >= 9) {
                showAlert('error', '最多只能添加9个合作Logo');
                return;
            }
            adminData.collaborators.push({ name: '', image: '', link: '' });
            renderPartners();
            updateCounts();
            markChanged();
        }

        function deleteCollaborator(index) {
            adminData.collaborators.splice(index, 1);
            renderPartners();
            updateCounts();
            markChanged();
        }

        // ==================== 辅助函数 ====================
        function markChanged() {
            hasChanges = true;
            localStorage.setItem('admin_data', JSON.stringify(adminData));
            document.getElementById('syncStatus').textContent = '未同步';
            document.getElementById('syncStatus').className = 'sync-status pending';
        }

        function updateCounts() {
            document.getElementById('count-banners').textContent = adminData.banners.length;
            document.getElementById('count-posters').textContent = adminData.indexPosters.length;
            document.getElementById('count-events').textContent = adminData.eventsManaged.length;
            document.getElementById('count-carousel').textContent = adminData.eventsCarousel.length;
            document.getElementById('count-footer').textContent = 2;
            document.getElementById('count-partners').textContent = adminData.partnersBanners.length + adminData.collaborators.length;
        }

        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            document.getElementById('section-' + sectionId).classList.add('active');
            event.target.closest('.nav-item').classList.add('active');
        }

        function showAlert(type, message) {
            const alert = document.getElementById(type === 'success' ? 'alertSuccess' : 'alertError');
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => alert.style.display = 'none', 5000);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // ==================== GitHub同步 ====================
        async function syncToGitHub() {
            if (!CONFIG.githubToken) {
                const token = prompt('请输入GitHub Personal Access Token:');
                if (!token) return;
                CONFIG.githubToken = token;
                localStorage.setItem('github_token', token);
            }

            showLoading(true);

            try {
                // 准备所有JSON文件
                const files = [
                    { name: 'banners.json', content: JSON.stringify({ banners: adminData.banners }, null, 2) },
                    { name: 'index-posters.json', content: JSON.stringify({ posters: adminData.indexPosters }, null, 2) },
                    { name: 'cn-posters.json', content: JSON.stringify({ posters: adminData.cnPosters }, null, 2) },
                    { name: 'events-posters.json', content: JSON.stringify({ posters: adminData.eventsPosters }, null, 2) },
                    { name: 'events-managed.json', content: JSON.stringify({ events: adminData.eventsManaged }, null, 2) },
                    { name: 'events-carousel.json', content: JSON.stringify({ items: adminData.eventsCarousel }, null, 2) },
                    { name: 'footer-global.json', content: JSON.stringify(adminData.footerGlobal, null, 2) },
                    { name: 'footer-cn.json', content: JSON.stringify(adminData.footerCN, null, 2) },
                    { name: 'partners-banners.json', content: JSON.stringify({ banners: adminData.partnersBanners }, null, 2) },
                    { name: 'collaborators.json', content: JSON.stringify({ logos: adminData.collaborators }, null, 2) }
                ];

                // 逐个上传文件
                for (const file of files) {
                    await uploadFileToGitHub(file.name, file.content);
                }

                hasChanges = false;
                document.getElementById('syncStatus').textContent = '已同步';
                document.getElementById('syncStatus').className = 'sync-status synced';
                showAlert('success', '成功同步到GitHub！1-2分钟后前端自动更新。');
            } catch (error) {
                showAlert('error', '同步失败: ' + error.message);
            }

            showLoading(false);
        }

        async function uploadFileToGitHub(filename, content) {
            const apiUrl = `https://api.github.com/repos/${CONFIG.githubRepo}/contents/content/${filename}`;

            // 先获取文件SHA（如果存在）
            let sha = null;
            try {
                const getRes = await fetch(apiUrl, {
                    headers: { 'Authorization': 'token ' + CONFIG.githubToken }
                });
                if (getRes.ok) {
                    const fileData = await getRes.json();
                    sha = fileData.sha;
                }
            } catch (e) {
                // 文件不存在，继续创建
            }

            // 上传文件
            const body = {
                message: `Update ${filename} via admin`,
                content: btoa(unescape(encodeURIComponent(content))),
                branch: 'main'
            };

            if (sha) body.sha = sha;

            const res = await fetch(apiUrl, {
                method: 'PUT',
                headers: {
                    'Authorization': 'token ' + CONFIG.githubToken,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(body)
            });

            if (!res.ok) {
                const error = await res.json();
                throw new Error(`${filename}: ${error.message}`);
            }
        }

        function downloadAllData() {
            const dataStr = JSON.stringify(adminData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'livegigs-admin-data-' + new Date().toISOString().slice(0, 10) + '.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // 页面加载时检查token
        if (localStorage.getItem('github_token')) {
            CONFIG.githubToken = localStorage.getItem('github_token');
        }
    </script>
</body>
</html>
