<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiveGigs Asia - 后台管理</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary-red: #8b0000;
            --silver: #c0c0c0;
            --dark-bg: #1a1a1a;
        }

        body {
            font-family: Impact, Haettenschweiler, 'Arial Narrow Bold', sans-serif;
            background: linear-gradient(135deg, #e8e8e8 0%, #d0d0d0 100%);
            color: #1a1a1a;
            min-height: 100vh;
        }

        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #e8e8e8 0%, #d0d0d0 100%);
        }

        .login-box {
            box-shadow: 0 0 30px rgba(139, 0, 0, 0.3);
            background: rgba(255, 255, 255, 0.95);
            border: 3px solid var(--primary-red);
            padding: 60px;
            border-radius: 10px;
            text-align: center;
            min-width: 400px;
        }

        .login-box h1 {
            text-shadow: 0 0 10px rgba(139, 0, 0, 0.5);
            color: var(--primary-red);
            font-size: 42px;
            margin-bottom: 10px;
            letter-spacing: 4px;
        }

        .login-box h2 {
            color: #333333;
            font-size: 18px;
            margin-bottom: 40px;
            font-weight: normal;
        }

        .form-group {
            margin-bottom: 25px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #333333;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .form-group input {
            width: 100%;
            padding: 15px;
            background: #ffffff;
            border: 2px solid var(--primary-red);
            color: #1a1a1a;
            font-size: 16px;
            font-family: inherit;
            border-radius: 5px;
        }

        .btn {
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.4);
            padding: 15px 40px;
            background: var(--primary-red);
            color: white;
            border: none;
            font-size: 16px;
            font-family: inherit;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-radius: 5px;
            transition: all 0.3s;
        }

        .btn:hover {
            box-shadow: 0 6px 20px rgba(139, 0, 0, 0.6);
            background: #a00000;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary-red);
            color: var(--primary-red);
        }

        .btn-success {
            background: #28a745;
            box-shadow: 0 4px 15px rgba(40, 167, 69, 0.4);
        }

        .btn-small {
            padding: 10px 25px;
            font-size: 12px;
        }

        .admin-container { display: none; }

        .admin-header {
            background: rgba(30, 30, 30, 0.95);
            border-bottom: 3px solid var(--primary-red);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .admin-header h1 {
            color: var(--primary-red);
            font-size: 28px;
            letter-spacing: 3px;
        }

        .sync-status {
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 12px;
            letter-spacing: 1px;
            font-family: Arial, sans-serif;
        }

        .sync-status.pending { background: #ffc107; color: #000; }
        .sync-status.success { background: #28a745; color: white; }
        .sync-status.error { background: #dc3545; color: white; }

        .admin-sidebar {
            position: fixed;
            left: 0;
            top: 80px;
            bottom: 0;
            width: 280px;
            background: rgba(40, 40, 40, 0.95);
            border-right: 1px solid var(--primary-red);
            overflow-y: auto;
            padding: 20px 0;
        }

        .nav-item {
            padding: 18px 30px;
            cursor: pointer;
            border-left: 4px solid transparent;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 14px;
            color: #f0f0f0;
            text-decoration: none;
            display: block;
        }

        .nav-item:hover, .nav-item.active {
            background: rgba(139, 0, 0, 0.4);
            border-left-color: var(--primary-red);
            color: #ffffff;
        }

        .admin-content {
            margin-left: 280px;
            margin-top: 80px;
            padding: 40px;
            min-height: calc(100vh - 80px);
            color: #1a1a1a;
            scroll-behavior: smooth;
        }

        .section {
            scroll-margin-top: 100px;
            margin-bottom: 60px;
            display: none;
        }

        .section.active { display: block; }

        .section-title {
            font-size: 32px;
            color: #8b0000;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #8b0000;
            letter-spacing: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-desc {
            color: #555555;
            margin-bottom: 30px;
            font-size: 14px;
            letter-spacing: 1px;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.9);
        }

        .data-table th {
            background: rgba(139, 0, 0, 0.1);
            padding: 15px;
            text-align: left;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-size: 12px;
            border-bottom: 2px solid #8b0000;
            color: #1a1a1a;
        }

        .data-table td {
            padding: 15px;
            border-bottom: 1px solid rgba(139, 0, 0, 0.2);
            vertical-align: top;
            color: #1a1a1a;
        }

        .data-table tr.disabled { opacity: 0.4; background: rgba(0, 0, 0, 0.05); }

        .data-table input, .data-table textarea, .data-table select {
            width: 100%;
            padding: 10px;
            background: #ffffff;
            border: 1px solid #8b0000;
            color: #1a1a1a;
            font-family: Arial, sans-serif;
            font-size: 13px;
            border-radius: 3px;
        }

        .data-table input[type="checkbox"] {
            width: auto;
            transform: scale(1.3);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 2px solid #8b0000;
        }

        .tab {
            padding: 15px 30px;
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            color: #555555;
            background: transparent;
            border: none;
            font-family: inherit;
            font-size: 14px;
        }

        .tab.active {
            color: #8b0000;
            border-bottom-color: #8b0000;
            font-weight: bold;
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .toolbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.9);
            border-radius: 5px;
            border: 1px solid rgba(139, 0, 0, 0.2);
        }

        .alert {
            padding: 15px 20px;
            border-radius: 5px;
            margin-bottom: 20px;
            display: none;
            font-family: Arial, sans-serif;
        }

        .alert.show { display: block; }
        .alert-success { background: rgba(40, 167, 69, 0.15); border: 1px solid #28a745; color: #155724; }
        .alert-error { background: rgba(220, 53, 69, 0.15); border: 1px solid #dc3545; color: #721c24; }
        .alert-warning { background: rgba(255, 193, 7, 0.15); border: 1px solid #ffc107; color: #856404; }

        .add-row-btn {
            margin-top: 20px;
            padding: 15px;
            width: 100%;
            background: rgba(139, 0, 0, 0.05);
            border: 2px dashed #8b0000;
            color: #8b0000;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
            transition: all 0.3s;
            border-radius: 5px;
        }

        .add-row-btn:hover {
            background: rgba(139, 0, 0, 0.15);
            border-style: solid;
        }

        .section-sync-btn {
            font-size: 12px;
            padding: 10px 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid var(--primary-red);
            padding: 25px;
            border-radius: 5px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 36px;
            color: #8b0000;
            margin-bottom: 10px;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.show { display: flex; }

        .modal-content {
            background: #f0f0f0;
            border: 3px solid var(--primary-red);
            padding: 40px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .modal-content h3 {
            color: #8b0000;
            margin-bottom: 20px;
            font-size: 24px;
        }

        .field-mapping {
            background: rgba(139, 0, 0, 0.05);
            border-left: 4px solid #8b0000;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 13px;
            color: #555;
        }

        .field-mapping strong {
            color: #8b0000;
        }

        .last-sync {
            color: #888;
            font-size: 12px;
            margin-right: 15px;
            font-family: Arial, sans-serif;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sync-progress {
            position: fixed;
            top: 80px;
            left: 280px;
            right: 0;
            background: rgba(139, 0, 0, 0.9);
            color: white;
            padding: 15px;
            text-align: center;
            display: none;
            z-index: 999;
        }

        .sync-progress.show { display: block; }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <h1>LIVEGIGS</h1>
            <h2>ASIA ADMIN PANEL</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="username" value="admin" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" placeholder="Enter password" required>
                </div>
                <div class="form-group">
                    <label>GitHub Token (Optional)</label>
                    <input type="text" id="githubToken" placeholder="ghp_xxxxxxxxxxxx">
                </div>
                <button type="submit" class="btn">Login</button>
            </form>
        </div>
    </div>

    <div class="sync-progress" id="syncProgress">
        <span class="loading-spinner"></span>
        <span id="syncProgressText">正在同步數據...</span>
    </div>

    <div class="admin-container" id="adminPanel">
        <header class="admin-header">
            <h1>LIVEGIGS ASIA ADMIN</h1>
            <div class="user-info">
                <span id="lastSync" class="last-sync"></span>
                <span id="syncStatus" class="sync-status pending">未同步</span>
                <button class="btn btn-small" onclick="syncAllToGitHub()">全站同步</button>
                <button class="btn btn-small btn-secondary" onclick="downloadAllData()">下载备份</button>
                <button class="btn btn-small btn-secondary" onclick="logout()">退出</button>
            </div>
        </header>

        <nav class="admin-sidebar">
            <a href="#dashboard" class="nav-item active" data-section="dashboard" onclick="showSection('dashboard'); return false;">Dashboard</a>
            <a href="#banners" class="nav-item" data-section="banners" onclick="showSection('banners'); return false;">1. Banner管理</a>
            <a href="#posters" class="nav-item" data-section="posters" onclick="showSection('posters'); return false;">2. 海报管理</a>
            <a href="#events" class="nav-item" data-section="events" onclick="showSection('events'); return false;">3. 自主活动</a>
            <a href="#carousel" class="nav-item" data-section="carousel" onclick="showSection('carousel'); return false;">4. 滚播活动</a>
            <a href="#footer" class="nav-item" data-section="footer" onclick="showSection('footer'); return false;">5. 底部管理</a>
            <a href="#partners" class="nav-item" data-section="partners" onclick="showSection('partners'); return false;">6. 合作伙伴</a>
        </nav>

        <main class="admin-content">
            <div id="alertBox" class="alert"></div>

            <section id="dashboard" class="section active">
                <h2 class="section-title">Dashboard</h2>
                <div class="stats-grid">
                    <div class="stat-card"><h3 id="statBanners">0</h3><p>Banners</p></div>
                    <div class="stat-card"><h3 id="statPosters">0</h3><p>Posters</p></div>
                    <div class="stat-card"><h3 id="statEvents">0</h3><p>自主活動</p></div>
                    <div class="stat-card"><h3 id="statCarousel">0</h3><p>滾播活動</p></div>
                    <div class="stat-card"><h3 id="statPartners">0</h3><p>合作Banner</p></div>
                    <div class="stat-card"><h3 id="statLogos">0</h3><p>合作Logo</p></div>
                </div>
                <div class="section-desc">
                    <p>欢迎使用 LiveGigs Asia 后台管理系统。</p>
                    <p>每个区域可以独立同步，也可以点击右上角"全站同步"一次性更新所有内容。</p>
                    <p><strong>重要提示：</strong>所有字段都可以留空。留空的文字字段前端不显示；留空的链接字段前端显示但不可点击。</p>
                </div>
            </section>

            <section id="banners" class="section">
                <h2 class="section-title">
                    1. Banner管理 (Index + CN 同步)
                    <button class="btn btn-small btn-success section-sync-btn" onclick="syncSection('banners')">同步此区域</button>
                </h2>
                <p class="section-desc">最多5个Banner。尺寸：1920×1080px。留空字段前端不显示，链接留空按钮不可点击但显示。</p>
                <div class="toolbar">
                    <span>已启用: <strong id="enabledBanners">0</strong> / 5</span>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th width="50">启用</th>
                            <th width="60">排序</th>
                            <th>標題 (留空不顯示)</th>
                            <th>按鈕文字 (留空不顯示)</th>
                            <th>鏈接地址 (留空顯示但不可點擊)</th>
                            <th>海報圖片</th>
                        </tr>
                    </thead>
                    <tbody id="bannerTableBody"></tbody>
                </table>
                <button class="add-row-btn" onclick="addBannerRow()">+ 添加Banner (最多5個)</button>
            </section>

            <section id="posters" class="section">
                <h2 class="section-title">
                    2. 海报管理
                    <button class="btn btn-small btn-success section-sync-btn" onclick="syncSection('posters')">同步此区域</button>
                </h2>
                <div class="tabs">
                    <button class="tab active" onclick="switchPosterTab('index')">Index頁面</button>
                    <button class="tab" onclick="switchPosterTab('cn')">CN頁面</button>
                    <button class="tab" onclick="switchPosterTab('events')">Events頁面</button>
                </div>
                <div id="poster-index" class="tab-content active">
                    <p class="section-desc">Index頁面3個海報。尺寸：400×600px。</p>
                    <table class="data-table">
                        <thead><tr><th width="50">啟用</th><th>標題 (留空不顯示)</th><th>鏈接文字 (留空不顯示)</th><th>鏈接地址 (留空顯示但不可點擊)</th><th>海報圖片</th></tr></thead>
                        <tbody id="indexPosterTableBody"></tbody>
                    </table>
                </div>
                <div id="poster-cn" class="tab-content">
                    <p class="section-desc">CN頁面3個海報。尺寸：400×600px。</p>
                    <table class="data-table">
                        <thead><tr><th width="50">啟用</th><th>標題 (留空不顯示)</th><th>鏈接文字 (留空不顯示)</th><th>鏈接地址 (留空顯示但不可點擊)</th><th>海報圖片</th></tr></thead>
                        <tbody id="cnPosterTableBody"></tbody>
                    </table>
                </div>
                <div id="poster-events" class="tab-content">
                    <p class="section-desc">Events頁面海報2（可滾播）。最多5個，≥2個時自動滾播。</p>
                    <div class="toolbar">
                        <label><input type="checkbox" id="poster2Carousel" onchange="togglePoster2Carousel()"> 啟用海報2滾播模式</label>
                    </div>
                    <table class="data-table">
                        <thead><tr><th width="50">啟用</th><th>標題 (留空不顯示)</th><th>鏈接文字 (留空不顯示)</th><th>鏈接地址 (留空顯示但不可點擊)</th><th>海報圖片</th></tr></thead>
                        <tbody id="eventsPosterTableBody"></tbody>
                    </table>
                    <button class="add-row-btn" onclick="addEventsPosterRow()">+ 添加海報 (最多5個)</button>
                </div>
            </section>

            <section id="events" class="section">
                <h2 class="section-title">
                    3. 自主活動管理
                    <button class="btn btn-small btn-success section-sync-btn" onclick="syncSection('events')">同步此区域</button>
                </h2>
                <p class="section-desc">最多9個，≤3個時不顯示Load More按鈕。尺寸：400×600px。</p>
                <div class="toolbar">
                    <span>已啟用: <strong id="enabledEvents">0</strong> / 9</span>
                    <span style="margin-left: 20px;">Load More: <strong id="loadMoreStatus">隱藏</strong></span>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th width="50">啟用</th>
                            <th>標題 (留空不顯示)</th>
                            <th>日期</th>
                            <th>地點</th>
                            <th>時間</th>
                            <th>門票</th>
                            <th>狀態</th>
                            <th>按鈕 (留空不顯示)</th>
                            <th>鏈接 (留空不可點擊)</th>
                            <th>海報</th>
                        </tr>
                    </thead>
                    <tbody id="eventsTableBody"></tbody>
                </table>
                <button class="add-row-btn" onclick="addEventRow()">+ 添加活動 (最多9個)</button>
            </section>

            <section id="carousel" class="section">
                <h2 class="section-title">
                    4. 滾播活動管理
                    <button class="btn btn-small btn-success section-sync-btn" onclick="syncSection('carousel')">同步此区域</button>
                </h2>
                <p class="section-desc">最少3個，最多12個。尺寸：1920×1080px。</p>
                <div class="toolbar">
                    <span>已啟用: <strong id="enabledCarousel">0</strong> / 12</span>
                </div>
                <table class="data-table">
                    <thead><tr><th width="50">啟用</th><th width="60">排序</th><th>標題 (留空不顯示)</th><th>按鈕文字 (留空不顯示)</th><th>鏈接地址 (留空顯示但不可點擊)</th><th>日期</th><th>海報圖片</th></tr></thead>
                    <tbody id="carouselTableBody"></tbody>
                </table>
                <button class="add-row-btn" onclick="addCarouselRow()">+ 添加滾播 (最多12個)</button>
            </section>

            <section id="footer" class="section">
                <h2 class="section-title">
                    5. 底部區域管理
                    <button class="btn btn-small btn-success section-sync-btn" onclick="syncSection('footer')">同步此区域</button>
                </h2>
                <div class="tabs">
                    <button class="tab active" onclick="switchFooterTab('global')">海外站 (Global)</button>
                    <button class="tab" onclick="switchFooterTab('cn')">國內站 (CN)</button>
                </div>
                <div id="footer-global" class="tab-content active">
                    <div class="field-mapping">
                        <strong>字段映射说明：</strong><br>
                        站点名称 → 前端 LIVEGIGS 文字<br>
                        站点副标（红色）→ 前端 ASIA 文字<br>
                        联系文字 → 前端电话/联系文字<br>
                        邮箱地址 → 前端邮箱地址（可点击发信）<br>
                        地址 → 前端右侧地址文字<br>
                        版权文字 → 底部版权文字<br>
                        制作单位Logo → 底部EMANON制作单位logo
                    </div>
                    <p class="section-desc">Index/Events/Partners/Privacy/Accessibility 頁面共用。留空字段前端不显示。</p>
                    <table class="data-table" style="margin-bottom: 30px;">
                        <thead><tr><th>配置項</th><th>內容</th></tr></thead>
                        <tbody>
                            <tr><td>站點名稱 (對應LIVEGIGS)</td><td><input type="text" id="globalSiteName" placeholder="LIVEGIGS"></td></tr>
                            <tr><td>站點副標 (紅色ASIA)</td><td><input type="text" id="globalSiteAsia" placeholder="ASIA"></td></tr>
                            <tr><td>聯繫文字 (留空不顯示)</td><td><textarea id="globalContactText" placeholder="For inquiries and partnership opportunities, reach out to us at:"></textarea></td></tr>
                            <tr><td>郵箱地址 (留空不顯示，可點擊發信)</td><td><input type="text" id="globalEmail" placeholder="xrebooking@hotmail.com"></td></tr>
                            <tr><td>地址 (留空不顯示)</td><td><input type="text" id="globalAddress" placeholder="Hong Kong | Shanghai | Beijing"></td></tr>
                            <tr><td>版權文字 (留空不顯示)</td><td><input type="text" id="globalCopyright" placeholder="Copyright © 2001-2026 EMANON ENT"></td></tr>
                            <tr><td>製作單位Logo</td><td><input type="text" id="globalProducerLogo" placeholder="./image/emanonent-logo.png"></td></tr>
                        </tbody>
                    </table>
                    <h3 style="color: #8b0000; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px;">社交媒體 (最多10個，鏈接或名稱留空時圖標顯示但不可點擊)</h3>
                    <table class="data-table">
                        <thead><tr><th width="50">啟用</th><th>名稱</th><th>圖標類型/自定義</th><th>鏈接地址 (留空顯示但不可點擊)</th></tr></thead>
                        <tbody id="globalSocialTableBody"></tbody>
                    </table>
                    <button class="add-row-btn" onclick="addGlobalSocialRow()">+ 添加社交媒體</button>
                </div>
                <div id="footer-cn" class="tab-content">
                    <div class="field-mapping">
                        <strong>字段映射说明：</strong><br>
                        站点名称 → 前端 LIVEGIGS 文字<br>
                        站点副标（红色）→ 前端 CN 文字<br>
                        联系文字 → 前端电话/联系文字<br>
                        邮箱地址 → 前端邮箱地址（可点击发信）<br>
                        地址 → 前端右侧地址文字<br>
                        版权文字 → 底部版权文字<br>
                        制作单位Logo → 底部EMANON制作单位logo
                    </div>
                    <p class="section-desc">CN頁面獨立底部配置。留空字段前端不显示。</p>
                    <table class="data-table" style="margin-bottom: 30px;">
                        <thead><tr><th>配置項</th><th>內容</th></tr></thead>
                        <tbody>
                            <tr><td>站點名稱 (對應LIVEGIGS)</td><td><input type="text" id="cnSiteName" placeholder="LIVEGIGS"></td></tr>
                            <tr><td>站點副標 (紅色CN)</td><td><input type="text" id="cnSiteAsia" placeholder="CN"></td></tr>
                            <tr><td>聯繫文字 (留空不顯示)</td><td><textarea id="cnContactText" placeholder="如需咨询和合作机会，请联系我们："></textarea></td></tr>
                            <tr><td>郵箱地址 (留空不顯示，可點擊發信)</td><td><input type="text" id="cnEmail" placeholder="xrebooking@hotmail.com"></td></tr>
                            <tr><td>地址 (留空不顯示)</td><td><input type="text" id="cnAddress" placeholder="香港 | 上海 | 北京"></td></tr>
                            <tr><td>版權文字 (留空不顯示)</td><td><input type="text" id="cnCopyright" placeholder="Copyright © 2001-2026 EMANON ENT"></td></tr>
                            <tr><td>製作單位Logo</td><td><input type="text" id="cnProducerLogo" placeholder="./image/emanonent-logo.png"></td></tr>
                        </tbody>
                    </table>
                    <h3 style="color: #8b0000; margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px;">社交媒體 (最多10個，鏈接或名稱留空時圖標顯示但不可點擊)</h3>
                    <table class="data-table">
                        <thead><tr><th width="50">啟用</th><th>名稱</th><th>圖標類型/自定義</th><th>鏈接地址 (留空顯示但不可點擊)</th></tr></thead>
                        <tbody id="cnSocialTableBody"></tbody>
                    </table>
                    <button class="add-row-btn" onclick="addCnSocialRow()">+ 添加社交媒體</button>
                </div>
            </section>

            <section id="partners" class="section">
                <h2 class="section-title">
                    6. 合作夥伴管理
                    <button class="btn btn-small btn-success section-sync-btn" onclick="syncSection('partners')">同步此区域</button>
                </h2>
                <div class="tabs">
                    <button class="tab active" onclick="switchPartnerTab('banners')">合作Banner</button>
                    <button class="tab" onclick="switchPartnerTab('logos')">合作Logo</button>
                </div>
                <div id="partner-banners" class="tab-content active">
                    <p class="section-desc">最多9個。主海報：1920×800px。</p>
                    <div class="toolbar"><span>已啟用: <strong id="enabledPartnerBanners">0</strong> / 9</span></div>
                    <table class="data-table">
                        <thead><tr><th width="50">啟用</th><th>主海報</th><th>Logo圖</th><th>標題 (留空不顯示)</th><th>詳情 (留空不顯示)</th><th>按鈕文字 (留空不顯示)</th><th>鏈接 (留空不可點擊)</th></tr></thead>
                        <tbody id="partnerBannerTableBody"></tbody>
                    </table>
                    <button class="add-row-btn" onclick="addPartnerBannerRow()">+ 添加Banner (最多9個)</button>
                </div>
                <div id="partner-logos" class="tab-content">
                    <p class="section-desc">最多9個，>6個自動換行居中。尺寸：180×110px。</p>
                    <div class="toolbar"><span>已啟用: <strong id="enabledPartnerLogos">0</strong> / 9</span></div>
                    <table class="data-table">
                        <thead><tr><th width="50">啟用</th><th>名稱</th><th>Logo圖片</th><th>鏈接地址 (留空顯示但不可點擊)</th></tr></thead>
                        <tbody id="partnerLogoTableBody"></tbody>
                    </table>
                    <button class="add-row-btn" onclick="addPartnerLogoRow()">+ 添加Logo (最多9個)</button>
                </div>
            </section>
        </main>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3>確認操作</h3>
            <p id="confirmMessage">確定要執行此操作嗎？</p>
            <div style="display: flex; gap: 15px; justify-content: center;">
                <button class="btn" onclick="confirmAction()">確定</button>
                <button class="btn btn-secondary" onclick="closeModal()">取消</button>
            </div>
        </div>
    </div>

<script>

    // 全局数据存储
    let appData = {
        banners: { banners: [] },
        indexPosters: { posters: [] },
        cnPosters: { posters: [] },
        eventsPosters: { posters: [], poster2_carousel: false },
        eventsManaged: { events: [] },
        eventsCarousel: { carousel: [] },
        footerGlobal: { 
            siteName: '',
            siteNameAsia: '',
            contactText: '',
            email: '',
            address: '',
            copyright: '',
            producerLogo: '',
            socials: [] 
        },
        footerCN: { 
            siteName: '',
            siteNameAsia: '',
            contactText: '',
            email: '',
            address: '',
            copyright: '',
            producerLogo: '',
            socials: [] 
        },
        partnersBanners: { banners: [] },
        collaborators: { logos: [] }
    };

    let githubToken = '';
    let inactivityTimer = null;
    const INACTIVITY_TIMEOUT = 30 * 60 * 1000; // 30分钟

    const fileMapping = {
        'banners': { file: 'banners.json', key: 'banners' },
        'posters': { 
            files: [
                { file: 'index-posters.json', key: 'indexPosters' },
                { file: 'cn-posters.json', key: 'cnPosters' },
                { file: 'events-posters.json', key: 'eventsPosters' }
            ]
        },
        'events': { file: 'events-managed.json', key: 'eventsManaged' },
        'carousel': { file: 'events-carousel.json', key: 'eventsCarousel' },
        'footer': {
            files: [
                { file: 'footer-global.json', key: 'footerGlobal' },
                { file: 'footer-cn.json', key: 'footerCN' }
            ]
        },
        'partners': {
            files: [
                { file: 'partners-banners.json', key: 'partnersBanners' },
                { file: 'collaborators.json', key: 'collaborators' }
            ]
        }
    };

    document.addEventListener('DOMContentLoaded', function() {
        // 检查登录状态
        if (localStorage.getItem('livegigs_admin_logged_in')) {
            const savedTime = parseInt(localStorage.getItem('livegigs_admin_login_time') || '0');
            if (Date.now() - savedTime < INACTIVITY_TIMEOUT) {
                githubToken = localStorage.getItem('livegigs_github_token') || '';
                showAdminPanel();
                // 登录后先反向同步前端数据到后台
                reverseSyncFromFrontend();
            } else {
                logout();
            }
        }

        // 登录表单
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            githubToken = document.getElementById('githubToken').value;

            if (username === 'admin' && password === '00123456a') {
                localStorage.setItem('livegigs_admin_logged_in', 'true');
                localStorage.setItem('livegigs_admin_login_time', Date.now().toString());
                localStorage.setItem('livegigs_github_token', githubToken);
                showAdminPanel();
                // 登录后先反向同步前端数据到后台
                reverseSyncFromFrontend();
                startInactivityTimer();
            } else {
                alert('用戶名或密碼錯誤');
            }
        });

        // 活动检测
        document.addEventListener('click', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);
    });

    function showAdminPanel() {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
    }

    function startInactivityTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(() => {
            alert('由於長時間未操作，系統已自動退出');
            logout();
        }, INACTIVITY_TIMEOUT);
    }

    function resetInactivityTimer() {
        startInactivityTimer();
    }

    function logout() {
        localStorage.removeItem('livegigs_admin_logged_in');
        localStorage.removeItem('livegigs_admin_login_time');
        localStorage.removeItem('livegigs_github_token');
        location.reload();
    }

    function showAlert(message, type) {
        const alertBox = document.getElementById('alertBox');
        alertBox.textContent = message;
        alertBox.className = `alert alert-${type} show`;
        setTimeout(() => alertBox.classList.remove('show'), 5000);
    }

    function showSyncProgress(text) {
        const progress = document.getElementById('syncProgress');
        document.getElementById('syncProgressText').textContent = text;
        progress.classList.add('show');
    }

    function hideSyncProgress() {
        document.getElementById('syncProgress').classList.remove('show');
    }

    // 反向同步：从GitHub加载现有数据到后台
    async function reverseSyncFromFrontend() {
        showSyncProgress('正在從GitHub同步數據到後台...');

        try {
            const files = [
                'banners', 'index-posters', 'cn-posters', 'events-posters',
                'events-managed', 'events-carousel', 'footer-global', 'footer-cn',
                'partners-banners', 'collaborators'
            ];

            for (const file of files) {
                try {
                    const response = await fetch(`../content/${file}.json?v=${Date.now()}`);
                    if (response.ok) {
                        const data = await response.json();
                        const key = file.replace(/-([a-z])/g, (g) => g[1].toUpperCase());
                        if (key === 'footerGlobal' || key === 'footerCN') {
                            appData[key] = { ...appData[key], ...data };
                        } else {
                            appData[key] = data;
                        }
                    }
                } catch (e) {
                    console.log(`Failed to load ${file}:`, e);
                }
            }

            initializeDataStructure();
            updateDashboard();
            renderAllSections();
            hideSyncProgress();
            showAlert('數據同步完成', 'success');

            // 更新同步状态
            document.getElementById('syncStatus').textContent = '已同步';
            document.getElementById('syncStatus').className = 'sync-status success';
            document.getElementById('lastSync').textContent = new Date().toLocaleString();
        } catch (error) {
            hideSyncProgress();
            showAlert('數據同步失敗: ' + error.message, 'error');
            // 即使失败也初始化空结构
            initializeDataStructure();
            renderAllSections();
        }
    }

    function initializeDataStructure() {
        // 底部数据默认值
        if (!appData.footerGlobal) {
            appData.footerGlobal = {
                siteName: 'LIVEGIGS',
                siteNameAsia: 'ASIA',
                contactText: '',
                email: '',
                address: '',
                copyright: '',
                producerLogo: './image/emanonent-logo.png',
                socials: []
            };
        }

        if (!appData.footerCN) {
            appData.footerCN = {
                siteName: 'LIVEGIGS',
                siteNameAsia: 'CN',
                contactText: '',
                email: '',
                address: '',
                copyright: '',
                producerLogo: './image/emanonent-logo.png',
                socials: []
            };
        }

        if (!appData.footerGlobal.socials) appData.footerGlobal.socials = [];
        if (!appData.footerCN.socials) appData.footerCN.socials = [];

        // Banner初始化 - 5个空位
        if (!appData.banners || !appData.banners.banners || appData.banners.banners.length === 0) {
            appData.banners = { banners: [] };
        }
        // 确保有5个位置
        while (appData.banners.banners.length < 5) {
            appData.banners.banners.push({
                id: appData.banners.banners.length + 1,
                title: '',
                buttonText: '',
                link: '',
                image: '',
                order: appData.banners.banners.length + 1,
                enabled: false
            });
        }

        // Posters初始化 - 3个位置
        ['indexPosters', 'cnPosters'].forEach(key => {
            if (!appData[key] || !appData[key].posters || appData[key].posters.length === 0) {
                appData[key] = { posters: [] };
            }
            while (appData[key].posters.length < 3) {
                appData[key].posters.push({
                    id: appData[key].posters.length + 1,
                    title: '',
                    linkText: '',
                    link: '',
                    image: '',
                    enabled: false
                });
            }
        });

        // Events posters - 5个位置
        if (!appData.eventsPosters || !appData.eventsPosters.posters || appData.eventsPosters.posters.length === 0) {
            appData.eventsPosters = { posters: [], poster2_carousel: false };
        }
        while (appData.eventsPosters.posters.length < 5) {
            appData.eventsPosters.posters.push({
                id: appData.eventsPosters.posters.length + 1,
                title: '',
                linkText: '',
                link: '',
                image: '',
                enabled: false
            });
        }

        // Events初始化 - 9个位置
        if (!appData.eventsManaged || !appData.eventsManaged.events || appData.eventsManaged.events.length === 0) {
            appData.eventsManaged = { events: [] };
        }
        while (appData.eventsManaged.events.length < 9) {
            appData.eventsManaged.events.push({
                id: appData.eventsManaged.events.length + 1,
                title: '',
                date: '',
                venue: '',
                time: '',
                image: '',
                ticket: '',
                status: '',
                buttonText: '',
                link: '',
                enabled: false
            });
        }

        // Carousel初始化 - 12个位置
        if (!appData.eventsCarousel || !appData.eventsCarousel.carousel || appData.eventsCarousel.carousel.length === 0) {
            appData.eventsCarousel = { carousel: [] };
        }
        while (appData.eventsCarousel.carousel.length < 12) {
            appData.eventsCarousel.carousel.push({
                id: appData.eventsCarousel.carousel.length + 1,
                title: '',
                buttonText: '',
                link: '',
                image: '',
                date: '',
                order: appData.eventsCarousel.carousel.length + 1,
                enabled: false
            });
        }

        // Partners初始化 - 9个位置
        if (!appData.partnersBanners || !appData.partnersBanners.banners || appData.partnersBanners.banners.length === 0) {
            appData.partnersBanners = { banners: [] };
        }
        while (appData.partnersBanners.banners.length < 9) {
            appData.partnersBanners.banners.push({
                id: appData.partnersBanners.banners.length + 1,
                mainImage: '',
                logoImage: '',
                title: '',
                description: '',
                buttonText: '',
                link: '',
                enabled: false
            });
        }

        if (!appData.collaborators || !appData.collaborators.logos || appData.collaborators.logos.length === 0) {
            appData.collaborators = { logos: [] };
        }
        while (appData.collaborators.logos.length < 9) {
            appData.collaborators.logos.push({
                id: appData.collaborators.logos.length + 1,
                name: '',
                image: '',
                link: '',
                enabled: false
            });
        }

        // Socials初始化 - 10个位置
        if (!appData.footerGlobal.socials || appData.footerGlobal.socials.length === 0) {
            appData.footerGlobal.socials = [];
        }
        while (appData.footerGlobal.socials.length < 10) {
            appData.footerGlobal.socials.push({
                id: appData.footerGlobal.socials.length + 1,
                name: '',
                icon: '',
                customIcon: '',
                link: '',
                enabled: false
            });
        }

        if (!appData.footerCN.socials || appData.footerCN.socials.length === 0) {
            appData.footerCN.socials = [];
        }
        while (appData.footerCN.socials.length < 10) {
            appData.footerCN.socials.push({
                id: appData.footerCN.socials.length + 1,
                name: '',
                icon: '',
                customIcon: '',
                link: '',
                enabled: false
            });
        }
    }

    function renderAllSections() {
        renderSection('banners');
        renderSection('posters');
        renderSection('events');
        renderSection('carousel');
        renderSection('footer');
        renderSection('partners');
    }

    function updateDashboard() {
        const bannerEnabled = appData.banners.banners.filter(b => b.enabled).length;
        const posterEnabled = appData.indexPosters.posters.filter(p => p.enabled).length;
        const eventEnabled = appData.eventsManaged.events.filter(e => e.enabled).length;
        const carouselEnabled = appData.eventsCarousel.carousel.filter(c => c.enabled).length;
        const partnerBannerEnabled = appData.partnersBanners.banners.filter(b => b.enabled).length;
        const logoEnabled = appData.collaborators.logos.filter(l => l.enabled).length;

        document.getElementById('statBanners').textContent = bannerEnabled;
        document.getElementById('statPosters').textContent = posterEnabled;
        document.getElementById('statEvents').textContent = eventEnabled;
        document.getElementById('statCarousel').textContent = carouselEnabled;
        document.getElementById('statPartners').textContent = partnerBannerEnabled;
        document.getElementById('statLogos').textContent = logoEnabled;
    }

    function showSection(section) {
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (item.dataset.section === section) item.classList.add('active');
        });

        document.querySelectorAll('.section').forEach(sec => sec.classList.remove('active'));
        const targetSection = document.getElementById(section);
        if (targetSection) {
            targetSection.classList.add('active');
            targetSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        if (section !== 'dashboard') {
            renderSection(section);
        } else {
            updateDashboard();
        }
        return false;
    }

    function renderSection(section) {
        switch(section) {
            case 'banners': renderBanners(); break;
            case 'posters': renderPosters(); break;
            case 'events': renderEvents(); break;
            case 'carousel': renderCarousel(); break;
            case 'footer': renderFooter(); break;
            case 'partners': renderPartners(); break;
        }
    }

    function renderBanners() {
        const tbody = document.getElementById('bannerTableBody');
        if (!tbody) return;
        const enabled = appData.banners.banners.filter(b => b.enabled).length;
        document.getElementById('enabledBanners').textContent = enabled;

        tbody.innerHTML = appData.banners.banners.map((banner, index) => `
            <tr class="${banner.enabled ? '' : 'disabled'}" data-id="${banner.id}">
                <td><input type="checkbox" ${banner.enabled ? 'checked' : ''} onchange="updateBanner(${index}, 'enabled', this.checked)"></td>
                <td><input type="number" class="order-input" value="${banner.order || index + 1}" onchange="updateBanner(${index}, 'order', this.value)"></td>
                <td><input type="text" value="${banner.title || ''}" onchange="updateBanner(${index}, 'title', this.value)" placeholder="留空不顯示"></td>
                <td><input type="text" value="${banner.buttonText || ''}" onchange="updateBanner(${index}, 'buttonText', this.value)" placeholder="留空不顯示"></td>
                <td><input type="text" value="${banner.link || ''}" onchange="updateBanner(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                <td><input type="text" value="${banner.image || ''}" onchange="updateBanner(${index}, 'image', this.value)" placeholder="圖片地址"></td>
            </tr>
        `).join('');
    }

    function updateBanner(index, field, value) {
        if (field === 'order') value = parseInt(value) || 0;
        if (field === 'enabled') value = Boolean(value);
        appData.banners.banners[index][field] = value;
        renderBanners();
        updateDashboard();
    }

    function addBannerRow() {
        const enabled = appData.banners.banners.filter(b => b.enabled).length;
        if (enabled >= 5) {
            showAlert('最多只能啟用5個Banner', 'error');
            return;
        }
        const disabled = appData.banners.banners.find(b => !b.enabled);
        if (disabled) {
            disabled.enabled = true;
            renderBanners();
            updateDashboard();
        }
    }

    function renderPosters() {
        const indexTbody = document.getElementById('indexPosterTableBody');
        if (indexTbody) {
            indexTbody.innerHTML = appData.indexPosters.posters.map((poster, index) => `
                <tr class="${poster.enabled ? '' : 'disabled'}" data-id="${poster.id}">
                    <td><input type="checkbox" ${poster.enabled ? 'checked' : ''} onchange="updateIndexPoster(${index}, 'enabled', this.checked)"></td>
                    <td><input type="text" value="${poster.title || ''}" onchange="updateIndexPoster(${index}, 'title', this.value)" placeholder="留空不顯示"></td>
                    <td><input type="text" value="${poster.linkText || ''}" onchange="updateIndexPoster(${index}, 'linkText', this.value)" placeholder="留空不顯示"></td>
                    <td><input type="text" value="${poster.link || ''}" onchange="updateIndexPoster(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                    <td><input type="text" value="${poster.image || ''}" onchange="updateIndexPoster(${index}, 'image', this.value)" placeholder="圖片地址"></td>
                </tr>
            `).join('');
        }

        const cnTbody = document.getElementById('cnPosterTableBody');
        if (cnTbody) {
            cnTbody.innerHTML = appData.cnPosters.posters.map((poster, index) => `
                <tr class="${poster.enabled ? '' : 'disabled'}" data-id="${poster.id}">
                    <td><input type="checkbox" ${poster.enabled ? 'checked' : ''} onchange="updateCnPoster(${index}, 'enabled', this.checked)"></td>
                    <td><input type="text" value="${poster.title || ''}" onchange="updateCnPoster(${index}, 'title', this.value)" placeholder="留空不顯示"></td>
                    <td><input type="text" value="${poster.linkText || ''}" onchange="updateCnPoster(${index}, 'linkText', this.value)" placeholder="留空不顯示"></td>
                    <td><input type="text" value="${poster.link || ''}" onchange="updateCnPoster(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                    <td><input type="text" value="${poster.image || ''}" onchange="updateCnPoster(${index}, 'image', this.value)" placeholder="圖片地址"></td>
                </tr>
            `).join('');
        }

        const poster2Carousel = document.getElementById('poster2Carousel');
        if (poster2Carousel) {
            poster2Carousel.checked = appData.eventsPosters.poster2_carousel || false;
        }

        const eventsTbody = document.getElementById('eventsPosterTableBody');
        if (eventsTbody) {
            eventsTbody.innerHTML = appData.eventsPosters.posters.map((poster, index) => `
                <tr class="${poster.enabled ? '' : 'disabled'}" data-id="${poster.id}">
                    <td><input type="checkbox" ${poster.enabled ? 'checked' : ''} onchange="updateEventsPoster(${index}, 'enabled', this.checked)"></td>
                    <td><input type="text" value="${poster.title || ''}" onchange="updateEventsPoster(${index}, 'title', this.value)" placeholder="留空不顯示"></td>
                    <td><input type="text" value="${poster.linkText || ''}" onchange="updateEventsPoster(${index}, 'linkText', this.value)" placeholder="留空不顯示"></td>
                    <td><input type="text" value="${poster.link || ''}" onchange="updateEventsPoster(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                    <td><input type="text" value="${poster.image || ''}" onchange="updateEventsPoster(${index}, 'image', this.value)" placeholder="圖片地址"></td>
                </tr>
            `).join('');
        }
    }

    function updateIndexPoster(index, field, value) {
        if (field === 'enabled') value = Boolean(value);
        appData.indexPosters.posters[index][field] = value;
        updateDashboard();
    }

    function updateCnPoster(index, field, value) {
        if (field === 'enabled') value = Boolean(value);
        appData.cnPosters.posters[index][field] = value;
        updateDashboard();
    }

    function updateEventsPoster(index, field, value) {
        if (field === 'enabled') value = Boolean(value);
        appData.eventsPosters.posters[index][field] = value;
        updateDashboard();
    }

    function togglePoster2Carousel() {
        const checkbox = document.getElementById('poster2Carousel');
        if (checkbox) {
            appData.eventsPosters.poster2_carousel = checkbox.checked;
        }
    }

    function addEventsPosterRow() {
        const enabled = appData.eventsPosters.posters.filter(p => p.enabled).length;
        if (enabled >= 5) {
            showAlert('最多只能啟用5個海報', 'error');
            return;
        }
        const disabled = appData.eventsPosters.posters.find(p => !p.enabled);
        if (disabled) {
            disabled.enabled = true;
            renderPosters();
            updateDashboard();
        }
    }

    function switchPosterTab(tab) {
        document.querySelectorAll('#posters .tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('#posters .tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`poster-${tab}`).classList.add('active');
    }

    function renderEvents() {
        const tbody = document.getElementById('eventsTableBody');
        if (!tbody) return;
        const enabled = appData.eventsManaged.events.filter(e => e.enabled).length;
        document.getElementById('enabledEvents').textContent = enabled;
        document.getElementById('loadMoreStatus').textContent = enabled > 3 ? '顯示' : '隱藏';

        tbody.innerHTML = appData.eventsManaged.events.map((event, index) => `
            <tr class="${event.enabled ? '' : 'disabled'}" data-id="${event.id}">
                <td><input type="checkbox" ${event.enabled ? 'checked' : ''} onchange="updateEvent(${index}, 'enabled', this.checked)"></td>
                <td><input type="text" value="${event.title || ''}" onchange="updateEvent(${index}, 'title', this.value)" placeholder="留空不顯示"></td>
                <td><input type="text" value="${event.date || ''}" onchange="updateEvent(${index}, 'date', this.value)" placeholder="2026.01.01"></td>
                <td><input type="text" value="${event.venue || ''}" onchange="updateEvent(${index}, 'venue', this.value)" placeholder="地點"></td>
                <td><input type="text" value="${event.time || ''}" onchange="updateEvent(${index}, 'time', this.value)" placeholder="20:00"></td>
                <td><input type="text" value="${event.ticket || ''}" onchange="updateEvent(${index}, 'ticket', this.value)" placeholder="$100"></td>
                <td>
                    <select onchange="updateEvent(${index}, 'status', this.value)" style="background: #ffffff; border: 1px solid #8b0000; color: #1a1a1a; padding: 5px;">
                        <option value="" ${!event.status ? 'selected' : ''}>倒數計時</option>
                        <option value="SOLD OUT" ${event.status === 'SOLD OUT' ? 'selected' : ''}>SOLD OUT</option>
                        <option value="ON TOUR" ${event.status === 'ON TOUR' ? 'selected' : ''}>ON TOUR</option>
                    </select>
                </td>
                <td><input type="text" value="${event.buttonText || ''}" onchange="updateEvent(${index}, 'buttonText', this.value)" placeholder="留空不顯示"></td>
                <td><input type="text" value="${event.link || ''}" onchange="updateEvent(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                <td><input type="text" value="${event.image || ''}" onchange="updateEvent(${index}, 'image', this.value)" placeholder="圖片地址"></td>
            </tr>
        `).join('');
    }

    function updateEvent(index, field, value) {
        if (field === 'enabled') value = Boolean(value);
        appData.eventsManaged.events[index][field] = value;
        renderEvents();
        updateDashboard();
    }

    function addEventRow() {
        const enabled = appData.eventsManaged.events.filter(e => e.enabled).length;
        if (enabled >= 9) {
            showAlert('最多只能啟用9個活動', 'error');
            return;
        }
        const disabled = appData.eventsManaged.events.find(e => !e.enabled);
        if (disabled) {
            disabled.enabled = true;
            renderEvents();
            updateDashboard();
        }
    }

    function renderCarousel() {
        const tbody = document.getElementById('carouselTableBody');
        if (!tbody) return;
        const enabled = appData.eventsCarousel.carousel.filter(c => c.enabled).length;
        document.getElementById('enabledCarousel').textContent = enabled;

        tbody.innerHTML = appData.eventsCarousel.carousel.map((item, index) => `
            <tr class="${item.enabled ? '' : 'disabled'}" data-id="${item.id}">
                <td><input type="checkbox" ${item.enabled ? 'checked' : ''} onchange="updateCarousel(${index}, 'enabled', this.checked)"></td>
                <td><input type="number" class="order-input" value="${item.order || index + 1}" onchange="updateCarousel(${index}, 'order', this.value)"></td>
                <td><input type="text" value="${item.title || ''}" onchange="updateCarousel(${index}, 'title', this.value)" placeholder="留空不顯示"></td>
                <td><input type="text" value="${item.buttonText || ''}" onchange="updateCarousel(${index}, 'buttonText', this.value)" placeholder="留空不顯示"></td>
                <td><input type="text" value="${item.link || ''}" onchange="updateCarousel(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                <td><input type="text" value="${item.date || ''}" onchange="updateCarousel(${index}, 'date', this.value)" placeholder="2026.01.01"></td>
                <td><input type="text" value="${item.image || ''}" onchange="updateCarousel(${index}, 'image', this.value)" placeholder="圖片地址"></td>
            </tr>
        `).join('');
    }

    function updateCarousel(index, field, value) {
        if (field === 'enabled') value = Boolean(value);
        if (field === 'order') value = parseInt(value) || 0;
        appData.eventsCarousel.carousel[index][field] = value;
        renderCarousel();
        updateDashboard();
    }

    function addCarouselRow() {
        const enabled = appData.eventsCarousel.carousel.filter(c => c.enabled).length;
        if (enabled >= 12) {
            showAlert('最多只能啟用12個滾播', 'error');
            return;
        }
        const disabled = appData.eventsCarousel.carousel.find(c => !c.enabled);
        if (disabled) {
            disabled.enabled = true;
            renderCarousel();
            updateDashboard();
        }
    }

    function renderFooter() {
        // 海外站
        if (appData.footerGlobal) {
            const globalSiteName = document.getElementById('globalSiteName');
            const globalSiteAsia = document.getElementById('globalSiteAsia');
            const globalContactText = document.getElementById('globalContactText');
            const globalEmail = document.getElementById('globalEmail');
            const globalAddress = document.getElementById('globalAddress');
            const globalCopyright = document.getElementById('globalCopyright');
            const globalProducerLogo = document.getElementById('globalProducerLogo');

            if (globalSiteName) globalSiteName.value = appData.footerGlobal.siteName || '';
            if (globalSiteAsia) globalSiteAsia.value = appData.footerGlobal.siteNameAsia || '';
            if (globalContactText) globalContactText.value = appData.footerGlobal.contactText || '';
            if (globalEmail) globalEmail.value = appData.footerGlobal.email || '';
            if (globalAddress) globalAddress.value = appData.footerGlobal.address || '';
            if (globalCopyright) globalCopyright.value = appData.footerGlobal.copyright || '';
            if (globalProducerLogo) globalProducerLogo.value = appData.footerGlobal.producerLogo || './image/emanonent-logo.png';

            const globalSocialTbody = document.getElementById('globalSocialTableBody');
            if (globalSocialTbody) {
                globalSocialTbody.innerHTML = appData.footerGlobal.socials.map((social, index) => `
                    <tr class="${social.enabled ? '' : 'disabled'}">
                        <td><input type="checkbox" ${social.enabled ? 'checked' : ''} onchange="updateGlobalSocial(${index}, 'enabled', this.checked)"></td>
                        <td><input type="text" value="${social.name || ''}" onchange="updateGlobalSocial(${index}, 'name', this.value)" placeholder="名稱"></td>
                        <td>
                            <select onchange="updateGlobalSocial(${index}, 'icon', this.value)" style="background: #ffffff; border: 1px solid #8b0000; color: #1a1a1a; padding: 5px; margin-bottom: 5px;">
                                <option value="">選擇預設圖標</option>
                                <option value="facebook" ${social.icon === 'facebook' ? 'selected' : ''}>Facebook</option>
                                <option value="instagram" ${social.icon === 'instagram' ? 'selected' : ''}>Instagram</option>
                                <option value="youtube" ${social.icon === 'youtube' ? 'selected' : ''}>YouTube</option>
                                <option value="x" ${social.icon === 'x' ? 'selected' : ''}>X (Twitter)</option>
                                <option value="twitter" ${social.icon === 'twitter' ? 'selected' : ''}>Twitter</option>
                                <option value="tiktok" ${social.icon === 'tiktok' ? 'selected' : ''}>TikTok</option>
                                <option value="linkedin" ${social.icon === 'linkedin' ? 'selected' : ''}>LinkedIn</option>
                                <option value="spotify" ${social.icon === 'spotify' ? 'selected' : ''}>Spotify</option>
                                <option value="apple" ${social.icon === 'apple' ? 'selected' : ''}>Apple Music</option>
                                <option value="soundcloud" ${social.icon === 'soundcloud' ? 'selected' : ''}>SoundCloud</option>
                                <option value="bandcamp" ${social.icon === 'bandcamp' ? 'selected' : ''}>Bandcamp</option>
                            </select>
                            <input type="text" value="${social.customIcon || ''}" onchange="updateGlobalSocial(${index}, 'customIcon', this.value)" placeholder="或輸入自定義圖標名稱" style="margin-top: 5px;">
                        </td>
                        <td><input type="text" value="${social.link || ''}" onchange="updateGlobalSocial(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                    </tr>
                `).join('');
            }
        }

        // 国内站
        if (appData.footerCN) {
            const cnSiteName = document.getElementById('cnSiteName');
            const cnSiteAsia = document.getElementById('cnSiteAsia');
            const cnContactText = document.getElementById('cnContactText');
            const cnEmail = document.getElementById('cnEmail');
            const cnAddress = document.getElementById('cnAddress');
            const cnCopyright = document.getElementById('cnCopyright');
            const cnProducerLogo = document.getElementById('cnProducerLogo');

            if (cnSiteName) cnSiteName.value = appData.footerCN.siteName || '';
            if (cnSiteAsia) cnSiteAsia.value = appData.footerCN.siteNameAsia || '';
            if (cnContactText) cnContactText.value = appData.footerCN.contactText || '';
            if (cnEmail) cnEmail.value = appData.footerCN.email || '';
            if (cnAddress) cnAddress.value = appData.footerCN.address || '';
            if (cnCopyright) cnCopyright.value = appData.footerCN.copyright || '';
            if (cnProducerLogo) cnProducerLogo.value = appData.footerCN.producerLogo || './image/emanonent-logo.png';

            const cnSocialTbody = document.getElementById('cnSocialTableBody');
            if (cnSocialTbody) {
                cnSocialTbody.innerHTML = appData.footerCN.socials.map((social, index) => `
                    <tr class="${social.enabled ? '' : 'disabled'}">
                        <td><input type="checkbox" ${social.enabled ? 'checked' : ''} onchange="updateCnSocial(${index}, 'enabled', this.checked)"></td>
                        <td><input type="text" value="${social.name || ''}" onchange="updateCnSocial(${index}, 'name', this.value)" placeholder="名稱"></td>
                        <td>
                            <select onchange="updateCnSocial(${index}, 'icon', this.value)" style="background: #ffffff; border: 1px solid #8b0000; color: #1a1a1a; padding: 5px; margin-bottom: 5px;">
                                <option value="">選擇預設圖標</option>
                                <option value="wechat" ${social.icon === 'wechat' ? 'selected' : ''}>微信</option>
                                <option value="weibo" ${social.icon === 'weibo' ? 'selected' : ''}>微博</option>
                                <option value="xiaohongshu" ${social.icon === 'xiaohongshu' ? 'selected' : ''}>小紅書</option>
                                <option value="miniprogram" ${social.icon === 'miniprogram' ? 'selected' : ''}>小程序</option>
                                <option value="douyin" ${social.icon === 'douyin' ? 'selected' : ''}>抖音</option>
                                <option value="bilibili" ${social.icon === 'bilibili' ? 'selected' : ''}>Bilibili</option>
                                <option value="qq" ${social.icon === 'qq' ? 'selected' : ''}>QQ</option>
                                <option value="zhihu" ${social.icon === 'zhihu' ? 'selected' : ''}>知乎</option>
                                <option value="netease" ${social.icon === 'netease' ? 'selected' : ''}>網易雲音樂</option>
                                <option value="qqmusic" ${social.icon === 'qqmusic' ? 'selected' : ''}>QQ音樂</option>
                            </select>
                            <input type="text" value="${social.customIcon || ''}" onchange="updateCnSocial(${index}, 'customIcon', this.value)" placeholder="或輸入自定義圖標名稱" style="margin-top: 5px;">
                        </td>
                        <td><input type="text" value="${social.link || ''}" onchange="updateCnSocial(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                    </tr>
                `).join('');
            }
        }
    }

    function updateGlobalSocial(index, field, value) {
        if (field === 'enabled') value = Boolean(value);
        appData.footerGlobal.socials[index][field] = value;
    }

    function updateCnSocial(index, field, value) {
        if (field === 'enabled') value = Boolean(value);
        appData.footerCN.socials[index][field] = value;
    }

    function switchFooterTab(tab) {
        document.querySelectorAll('#footer .tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('#footer .tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`footer-${tab}`).classList.add('active');
    }

    function addGlobalSocialRow() {
        const enabled = appData.footerGlobal.socials.filter(s => s.enabled).length;
        if (enabled >= 10) {
            showAlert('最多只能啟用10個社交媒體', 'error');
            return;
        }
        const disabled = appData.footerGlobal.socials.find(s => !s.enabled);
        if (disabled) {
            disabled.enabled = true;
            renderFooter();
        }
    }

    function addCnSocialRow() {
        const enabled = appData.footerCN.socials.filter(s => s.enabled).length;
        if (enabled >= 10) {
            showAlert('最多只能啟用10個社交媒體', 'error');
            return;
        }
        const disabled = appData.footerCN.socials.find(s => !s.enabled);
        if (disabled) {
            disabled.enabled = true;
            renderFooter();
        }
    }

    function renderPartners() {
        const bannerTbody = document.getElementById('partnerBannerTableBody');
        if (bannerTbody) {
            const enabledBanners = appData.partnersBanners.banners.filter(b => b.enabled).length;
            document.getElementById('enabledPartnerBanners').textContent = enabledBanners;

            bannerTbody.innerHTML = appData.partnersBanners.banners.map((banner, index) => `
                <tr class="${banner.enabled ? '' : 'disabled'}" data-id="${banner.id}">
                    <td><input type="checkbox" ${banner.enabled ? 'checked' : ''} onchange="updatePartnerBanner(${index}, 'enabled', this.checked)"></td>
                    <td><input type="text" value="${banner.mainImage || ''}" onchange="updatePartnerBanner(${index}, 'mainImage', this.value)" placeholder="主海報"></td>
                    <td><input type="text" value="${banner.logoImage || ''}" onchange="updatePartnerBanner(${index}, 'logoImage', this.value)" placeholder="Logo圖"></td>
                    <td><input type="text" value="${banner.title || ''}" onchange="updatePartnerBanner(${index}, 'title', this.value)" placeholder="留空不顯示"></td>
                    <td><textarea onchange="updatePartnerBanner(${index}, 'description', this.value)" placeholder="留空不顯示">${banner.description || ''}</textarea></td>
                    <td><input type="text" value="${banner.buttonText || ''}" onchange="updatePartnerBanner(${index}, 'buttonText', this.value)" placeholder="留空不顯示"></td>
                    <td><input type="text" value="${banner.link || ''}" onchange="updatePartnerBanner(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                </tr>
            `).join('');
        }

        const logoTbody = document.getElementById('partnerLogoTableBody');
        if (logoTbody) {
            const enabledLogos = appData.collaborators.logos.filter(l => l.enabled).length;
            document.getElementById('enabledPartnerLogos').textContent = enabledLogos;

            logoTbody.innerHTML = appData.collaborators.logos.map((logo, index) => `
                <tr class="${logo.enabled ? '' : 'disabled'}" data-id="${logo.id}">
                    <td><input type="checkbox" ${logo.enabled ? 'checked' : ''} onchange="updatePartnerLogo(${index}, 'enabled', this.checked)"></td>
                    <td><input type="text" value="${logo.name || ''}" onchange="updatePartnerLogo(${index}, 'name', this.value)" placeholder="名稱"></td>
                    <td><input type="text" value="${logo.image || ''}" onchange="updatePartnerLogo(${index}, 'image', this.value)" placeholder="Logo圖片"></td>
                    <td><input type="text" value="${logo.link || ''}" onchange="updatePartnerLogo(${index}, 'link', this.value)" placeholder="留空不可點擊"></td>
                </tr>
            `).join('');
        }
    }

    function updatePartnerBanner(index, field, value) {
        if (field === 'enabled') value = Boolean(value);
        appData.partnersBanners.banners[index][field] = value;
        renderPartners();
        updateDashboard();
    }

    function updatePartnerLogo(index, field, value) {
        if (field === 'enabled') value = Boolean(value);
        appData.collaborators.logos[index][field] = value;
        renderPartners();
        updateDashboard();
    }

    function addPartnerBannerRow() {
        const enabled = appData.partnersBanners.banners.filter(b => b.enabled).length;
        if (enabled >= 9) {
            showAlert('最多只能啟用9個Banner', 'error');
            return;
        }
        const disabled = appData.partnersBanners.banners.find(b => !b.enabled);
        if (disabled) {
            disabled.enabled = true;
            renderPartners();
            updateDashboard();
        }
    }

    function addPartnerLogoRow() {
        const enabled = appData.collaborators.logos.filter(l => l.enabled).length;
        if (enabled >= 9) {
            showAlert('最多只能啟用9個Logo', 'error');
            return;
        }
        const disabled = appData.collaborators.logos.find(l => !l.enabled);
        if (disabled) {
            disabled.enabled = true;
            renderPartners();
            updateDashboard();
        }
    }

    function switchPartnerTab(tab) {
        document.querySelectorAll('#partners .tab').forEach(t => t.classList.remove('active'));
        event.target.classList.add('active');
        document.querySelectorAll('#partners .tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`partner-${tab}`).classList.add('active');
    }

    // 从表单更新底部数据
    function updateFooterDataFromForm() {
        // 海外站
        const globalSiteName = document.getElementById('globalSiteName');
        const globalSiteAsia = document.getElementById('globalSiteAsia');
        const globalContactText = document.getElementById('globalContactText');
        const globalEmail = document.getElementById('globalEmail');
        const globalAddress = document.getElementById('globalAddress');
        const globalCopyright = document.getElementById('globalCopyright');
        const globalProducerLogo = document.getElementById('globalProducerLogo');

        if (globalSiteName) appData.footerGlobal.siteName = globalSiteName.value;
        if (globalSiteAsia) appData.footerGlobal.siteNameAsia = globalSiteAsia.value;
        if (globalContactText) appData.footerGlobal.contactText = globalContactText.value;
        if (globalEmail) appData.footerGlobal.email = globalEmail.value;
        if (globalAddress) appData.footerGlobal.address = globalAddress.value;
        if (globalCopyright) appData.footerGlobal.copyright = globalCopyright.value;
        if (globalProducerLogo) appData.footerGlobal.producerLogo = globalProducerLogo.value;

        // 国内站
        const cnSiteName = document.getElementById('cnSiteName');
        const cnSiteAsia = document.getElementById('cnSiteAsia');
        const cnContactText = document.getElementById('cnContactText');
        const cnEmail = document.getElementById('cnEmail');
        const cnAddress = document.getElementById('cnAddress');
        const cnCopyright = document.getElementById('cnCopyright');
        const cnProducerLogo = document.getElementById('cnProducerLogo');

        if (cnSiteName) appData.footerCN.siteName = cnSiteName.value;
        if (cnSiteAsia) appData.footerCN.siteNameAsia = cnSiteAsia.value;
        if (cnContactText) appData.footerCN.contactText = cnContactText.value;
        if (cnEmail) appData.footerCN.email = cnEmail.value;
        if (cnAddress) appData.footerCN.address = cnAddress.value;
        if (cnCopyright) appData.footerCN.copyright = cnCopyright.value;
        if (cnProducerLogo) appData.footerCN.producerLogo = cnProducerLogo.value;
    }

    // 同步单个区域到GitHub
    async function syncSection(section) {
        if (!githubToken) {
            showAlert('請先設置GitHub Token', 'error');
            return;
        }

        // 先更新底部数据
        if (section === 'footer' || section === 'all') {
            updateFooterDataFromForm();
        }

        const mapping = fileMapping[section];
        if (!mapping) {
            showAlert('未知的區域: ' + section, 'error');
            return;
        }

        showSyncProgress('正在同步 ' + section + ' 到GitHub...');

        try {
            let files = [];
            if (mapping.files) {
                files = mapping.files.map(f => ({
                    name: f.file,
                    content: JSON.stringify(appData[f.key], null, 2)
                }));
            } else {
                files = [{
                    name: mapping.file,
                    content: JSON.stringify(appData[mapping.key], null, 2)
                }];
            }

            let successCount = 0;
            let failCount = 0;

            for (const file of files) {
                try {
                    let sha = null;
                    try {
                        const getResponse = await fetch(`https://api.github.com/repos/EmanonEnt/asia/contents/content/${file.name}`, {
                            headers: { 'Authorization': `token ${githubToken}` }
                        });
                        if (getResponse.ok) {
                            const data = await getResponse.json();
                            sha = data.sha;
                        }
                    } catch (e) {}

                    const body = {
                        message: `Update ${file.name} via admin (${section})`,
                        content: btoa(unescape(encodeURIComponent(file.content)))
                    };
                    if (sha) body.sha = sha;

                    const response = await fetch(`https://api.github.com/repos/EmanonEnt/asia/contents/content/${file.name}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    });

                    if (response.ok) {
                        successCount++;
                    } else {
                        failCount++;
                    }
                } catch (e) {
                    failCount++;
                }
            }

            hideSyncProgress();
            if (failCount === 0) {
                showAlert(`${section} 區域同步成功 (${successCount} 個文件)`, 'success');
                document.getElementById('syncStatus').textContent = '已同步';
                document.getElementById('syncStatus').className = 'sync-status success';
                document.getElementById('lastSync').textContent = new Date().toLocaleString();
            } else {
                showAlert(`${section} 區域同步完成: ${successCount} 成功, ${failCount} 失敗`, 'error');
            }
        } catch (error) {
            hideSyncProgress();
            showAlert('同步失敗: ' + error.message, 'error');
        }
    }

    // 全站同步到GitHub
    async function syncAllToGitHub() {
        if (!githubToken) {
            showAlert('請先設置GitHub Token', 'error');
            return;
        }

        // 先更新底部数据
        updateFooterDataFromForm();

        const statusEl = document.getElementById('syncStatus');
        statusEl.textContent = '同步中...';
        statusEl.className = 'sync-status pending';

        showSyncProgress('正在全站同步到GitHub...');

        try {
            const files = [
                { name: 'banners.json', content: JSON.stringify(appData.banners, null, 2) },
                { name: 'index-posters.json', content: JSON.stringify(appData.indexPosters, null, 2) },
                { name: 'cn-posters.json', content: JSON.stringify(appData.cnPosters, null, 2) },
                { name: 'events-posters.json', content: JSON.stringify(appData.eventsPosters, null, 2) },
                { name: 'events-managed.json', content: JSON.stringify(appData.eventsManaged, null, 2) },
                { name: 'events-carousel.json', content: JSON.stringify(appData.eventsCarousel, null, 2) },
                { name: 'footer-global.json', content: JSON.stringify(appData.footerGlobal, null, 2) },
                { name: 'footer-cn.json', content: JSON.stringify(appData.footerCN, null, 2) },
                { name: 'partners-banners.json', content: JSON.stringify(appData.partnersBanners, null, 2) },
                { name: 'collaborators.json', content: JSON.stringify(appData.collaborators, null, 2) }
            ];

            let successCount = 0;
            let failCount = 0;

            for (const file of files) {
                try {
                    let sha = null;
                    try {
                        const getResponse = await fetch(`https://api.github.com/repos/EmanonEnt/asia/contents/content/${file.name}`, {
                            headers: { 'Authorization': `token ${githubToken}` }
                        });
                        if (getResponse.ok) {
                            const data = await getResponse.json();
                            sha = data.sha;
                        }
                    } catch (e) {}

                    const body = {
                        message: `Update ${file.name} via admin (full sync)`,
                        content: btoa(unescape(encodeURIComponent(file.content)))
                    };
                    if (sha) body.sha = sha;

                    const response = await fetch(`https://api.github.com/repos/EmanonEnt/asia/contents/content/${file.name}`, {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${githubToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(body)
                    });

                    if (response.ok) {
                        successCount++;
                    } else {
                        failCount++;
                    }
                } catch (e) {
                    failCount++;
                }
            }

            hideSyncProgress();
            if (failCount === 0) {
                statusEl.textContent = '同步成功';
                statusEl.className = 'sync-status success';
                document.getElementById('lastSync').textContent = new Date().toLocaleString();
                showAlert(`全站同步成功: ${successCount} 個文件`, 'success');
            } else {
                statusEl.textContent = '同步失敗';
                statusEl.className = 'sync-status error';
                showAlert(`同步完成: ${successCount} 成功, ${failCount} 失敗`, 'error');
            }
        } catch (error) {
            hideSyncProgress();
            statusEl.textContent = '同步錯誤';
            statusEl.className = 'sync-status error';
            showAlert('同步失敗: ' + error.message, 'error');
        }
    }

    function downloadAllData() {
        updateFooterDataFromForm();
        const dataStr = JSON.stringify(appData, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `livegigs-backup-${new Date().toISOString().slice(0, 10)}.json`;
        link.click();
        URL.revokeObjectURL(url);
        showAlert('數據已下載', 'success');
    }

    function closeModal() {
        document.getElementById('confirmModal').classList.remove('show');
    }

    function confirmAction() {
        closeModal();
    }
</script>
</body>
</html>
